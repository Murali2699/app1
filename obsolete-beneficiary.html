<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Payment Automation Dashboard</title>
  <meta content="" name="description">
  <meta content="" name="keywords">
  <!-- Favicons -->
  <link href="assets/img/tn_logo.png" rel="icon">
  <link href="assets/img/tn_logo.png" rel="apple-touch-icon">
  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> -->
  <link rel="stylesheet" href="assets/vendor/sweetalert2/css/sweetalert.min.css" />
  <link rel="stylesheet" href="assets/vendor/sweetalert2/css/sweetalert2.min.css" />
  <!-- <link rel="stylesheet" href="assets/vendor/toggle/bootstrap-toggle.min.css" /> -->
  <!-- CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <!-- <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css"> -->
  <script src="assets/components/official_header.js" type="text/javascript" defer></script>
  <style>
    .obselete_beni{
        display: flex;
        justify-content: space-between;
    }
    .modal-dialog{
        background: #ffff;
        border-radius: 10px;
    }
    #obsolete_dt_form->input{
        cursor: pointer;
    }
    .formElementRadio{
      display: flex;
      gap: 10px;
    }
    textarea{
      resize: none;
    }
    

  </style>
</head>

<body>
  <!-- ======= Header & sidemenu ======= -->
  <official-header-component></official-header-component>
  <div id="preloader"></div>
  <!-- End Sidebar-->
  <main id="main" class="main">
    <!-- Dashboard view starts -->
    <section>
      <div class="container-fluid">
        <div class="card mb-1">
          <div class="card-body pb-0 pt-2">
            <div class="row mb-2 boxflex">
              <h5 class="card-title pb- mb-0"><i class="bi bi-funnel"></i>Apply Filter </h5>
              <div class="col-md">
                <label for="ddl_scheme_cate" class="form-label fw-bold">Scheme Category</label>
                <select class="form-select" id="ddl_scheme_cate" name="ddl_scheme_cate">
                  <option value="">--All--</option>
                </select>
              </div>
              <div class="col-md">
                <label for="ddl_scheme_code" class="form-label fw-bold">Scheme Code</label>
                <select class="form-select" id="ddl_scheme_code" name="ddl_scheme_code">
                  <option value="">--All--</option>
                </select>
              </div>
              <div class="col-md">
                <label for="ddl_scheme_name" class="form-label fw-bold">Scheme Name</label>
                <select class="form-select" id="ddl_scheme_name" name="ddl_scheme_name">
                  <option value="">--All--</option>
                </select>
              </div>
              <div class="col-md">
                <label for="ddl_sub_scheme" class="form-label fw-bold">Sub Scheme Name</label>
                <select class="form-select" id="ddl_sub_scheme" name="ddl_sub_scheme">
                  <option value="">--All--</option>
                </select>
              </div>
              <div class="col-md">
                <label for="ddl_department" class="form-label fw-bold">Department</label>
                <select class="form-select" id="ddl_department" name="ddl_department">
                  <option value="">--All--</option>
                </select>
              </div>
              <div class="col-md">
                <label for="ddl_sub_department" class="form-label fw-bold">Sub Department</label>
                <select class="form-select" id="ddl_sub_department" name="ddl_sub_department">
                  <option value="">--All--</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <!-- END: Dropdown card end here -->
        <div class="card mb-2 mt-3">
          <div class="card-body">
            <div class="tab-content" id="myTabContent">

              <div class="col-lg-12">
                <div class="card1">
                  <div class="card-body1">
                    <!-- ------------------------------------------- -->
                    <div class="obselete_beni">
                      <div>
                          <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i>  Obsolete Benificiary Maintainence</h5>
                      </div>
                      <div>
                          <button type="button" class="btn btn-primary mt-4 obselete_beni_add" data-toggle="modal" data-target="#absoleteDataModal" id="addObsoleBenificiaryBtn">+ Add</button>
                      </div>
                  </div>
                  <!-- ----------------------------------------------- -->
                    <div class="clear-both"></div>
                    <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                      <div class="table-responsive">
                        <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="t_obsole_beneficiary" aria-describedby="t_obsole_beneficiary_info">
                          <thead>
                            <tr>
                              <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Id</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme id</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme Name</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Obselete Type</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Remarks</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Status</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Created by</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Created ts</th>
                              <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="t_obsole_beneficiary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                            
                          </tbody>
                          <tfoot id=""></tfoot>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
          <!-- END: list card end here -->
          <!-- ----------------------------------------------------------------- -->
          <!-- ADD OBSOLETE BENEFICIARY DATA MODAL FORM -->
          <!-- ----------------------------------------------------------------- -->
              <div class="modal fade" id="addObsoleteModal" tabindex="-1" role="dialog" aria-labelledby="obsoleteModalLabel" aria-hidden="true" data-backdrop="static">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="obsoleteModalLabel">Add Obsolete Beneficiary</h4>
                            <button type="button" class="btn-close" id="close_obsoleteModalLabel" data-dismiss="modal" aria-label="Close"></button>
                        </div>
                      
                        <!-- Model Form -->
                        <div class="modal-body">
                            <form id="obsoleBeneficiary_dt_form" method="post">
                                <div class="row scheme-data mb-4">
                                    <div class="col-md-12">
                                        <label for="ddl_ischeme_name" class="form-label fw-bold">Schemes</label>
                                        <select class="form-select" id="ddl_ischeme_name" name="ddl_ischeme_name">
                                            <option value="">--Select Scheme--</option>
                                        </select>
                                      
                                        <div class="form-group">
                                            <label for="beneficiary_id" class="fw-bold">Beneficiary Id</label>
                                            <input type="text" class="form-control" name="beneficiary_id" id="beneficiary_id" placeholder="Enter Beneficiary Id" required autocomplete="off">
                                        </div>
                                      
                                        <div class="form-group">
                                            <label for="obsele_typ" class="form-label fw-bold">Obsolete Type</label>
                                            <select class="form-select" id="add_obsolete_type" name="add_obsolete_type">
                                                <option value="">--Select Type--</option>
                                            </select>
                                        </div>
                                      
                                        <div class="form-group">
                                            <label for="status" class="fw-bold">Status</label>
                                            <div class="formElementRadio">
                                                <input type="radio" id="blocked_add" name="status" value="true"><label for="statusActive">Block</label>
                                                <input type="radio" id="unblocked_add" name="status" value="false"><label for="statusInActive">Unblock</label>
                                            </div>
                                        </div>
                                      
                                        <div class="form-group">
                                            <label for="obsolete_remarks" class="fw-bold">Remarks</label>
                                            <textarea class="form-control" id="add_remarks" name="add_remarks" rows="2" placeholder="Enter Remarks"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary cancel_addObsoleteModal" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="saveObsoleteBeneficiaryBtn">Save</button>
                        </div>
                    </div>
                </div>
              </div>
      <!-- --------------------------------------------------------- -->

              <div class="modal fade" id="confirmAddModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-success fw-bold" id="confirModalLabel">Please Confirm !!</h5>
                            <button type="button" id="close_confirmAddModal" class="btn-close" data-dismiss="modal" aria-label="Close"></button>                                                         
                        
                        </div>
                        <div class="modal-body">
                           <h5 class="modal-dialog-centered fw-bold"> Are you sure to confirm with the given details ?</h5>
                        </div>
                        <div class="modal-footer">
                            <button type="button"  data-dismiss="modal" class="btn btn-secondary" id="confirmAddNo">No</button>
                            <button type="button" class="btn btn-primary" id="confirmYes">Yes</button>
                        </div>
                    </div>
                </div>
              </div>

    <!-- ----------------------------------------------------------------- -->
    <!-- UPDATE OBSOLETE BENEFICIARY LIST -->
    <!-- ----------------------------------------------------------------- -->
              <div class="modal fade" id="updateObsoleteModal" tabindex="-1" role="dialog" aria-labelledby="absoleteDataModalLabel" aria-hidden="true" data-backdrop="static">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="absoleteDataModalLabel">Update Obsolete Beneficiary</h4>
                            <button type="button" class="btn-close" id="close_updateObsoleteModal" data-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="updateObsoleteBeneficiaryDetails" method="post">
                                <div class="row scheme-data mb-2">
                                    <div class="col-md-10">
                                          <label for="ddl_scheme_name" class="form-label fw-bold">Scheme</label>
                                          <p id="lbl_scheme_name" name="lbl_scheme_name">All</p>
                                      </div>
                                          <div class="form-group">
                                              <label for="update_beneficiary_id" class="form-label fw-bold">Beneficiary Id</label>
                                              <p name="txt_update_beneficiary_id" id="txt_update_beneficiary_id" ></p>
                                          </div>
                                    <div class="form-group">
                                        <label for="" class="form-label fw-bold">Obsolete Type</label>
                                        <select class="form-select" id="update_obsolete_type" name="update_obsolete_type">
                                            <option value="">--Select Type--</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="status" class="fw-bold">Status</label>
                                        <div class="formElementRadio">
                                            <input id="blocked_update" type="radio" name="status" value="true"><label for="statusActive">Block</label>
                                            <input id="unblocked_update" type="radio" name="status" value="false"><label for="statusInActive">Unblock</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="label_update_remarks" class="fw-bold">Remarks</label>
                                        <textarea class="form-control" id="update_remarks" rows="2" placeholder="Enter Remarks"></textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary cancel_updateObsoleteBeneficiaryBtn" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="updateObsoleteBeneficiaryBtn">Update</button>
                        </div>
                    </div>
                </div>
              </div>
  
        </div>
    </section>
</main>

<!-- =============================== -->
  <!-- ======= Footer ======= -->
<footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>TNeGA</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      Designed & Developed by <a href="https://tngis.tn.gov.in/" target="_blank">TNeGA</a>
    </div>
</footer>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
  
  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/main.js"></script>
  <!-- <script src="assets/vendor/multiselect/js/multiselect.js"></script>-->
  <script type="text/javascript" src="assets/vendor/jquery-validate/js/jquery.validate.min.js"></script>
  <!-- data table -->
  <script src="assets/vendor/datatable/jquery.dataTables.min.js"></script>
  <script src="assets/vendor/datatable/dataTables.bootstrap5.min.js"></script>
  <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.js"></script>
  <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.bootstrap4.js"></script>
  <script src="assets/vendor/datatables-buttons/js/dataTables.buttons.min.js"></script>
  <script src="assets/vendor/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
  <script src="assets/vendor/datatables-buttons/js/jszip.min.js"></script>
  <script src="assets/vendor/datatables-buttons/js/pdfmake.min.js"></script>
  <script src="assets/vendor/datatables-buttons/js/vfs_fonts.js"></script>
  <script src="assets/vendor/datatables-buttons/js/buttons.html5.min.js"></script>
  <script src="assets/vendor/datatables-buttons/js/buttons.print.min.js"></script>
  <script src="assets/vendor/datatables-buttons/js/buttons.colVis.min.js"></script>
  <script src="assets/vendor/sweetalert2/js/sweetalert.min.js"></script>
  <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
  <script src="assets/vendor/toggle/bootstrap-toggle.min.js"></script>
  <script src="assets/js/global.js"></script>
  <script src="assets/js/alpinejs_3_10_2.min.js" defer></script>
  <script src="assets/lang/reports.js"></script>
  <script src='https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js'></script>
  <!-- data table -->
  <script src="assets/vendor/sweetalert2/js/sweetalert.min.js"></script>
  <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
  <script type="text/javascript" src="assets/vendor/toastr/toastr.min.js"></script>
  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <script src="assets/js/global.js"></script>
  <script src="assets/js/base64tojson.js"></script>
  <script src="assets/js/crypto-js.js"></script>
  <script src="assets/js/aes.js"></script>
  <!-- Crypto js -->
  <script src="assets/vendor/encryption/crypto-js.min.js"></script>
  <!-- Encryption js -->
  <script src="assets/vendor/encryption/Encryption.js"></script>
  <script type="text/javascript">
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
  </script>

  <script type="text/javascript">
    $(document).on({

      ajaxStart: function () {
          $('#preloader').show();
            console.log('preloader is show');
      },

      ajaxStop: function () {
          $('#preloader').hide();
            console.log('preloader is show');
      }

    });

    var url = window.location.href;
    var page_url = url.split('/');
    var page = page_url[4];
    var userDataString = getCookie('payment_official');

    userDataString = JSON.parse(userDataString);

    $(document).ready(function () {
        $('.official').each(function (i, obj) {
            var href = obj.getAttribute("href");

                if (href == page) {
                  obj.classList.add('active');
                } else {
                  obj.classList.remove('active');
                }
          });
      
          $('#preloader').hide();

            var userDataString = getCookie('payment_official');
      
            if (!userDataString) {
              $('#preloader').show();        
              window.location.href = "login.html";
            }

        userDataString = JSON.parse(userDataString);
      
        $('#official_username').text(userDataString['first_name']);
        $('#UserID').val(userDataString['user_id']);
      
        window.loginUser_id = userDataString['user_id'];
        reloID = userDataString['role_id'];
      
          roleBasedPageAllow(loginUser_id, reloID);
          $('#user_id_hidden').val(loginUser_id);

getSchemeCategory();

      $('#ddl_sub_scheme').on('change', function () {
        
        $('#ddl_department').empty();
        $('#ddl_sub_department').empty();
        $('#ddl_department').append($('<option>', { value: "", text: "--All--" }));
        $('#ddl_sub_department').append($('<option>', { value: "", text: "--All--" }));

        $.ajax({
          url: APIURL + 'obsolete_beneficiary_filter',
          type: "POST",
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: { case: "get_department", scheme_code: $('#ddl_scheme_code').val(), scheme_name: $('#ddl_scheme_name').val(), sub_scheme_name: $('#ddl_sub_scheme').val(), whereColumn:$('#ddl_scheme_cate').val(),user_id: loginUser_id },
          
          success: function (response) {
            console.log("department:", response);
            var department_code = response.data[0];
            console.log(department_code.department);
            getDepartment(department_code.department);
          },
          error: function (xhr, status, error) {
            console.log("Error:", error);
          }
        });
      });

//**********************************************\\

      $('#addObsoleBenificiaryBtn').on('click',function(){
        $('#addObsoleteModal').modal('show');
      });
      //------------CLOSE POPUP MODAL WINDOW------------
      $('#close_obsoleteModalLabel, #close_updateObsoleteModal, #close_confirmUpdateModal, #close_confirmAddModal').click(function(e){
        $('#addObsoleteModal, #updateObsoleteModal, #confirmAddModal, #confirmUpdateModal').modal('hide');
      });
           
      //------------CANCEL POPUP MODAL WINDOW------------

      $('.cancel_addObsoleteModal, .cancel_updateObsoleteBeneficiaryBtn, #confirmUpdateNo, #confirmAddNo').click(function(e){
        $('#addObsoleteModal, #updateObsoleteModal, #confirmUpdateModal, #confirmAddModal').modal('hide');

      });
      //------------------------------------------------\\
      $('#confirmAddNo, #confirmUpdateNo').click(function(e){
        $('#confirmAddModal, #confirmUpdateModal').modal('hide');
        });       
      //--------------------------------------------------\\
      //VALIDATIONS
      
      $('#beneficiary_id').on('keypress', function(event) {
          var charCode = event.which ? event.which : event.keyCode;
          var charStr = String.fromCharCode(charCode);
            if (isNaN(charStr) || $(this).val().length >= 12) {
                event.preventDefault();
            }
        });

      $("#beneficiaryId").on('input', function() {
        var searchId = $(this).val();
        filterData(searchId);
      });

    });

  function getCookie(name) {
      const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.startsWith(name + '=')) {
            return cookie.substring(name.length + 1);
          }
        }
      return null;
    }

    /* filters */
  function getSchemeCategory() {

      $('#ddl_scheme_name').empty();
      $('#ddl_sub_scheme').empty();
      $('#ddl_department').empty();
      $('#ddl_sub_department').empty();
      $('#ddl_ischeme_name').empty();

      $('#ddl_ischeme_name').append($('<option>', {value: "", text: "--All--"}));
      $('#ddl_scheme_name').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_sub_scheme').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_department').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_sub_department').append($('<option>', { value: "", text: "--All--" }));

      $.ajax({
        url: APIURL + 'obsolete_beneficiary_filter',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { case: "get_scheme_category", get_column: "scheme_code", groupbycolumn: "scheme_code", user_id: loginUser_id },
        success: function (response) {
          
          var schemeCode = response.data;
            $('#ddl_scheme_cate').empty();
            $('#ddl_scheme_cate').append($('<option>', {value: "", text: "--All--"}));

          $.each(schemeCode, function (index, scheme) {
            
            if (schemeCode.length > 1) {
              $('#ddl_scheme_cate').append($('<option>', {value: scheme.scheme_category, text: scheme.scheme_category}));
            } else {
              $('#ddl_scheme_cate').append($('<option>', {value: scheme.scheme_category, text: scheme.scheme_category}).prop('selected', true));
              $('#ddl_scheme_cate').trigger('change');
            }
          });
        },
        error: function (xhr, status, error) {
          console.log("Error:", error);
        }
      });
    }


    $('#ddl_scheme_cate').on('change', function () {

      $('#ddl_scheme_code').empty();
      $('#ddl_scheme_name').empty();
      $('#ddl_sub_scheme').empty();
      $('#ddl_department').empty();
      $('#ddl_sub_department').empty();

      $('#ddl_scheme_code').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_scheme_name').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_sub_scheme').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_department').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_sub_department').append($('<option>', { value: "", text: "--All--" }));
        
      $.ajax({
        url: APIURL + 'obsolete_beneficiary_filter',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { case: "get_scheme_code", get_column: "scheme_code", groupbycolumn: "scheme_code", whereColumn: $('#ddl_scheme_cate').val(), user_id: loginUser_id },
        success: function (response) {
          var schemeCode = response.data;

          $('#ddl_scheme_code').empty();
          $('#ddl_scheme_code').append($('<option>', {
            value: "",
            text: "--All--"
          }));
          $.each(schemeCode, function (index, scheme) {
            if (schemeCode.length > 1) {
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
              }));
            
            } else {
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
              }).prop('selected', true));
              // $('#ddl_scheme_code').trigger('change');
            }
          });
          $('#ddl_scheme_code').trigger('change');
          getObsoleteBeneficiaryList();
        },
        error: function (xhr, status, error) {
          console.log("Error:", error);
        }
      });
    })
   
    $('#ddl_scheme_code').on('change', function () {
    $('#ddl_sub_scheme').empty();
    $('#ddl_scheme_name').empty();
    $('#ddl_sub_scheme').empty();
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();
    $('#ddl_ischeme_name').empty().append($('<option>', { value: "", text: "--Select Scheme--" }));
    $('#add_obsolete_type').empty().append($('<option>', { value: "", text: "--Select Type--" }));
    $.ajax({
        url: APIURL + 'obsolete_beneficiary_filter',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { case: "get_scheme", scheme_code: $('#ddl_scheme_code').val(),whereColumn:$('#ddl_scheme_cate').val(), user_id: loginUser_id },
        success: function (response) {
            var schemeCode = response.data;

            $('#ddl_scheme_name').empty().append($('<option>', { value: "", text: "--All--" }));
            $('#ddl_ischeme_name').empty().append($('<option>', { value: "", text: "--Select Scheme--" }));
            $.each(schemeCode, function (index, scheme) {
                if (schemeCode.length > 1) {
                    $('#ddl_scheme_name').append($('<option>', {
                        value: scheme.scheme_code,
                        text: scheme.scheme_name
                    }));
                   
                } else {
                    $('#ddl_scheme_name').append($('<option>', {
                        value: scheme.scheme_name,
                        text: scheme.scheme_name
                    }).prop('selected', true));
                    // $('#ddl_scheme_name').trigger('change');
                }
            });
            $('#ddl_ischeme_code').empty().append($('<option>', { value: "", text: "--Select Scheme--" }));

            $.each(schemeCode, function (index, scheme) {
                $('#ddl_ischeme_code').append($('<option>', {
                    value: scheme.scheme_code,
                    text: scheme.scheme_code
                }));
              });
              $('#ddl_scheme_name').trigger('change');
              getObsoleteBeneficiaryList();
        },
        error: function (xhr, status, error) {
            console.log("Error:", error);
        }
    });
});

    $('#ddl_scheme_name').on('change', function () {
      $('#ddl_sub_scheme').empty();
      $('#ddl_department').empty();
      $('#ddl_sub_department').empty();
      
      $('#ddl_sub_scheme').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_department').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_sub_department').append($('<option>', { value: "", text: "--All--" }));
        
      $.ajax({
        url: APIURL + 'obsolete_beneficiary_filter',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { case: "get_sub_scheme", scheme_code: $('#ddl_scheme_code').val(), scheme_name: $('#ddl_scheme_name').val(), whereColumn:$('#ddl_scheme_cate').val(),user_id: loginUser_id },
        success: function (response) {
          console.log("Success:", response);
          var schemeCode = response.data;
          console.log(schemeCode.scheme_code);
          $('#ddl_sub_scheme').empty();
          $('#ddl_sub_scheme').append($('<option>', {value: "", text: "--All--"}));
          $.each(schemeCode, function (index, scheme) {
            if (schemeCode.length > 1) {
              $('#ddl_sub_scheme').append($('<option>', {
                value: scheme.subscheme_name,
                text: scheme.subscheme_name
              }));
            } else {
              $('#ddl_sub_scheme').append($('<option>', {
                value: scheme.subscheme_name,
                text: scheme.subscheme_name
              }).prop('selected', true));
              $('#ddl_sub_scheme').trigger('change');
            }
          });
          $('#ddl_sub_scheme').trigger('change');
          getObsoleteBeneficiaryList();
        },
        error: function (xhr, status, error) {
          console.log("Error:", error);
        }
      });

    });



//**********//\\Update Obsolete Beneficiary Data//\\*************\\
//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\

$('#updateObsoleteBeneficiaryBtn').on('click',function(event){
       event.preventDefault();
       var userDataString = getCookie('payment_official');
           userDataString = JSON.parse(userDataString);
       var loginUser_id = userDataString['user_id'];

       
     $.ajax({
            url: APIURL + 'obsolete_beneficiary_update',
            type: 'POST',
            dataType: 'json',
            headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },

            data:{
              lbl_scheme_name: $('#lbl_scheme_name').text(),
              txt_update_beneficiary_id : $('#txt_update_beneficiary_id').text(),
              update_obsolete_type: $('#update_obsolete_type').val(),
              update_remarks: $('#update_remarks').val(),
              user_id: loginUser_id,
            },

      success: function(response){
          if(response.success){
              Swal.fire({
                   icon: "success",
                   title: response.message,
                   showConfirmButton: false,
                   timer: 2000
                });
                  $("#updateObsoleteBeneficiaryDetails")[0].reset();
                  $("#updateObsoleteModal").modal('hide');
                  refreshOf();
            }else{
                  Swal.fire({
                      icon: "error",
                      title: response.message,
                      showConfirmButton: false,
                      timer: 2000
                  });
              }
          }
      });
  });

//Reload the datatable instance//
function refreshOf() {
      $('#t_obsole_beneficiary').DataTable().ajax.reload();
}

function getObsoleteType(ddl,obsolete_type) {
  $.ajax({
          url: APIURL + 'fn_general_getdropdownvalues',
          type: "POST",
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: { user_id: userDataString['user_id'],
                  dropdown_type: "ObsoleteType" },
      success: function (response) {
          if (response.success === 1) {
              var obsoleteTypes = response.data;
              $(ddl).empty().append($('<option>', { value: "", text: "--Select Type--" }));
              $.each(obsoleteTypes, function (index, type) {
                  $(ddl).append($('<option>', {
                      value: type.id,
                      text: type.display_text
                  }));
              });
              $("#update_obsolete_type option[value='"+obsolete_type+"']").prop('selected', true); 
              $("#add_obsolete_type option[value='"+obsolete_type+"']").prop('selected', true); 

          } else {
              console.log("Error: " + response.message);
          }
      },
      error: function (xhr, status, error) {
          console.log("Error:", error);
      }
  });
}
function showObsoleteBeneficiaryDetails(is_blocked, scheme_name, beneficiary_id, obsolete_type, obsolete_Remarks) {
    $('#lbl_scheme_name').text(scheme_name);
    $('#txt_update_beneficiary_id').text(beneficiary_id);
    getObsoleteType("#update_obsolete_type",obsolete_type);    
    if (is_blocked == "1")
    {
      $('#blocked_update').prop('checked', true);
    }
    else 
    {
      $('#unblocked_update').prop('checked', true)
    }
    $('#update_remarks').val(obsolete_Remarks);  
}
function populateSchemeNames(schemeNames) {
    var ddlScheme = $('#ddl_ischeme_name');
    ddlScheme.empty(); 
    ddlScheme.append($('<option>', { value: "", text: "--Select Scheme--" }));
    schemeNames.forEach(function(schemeName) {
        ddlScheme.append($('<option>', { value: schemeName, text: schemeName }));
    });
}

function populateAllSchemes() {
    var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    var loginUser_id = userDataString['user_id'];
    $('#ddl_ischeme_name').empty();
    $('#ddl_ischeme_name').append($('<option>', { value: '', text: '-- Select Scheme --' }));
   $.ajax({
        url: APIURL + 'getAllSchemes',
        type: 'POST',
        dataType: 'JSON',
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: {
            user_id: userDataString['user_id']
        },
        success: function (response) {
          if (response && response.length > 0) {
                $.each(response, function(index, scheme) {
                    $('#ddl_ischeme_name').append($('<option>', {
                        value: scheme.scheme_id,
                        text: scheme.scheme_name
                    }));
                });
            } else {
                console.log('No schemes found for the user');
            }
        },
        error: function (xhr, status, error) {
            console.log("Error:", error);
        }
    });
}

$('#addObsoleBenificiaryBtn').on('click', function() {
    var obsolete_type = ""; 
    getObsoleteType("#add_obsolete_type", obsolete_type);
    populateAllSchemes();
    
});

//**********//\\ADD OBSOLETE BENEFICIARY DATA//\\*************\\
//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\
$('#saveObsoleteBeneficiaryBtn').on('click', function(event) {
    event.preventDefault();
    if ($("#obsoleBeneficiary_dt_form").valid()) {
       $('#confirmAddModal').modal('show');
        $('#addObsoleteModal').modal('hide');
    }
    
  });

$('#confirmYes').on('click', function() {
    var formData = $("#obsoleBeneficiary_dt_form").serialize();
    var userDataString = getCookie('payment_official');
        userDataString = JSON.parse(userDataString);
    var loginUser_id = userDataString['user_id'];
    $.ajax({
        url: APIURL + 'obsolete_beneficiary_add',
        type: 'POST',
        dataType: 'json',
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: formData,
        success: function(response) {
            if (response.success) {
              Swal.fire({
                   icon: "success",
                   title: response.message,
                   showConfirmButton: false,
                   timer: 2000
              });
              $("#obsoleBeneficiary_dt_form")[0].reset();
              $("#confirmAddModal").modal('hide');
              // $('#t_obsole_beneficiary').DataTable().ajax.reload();
              refreshOf();
            } else {
              Swal.fire({
                    icon: "error",
                    title: response.message,
                    showConfirmButton: false,
                    timer: 2000
              });
            }
        },
        error: function(xhr, status, error) {
            console.error(xhr.responseText);
            alert('An error occurred while processing your request. Please try again.');
        }
    });
});

//**********//\\FILL VALIDATION//\\*************\\
//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\

  $( "#obsoleBeneficiary_dt_form").validate({
        rules: {
            ddl_ischeme_name: { required: true },
            beneficiary_id: { required: true },
            add_remarks: { required: true },
            add_obsolete_type: { required: true }
        },
        messages: {
            ddl_ischeme_name: { required: "Please select a scheme" },
            beneficiary_id: { required: "Please enter beneficiary ID" },
            add_remarks: { required: "Please enter the Remarks" },
            add_obsolete_type: { required: "Please enter the obsolete Type" }
        },
        errorClass: "help-inline text-danger",
        errorElement: "span",
        highlight: function(element, errorClass, validClass) {
            $(element).parents('.form-group').addClass('has-error');
        },
        unhighlight: function(element, errorClass, validClass) {
            $(element).parents('.form-group').removeClass('has-error');
            $(element).parents('.form-group').addClass('has-success');
        }
    });
//Declare variable
let tableRecordCount = '';

getObsoleteBeneficiaryList();
  function getObsoleteBeneficiaryList() {
      var userDataString = getCookie('payment_official');
      userDataString = JSON.parse(userDataString)
      var loginUser_id = userDataString['user_id'];
      let schemeCate = $('#ddl_scheme_cate').val();
      let schemeCode = $('#ddl_scheme_code').val();
      let schemeName = $('#ddl_scheme_name').val();
      let subScheme = $('#ddl_sub_scheme').val();
      let department = $('#ddl_department').val();
      let subDepartment = $('#ddl_sub_department').val();
      var getInput = [];

      var allFields = [
        {
          inputValue: schemeCate,
          case: 'filter_scheme_category',
        },
        {
          inputValue: schemeCode,
          case: 'filter_scheme_code',
        },
        {
          inputValue: schemeName,
          case: 'filter_scheme_name',
        },
        {
          inputValue: subScheme,
          case: 'filter_subscheme',
        },
        {
          inputValue: department,
          case: 'filter_deparment',
        },
        {
          inputValue: subDepartment,
          case: 'filter_sub_deparment',
        }
      ];

      allFields.forEach(input => {
        if (input.inputValue !== null && input.inputValue !== "" && input.inputValue !== undefined) {
          getInput.push(input); 
        }
      });

      $('#t_obsole_beneficiary').DataTable().clear().destroy();
      $('#t_obsole_beneficiary').DataTable({
        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        "paging":true,
        "pageLength": 30,
        "footer": false,
        "dom": 'Bfrtip',
        "buttons": [
          {
            extend: 'csv',
            text: 'CSV',
            filename: 'Obsolete Beneficiary Lists',
            exportOptions: {
              rows: ':visible', 
                modifier: {
                  selected: null
                }
              }
            },
          {
            extend: 'excel',
            text: 'Excel',
            filename: 'Obsolete Beneficiary Lists' 
            },
          {
            extend: 'pdf',
            text: 'PDF',
            filename: 'Obsolete Beneficiary Lists' 
            }],

          "searching": true,
          "processing": true,
          "serverSide": true,
          "ajax": {
          "url": APIURL + 'obsolete_beneficiary_list',
          "type": "POST",
          "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          "dataType": "JSON",
            data: {
              fileters: getInput,
              user_id: loginUser_id
            },            
          "beforeSend": function () {
            $('#preloader').show(); // Show the preloader before sending the request
            tblPreloaderEnable('t_obsole_beneficiary');
          },

          "error": function (xhr, error, thrown) {
            Swal.fire({
              icon: "error",
              title: 'Service Error !',
              showConfirmButton: false,
              timer: 2000
            });
          },
          "dataSrc": 'data',
        },
        "columns": [
          {
            "data": "S.No", render: function (data, type, row, meta) {
              return meta.row + meta.settings._iDisplayStart + 1;
            }
          },
          { "data": "benificiary_id" },
          { "data": "scheme_id" },
          { "data": "scheme_name" },
          { "data": "obsolete_type_text" },
          { "data": "obsolete_remarks" },
          { "data": "is_active" },
          { "data": "updated_by" },
          { "data": "updated_ts" },
          { "data": "action" },
        ],
        "aoColumnDefs": [{ 'bSortable': false, 'aTargets': [0]}],
        "drawCallback": function (settings) {
        },
        "initComplete": function (settings, json) {
          $('#preloader').hide();
          tableRecordCount = json.recordsTotal;
        },
      }); 
       
  }
  
   
  function getDepartment(depID) {
      $('#ddl_department').empty();
      $('#ddl_sub_department').empty();

      $('#ddl_department').append($('<option>', { value: "", text: "--All--" }));
      $('#ddl_sub_department').append($('<option>', { value: "", text: "--All--" }));
        let scheme_cate = $('#ddl_scheme_cate').val();  
        $.ajax({
                    url: APIURL + 'get_department',
                    type: "POST",
                    headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
                    data: { type: "department" },
              success: function (response) {
                    var department = response[0].data;
                    // $('#ddl_department').empty();
                    // $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
                      if(scheme_cate == '' || scheme_cate === 0){
                              $('#ddl_department').empty();
                              $('#ddl_department').append($('<option>', {val: '', text: '--All--' }));
                              $('#ddl_payment_cycle').empty();
                              $('#ddl_payment_cycle').append($('<option>', {val: '', text: 'Scheme Based Payment Period' }));
                        }
                        else
                        {
                      $.each(department, function (index, dep) {
                      if (dep.department_code == depID) {
                        $('#ddl_department').append($('<option>', {value: dep.department_code, text: dep.department_name}).attr('selected', 'selected'));
                      
                          $.ajax({
                              url: APIURL + 'obsolete_beneficiary_filter',
                              type: "POST",
                              headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
                              data: { case: "get_sub_department", scheme_code: $('#ddl_scheme_code').val(), scheme_name: $('#ddl_scheme_name').val(), sub_scheme_name: $('#ddl_sub_scheme').val(), department: $('#ddl_department').val(), whereColumn:$('#ddl_scheme_cate').val(),user_id: loginUser_id },
                        success: function (response) {
                              console.log("department:", response);
                              var subdepartment_code = response.data[0];
                              console.log(subdepartment_code.department);
                              get_sub_department(dep.department_code, subdepartment_code.subdepartment);
                        },
                          error: function (xhr, status, error) {
                              console.log("Error:", error);
                          }
                      });

                    }
              });
            }
        },
          error: function (xhr, status, error) {
            console.log("Error:", error);
                // Handle the error here
          }
      });
  }


    // $('#ddl_department').on('change',function(){
    function get_sub_department(depID, subDepID) {
      $('#ddl_sub_department').empty();
      $('#ddl_sub_department').append($('<option>', { value: "", text: "--All--" }));

      // var department = $('#ddl_department').val();
      $.ajax({
        url: APIURL + 'get_department',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { type: "sub_department", whereColumn:$('#ddl_scheme_cate').val(),department_code: depID },
        success: function (response) {
          // console.log("Success:",JSON.parse(response)[0].data );
          var department = response[0].data;
          // Handle the successful response here
          $('#ddl_sub_department').empty();
          $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
          // Iterate over the JSON object and append options
          $.each(department, function (index, sub_dep) {
            if (sub_dep.sub_department_code == subDepID) {
              $('#ddl_sub_department').append($('<option>', { value: sub_dep.sub_department_code, text: sub_dep.sub_department_name}).attr('selected', 'selected'));
            }
          });
        },
        error: function (xhr, status, error) {
          console.log("Error:", error);
          // Handle the error here
        }
      });
    }
    // });

    function tblPreloaderEnable(tableName) {
      var processingDiv = document.getElementById(tableName + '_processing');
      var displayStatus = window.getComputedStyle(processingDiv).display;
      if (displayStatus === 'block') {
        $('#' + tableName + '_processing').html(`<div id="preloader"></div>`);
      } else {
        $('#' + tableName + '_processing').text(`<div id="preloader"></div>`);
      }
    }


    function bindDropDownList(type, element) {
      var userDataString = getCookie('payment_official');
      userDataString = JSON.parse(userDataString);
      window.loginUser_id = userDataString['user_id'];

      if (typeof type === 'object') {
        type = type[0];
      }

      $.ajax({
        url: APIURL + 'fn_general_getdropdownvalues',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { user_id: loginUser_id, dropdown_type: type },
        success: function (response) {
          console.log(response.data);

          var dropdownList = response.data;
          $(element).empty();
          $(element).append($('<option>', {
            value: "",
            text: "Select " + type
          }));
          // Iterate over the JSON object and append options
          $.each(dropdownList, function (index, dep) {
            $(element).append($('<option>', {
              value: dep.id,
              text: dep.display_text
            }));
          });


        },
        error: function (xhr, status, error) {
          $('#preloader').hide();
          console.log("Error:", error);
          // Handle the error here
        }
      });
    }

    async function dropDownList(type) {
      try {
        var userDataString = getCookie('payment_official');
        userDataString = JSON.parse(userDataString);
        window.loginUser_id = userDataString['user_id'];

        const response = await $.ajax({
          url: APIURL + 'fn_general_getdropdownvalues',
          type: "POST",
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: { user_id: loginUser_id, dropdown_type: type }
        });

        // console.log(response.data);
        return response.data;
      } catch (error) {
        console.error("Error:", error);
        throw error;
      }
    }

    async function fetchDropdownValues(type) {
      try {
        let getDropDown = await dropDownList(type);
        // console.log(`type >>`, getDropDown);
        return getDropDown;
      } catch (error) {
        console.error('Error occurred:', error);
      }
    }

  </script>
</body>

</html>