<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Payment Automation Dashboard</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    <!-- Favicons -->
    <link href="assets/img/tn_logo.png" rel="icon">
    <link href="assets/img/tn_logo.png" rel="apple-touch-icon">
    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
    <!-- <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.rtl.min.css'> -->
    
    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> -->
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css'>
    <link rel="stylesheet" href="assets/vendor/sweetalert2/css/sweetalert.min.css" />
    <link rel="stylesheet" href="assets/vendor/sweetalert2/css/sweetalert2.min.css" />
    <!-- <link rel="stylesheet" href="assets/vendor/toggle/bootstrap-toggle.min.css" /> -->
    <!-- CSS File --> 
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css"> -->
    <script src="assets/components/official_header.js" type="text/javascript" defer></script>

    
  </head>
  <body>

    <style>
        span#pending_approval_processing {
        position: absolute;
        top: 4.5rem;
        left: 15rem;
        width: auto;
        }
        span#progress_strat {
        position: absolute;
        top: 4.5rem;
        left: 15rem;
        width: auto;
        }
        .text-danger {
        font-size: 13px;
        font-weight: bold;
        }
        div.pamentDateGroup {
        position: absolute;
        right: 19rem;
        margin-top: -19px;
        font-weight: bold;
        font-size: smaller;
        width: 244px;
        }
        span#paymentDate_error {
        position: absolute;
        bottom: -22px;
        }
        ul#myTab .nav-link{
        margin-top: 0.7rem;
        }
        div.pamentDateGroup {
        position: absolute;
        right: 19rem;
        margin-top: -19px;
        font-weight: bold;
        font-size: smaller;
        width: 244px;
        }
        span#paymentDate_error {
        position: absolute;
        bottom: -22px;
        }
        .bi-check-lg::before,.bi-x-lg::before {
        font-size: 2rem;
        }
        .function_1_td,.function_2_td,.function_3_td,.function_4_td{
        vertical-align: middle;
        text-align: center;
        }
        .fs-custom-dummy{
        font-size: medium;
        font-weight: bold;
        }
        .cursor-auto{
        cursor: auto!important;
        }
        .font-custom-lable{
        font-size: 12px!important;
        }
        .font-custom-text{
          font-size: 12px!important;
          color:brown;
        }
        

        #tblPaymentFailedList_wrapper>.dt-buttons.btn-group.flex-wrap {
          position: absolute;
          right: 0;
          margin-top: -3rem;
          margin-right: 2rem;
        }
        table{
          margin-top: 4rem;
        }

        div#tblPaymentFailedList_filter {
          position: absolute;
          margin-top: -4rem;
        }

        .left-vr-line {
          border-left: 0.1rem solid #cececf;
        }
        .accordion-button:not(.collapsed)::after, .accordion-button::after {
          filter: invert(1) grayscale(100%) brightness(200%)!important;
        }

        .accordion-item, .accordion-button:not(.collapsed){
          border: none!important;
        }
        p#ddl_payment_cycle {
          border: 1px solid #d0d6dc;
          padding: 0.6rem;
          margin-top: rem;
          border-radius: 5px;
          font-size: 1rem;
        }

        lable.failure_reason_lable {
            width: 219px!important;
            position: absolute;
            /* margin-top: 4.7rem; */
            margin-left: 1rem;
            font-size: 14px;
            color: #6b6765;
            font-weight: 400;
            top: 9.5rem;
        }
        a.dropdown-item:hover {
          cursor: pointer;
        }
        #tblPaymentFailedList_wrapper>.dt-buttons.btn-group.flex-wrap {
          position: absolute;
          right: 0;
          margin-top: -3rem;
          margin-right: 2rem;
        }
        table{
          margin-top: 4rem;
        }

        div#tblPaymentFailedList_filter {
          position: absolute;
          margin-top: -4rem;
        }

        .left-vr-line {
          border-left: 0.1rem solid #cececf;
        }
        .font-custom-lable{
          font-size: 12px!important;
        }
        .font-custom-text{
          font-size: 12px!important;
          color:brown;
        }
        #checkTaluk_lable {
          float: right;
          background: #2a275d;
          color: #fff;
          padding-right: 0.6rem;
          padding-left: 1rem;
          border-radius: 3px;
        }
        .card-lg-blue-text {
          background-color: #2c93b4 !important;
          color: #fff;
          font-size: 14px;
          font-weight: bold;
        }
        .card-lg-orange-text {
          background: #c09012 !important;
          color: #fff;
          font-size: 14px;
          font-weight: bold;
        }
        .accordion-item, .accordion-button:not(.collapsed){
          border: none!important;
        }
        p#ddl_payment_cycle {
          border: 1px solid #d0d6dc;
          padding: 0.6rem;
          margin-top: rem;
          border-radius: 5px;
          font-size: 1rem;
        }

        .bootstrap-select:not(.input-group-btn), .bootstrap-select[class*=col-] {
        float: none;
        display: block;
        }
        .bootstrap-select:not([class*=col-]):not([class*=form-control]):not(.input-group-btn) {
        width: 100%;
        padding: 0.2rem;
        }
        button.btn.dropdown-toggle.btn-light {
        padding: 1px !important;
        font-size: 15px;
        color: #000;
        }
.filter-option-inner-inner:focus-visible {
    border:none;
}
#accordionExample .accordion-body{
  overflow: visible!important;
}
.btn-light:focus, .btn-light:focus-visible,.btn-light:hover{
    outline: none !important; 
    box-shadow: none !important; 
}

span.badge.custom-btn {
    background: #f2eb00c2!important;
    color: red!important;
}


div#generate_file_status_cards .card span {
    font-size: 0.7rem!important;
    color:#fff;
}

div#generate_file_status_cards .card h3 {
    font-size: 0.7rem!important;
}
div#tranfer_to_bank_file_status_cards .card span {
    font-size: 0.7rem!important;
    color:#fff;
}

div#tranfer_to_bank_file_status_cards .card h3 {
    font-size: 0.7rem!important;
}
.bg-blue {
    background: #012970;
    color:#fff;
}
    </style>
    <!-- ======= Header & sidemenu ======= -->
    <official-header-component></official-header-component>
    <div id="preloader"></div> 
    <!-- End Sidebar-->
    <main id="main" class="main">
      <!-- Dashboard view starts -->
      <section>
        <div class="container-fluid">
          <div class="card mb-1">
            <!-- <form id="formFilters" method="post">
              <div class="card-body pb-0 pt-2">
                <div class="accordion" id="accordionExample">
                  <div class="accordion-item">
                     <h2 class="accordion-header">
                        <button id="btnfilter" style="    background: linear-gradient(to right, rgb(44 43 88), rgb(34 25 111)) !important;
                           color: #fff !important;" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        <i class="bi bi-funnel"></i>  <span class="px-2">Report Filter</span>
                        </button>
                     </h2>
                     <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                        <div class="accordion-body w-100">
                          <div class="row mb-2 boxflex">
                            <div class="col-md">
                              <label for="ddl_scheme_cate" class="form-label fw-bold">Scheme Category</label>
                              <select class="form-select" id="ddl_scheme_cate" name="ddl_scheme_cate">
                                <option value="1">--Select--</option>
                                <option value="1">Scheme category 1</option>
                                <option value="1">Scheme category 2</option>
                              </select>
                            </div>
                            <div class="col-md">
                              <label for="ddl_scheme_code" class="form-label fw-bold">Scheme Code</label>
                              <select class="form-select" id="ddl_scheme_code" name="ddl_scheme_code">
                                <option value="">--Select--</option>
                              </select>
                            </div>
                            <div class="col-md">
                              <label for="ddl_scheme_name" class="form-label fw-bold">Scheme Name</label>
                              <select class="form-select" id="ddl_scheme_name" name="ddl_scheme_name">
                                <option value="1">--Select--</option>
                              </select>
                            </div> 
                            <div class="col-md"> 
                              <label for="ddl_sub_scheme" class="form-label fw-bold">Sub Scheme Name</label>
                              <select class="form-select" id="ddl_sub_scheme" name="ddl_sub_scheme">
                              </select>
                            </div>
                            <div class="col-md">
                              <label for="ddl_department" class="form-label fw-bold">Department</label>
                              <select class="form-select" id="ddl_department" name="ddl_department">
                                <option value="1">--Select--</option>
                              </select>
                            </div>
                            <div class="col-md">
                              <label for="ddl_sub_department" class="form-label fw-bold">Sub Department</label>
                              <select class="form-select" id="ddl_sub_department" name="ddl_sub_department">
                                <option value="1">--Select--</option>
                              </select>
                            </div>
                          </div>
                          <hr>

                          <div class="row mb-2 boxflex">
                            <div class="col-md" id="ddl_payment_cycle_col">
                              <label for="from_date" class="form-label fw-bold mt-3">Payment Cycle</label>
                              <p id="ddl_payment_cycle">Scheme Based Payment Period</p>
                            </div>

                            <div class="col-md" id="ddl_payment_period_col">
                              <label for="from_date" class="form-label fw-bold">Select Payment Period</label>
                              <select name="ddl_payment_period" id="ddl_payment_period" class="form-select">
                                <option value="" disabled selected>Select Payment Period</option>
                              </select>
                            </div>

                            <div class="col-md" id="ddl_payment_installment_col">
                              <label for="from_date" class="form-label fw-bold">Select Installment</label>
                              <select name="ddl_payment_installment" id="ddl_payment_installment" class="form-select">
                                <option value="" disabled selected>Select Installment</option>
                              </select>
                            </div>

                            <div class="col-md" id="ddl_year_col">
                              <label for="to_date" class="form-label fw-bold">Select Year - Month</label>
                              <select name="ddl_year" id="ddl_year" class="form-select">
                                <option value="" disabled selected>Select Year and month</option>
                              </select>
                            </div>
                          </div>
                          <hr>
                          <div class="row boxflex mb-3">
                            <div class="col">
                              <label for="ddl_district" class="form-label fw-bold">District</label>
                              <select class="form-select" id="ddl_district" name="ddl_district">
                                <option value="">--Select--</option>
                              </select>
                            </div>
                            <div class="col">
                              <label for="ddl_taluk" class="form-label fw-bold">Taluk</label>
                              <select class="form-select" id="ddl_taluk" name="ddl_taluk">
                                <option value="">--Select--</option>
                              </select>
                            </div>
                            <div class="col left-vr-line">
                              <label for="ddl_beneficiary_id" class="form-label fw-bold">Beneficiary ID</label>
                              <input type="number" class="form-control" name="ddl_beneficiary_id" id="ddl_beneficiary_id" placeholder="Enter the Beneficiary ID / Aadhar no">
                            </div>
                          </div>
                          <div class="row mb-2 boxflex">
                            <button class="btn btn-success float-end cbtn col-md-2" type="submit" id="formSumit" ><i class="bi bi-pencil-square"></i> Submit</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

              </div>

              <input type="hidden" name="approvelpayment" id="approvelpayment">
              <input type="hidden" name="payment_date_input" id="payment_date_input">
              <input type="hidden" name="payment_cycle_hidden" id="payment_cycle_hidden">
              <input type="hidden" name="installment_txt_value" id="installment_txt_value">
            </form> -->

            <form id="formFilters" method="post">
              <div class="card-body pb-0 pt-2">
                 <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                       <h2 class="accordion-header">
                          <button id="btnfilter" style="    background: linear-gradient(to right, rgb(44 43 88), rgb(34 25 111)) !important;
                             color: #fff !important;" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                          <i class="bi bi-funnel"></i>  <span class="px-2">Apply Filter</span>
                          </button>
                       </h2>
                       <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                          <div class="accordion-body w-100">
                             <div class="row mb-2 boxflex">
                                <div class="col-md-3">
                                   <label for="ddl_scheme_cate" class="form-label fw-bold">Scheme category</label>
                                   <select class="form-select" id="ddl_scheme_cate" name="ddl_scheme_cate">
                                      <option value="">--Select--</option>
                                   </select>
                                </div>
                                <div class="col-md-3">
                                   <label for="ddl_scheme_code" class="form-label fw-bold">Scheme Code</label>
                                   <select class="form-select" id="ddl_scheme_code" name="ddl_scheme_code"><option value="">--Select--</option></select>
                                </div>
                                <div class="col-md-3">
                                   <label for="ddl_scheme_name" class="form-label fw-bold">Scheme Name</label>
                                   <select class="form-select" id="ddl_scheme_name" name="ddl_scheme_name">
                                      <option value="">--Select--</option>
                                   </select>
                                </div>
                                <div class="col-md-3">
                                   <label for="ddl_sub_scheme" class="form-label fw-bold">Sub Scheme Name</label>
                                   <select class="form-select" id="ddl_sub_scheme" name="ddl_sub_scheme">
                                      <option value="">--Select--</option>
                                   </select>
                                </div>
                                <div class="col-md-3">
                                   <label for="ddl_department" class="form-label fw-bold">Department</label>
                                   <select class="form-select" id="ddl_department" name="ddl_department">
                                      <option value="">--Select--</option>
                                   </select>
                                </div>
                                <div class="col-md-3">
                                   <label for="ddl_sub_department" class="form-label fw-bold">Sub Department</label>
                                   <select class="form-select" id="ddl_sub_department" name="ddl_sub_department">
                                      <option value="">--Select--</option>
                                   </select>
                                </div>
                             </div>
                             <hr>
                               <div class="row mb-2 boxflex">
                                <div class="col-md" id="ddl_payment_cycle_col">
                                  <label for="from_date" class="form-label fw-bold mt-3">Payment Cycle</label>
                                  <p id="ddl_payment_cycle">Scheme Based Payment Period</p>
                                </div>
    
                                <div class="col-md" id="ddl_payment_period_col">
                                  <label for="from_date" class="form-label fw-bold">Select Payment Period</label>
                                  <select name="ddl_payment_period" id="ddl_payment_period" class="form-select">
                                    <option value="" disabled selected>Select Payment Period</option>
                                  </select>
                                </div>
    
                                <div class="col-md" id="ddl_payment_installment_col">
                                  <label for="from_date" class="form-label fw-bold">Select Installment</label>
                                  <select name="ddl_payment_installment" id="ddl_payment_installment" class="form-select">
                                    <option value="" disabled selected>Select Installment</option>
                                  </select>
                                </div>
    
                                <div class="col-md" id="ddl_year_col">
                                  <label for="to_date" class="form-label fw-bold">Select Year - Month</label>
                                  <select name="ddl_year" id="ddl_year" class="form-select" data-live-search="true">
                                    <option value="" disabled selected>Select Year and month</option>
                                  </select>
                                </div>
                              </div>
                               <hr>
                               <div class="row boxflex mb-3">
                                 <div class="col">
                                   <label for="ddl_district" class="form-label fw-bold">District</label>
                                   <select class="form-select" id="ddl_district" name="ddl_district" data-live-search="true"><option value="">--All--</option></select>
                                 </div>
                                 <div class="col">
                                   <label for="ddl_taluk" class="form-label fw-bold">Taluk</label>
                                   <select class="form-select" id="ddl_taluk" name="ddl_taluk" data-live-search="true"><option value="">--All--</option></select>
                                 </div>                                  
                               </div>
                             <div class="row mb-2 boxflex">
                                <button class="btn btn-success float-end cbtn col-md-2" type="submit"><i class="bi bi-pencil-square"></i> Submit</button>
                             </div>
                          </div>
                          <!-- <input type="hidden" name="approvelpayment" id="approvelpayment"> -->
                       </div>
                    </div>
                 </div>
              </div>
              <input type="hidden" name="current_tab_value" id="current_tab_value" value="0">
              <input type="hidden" name="approvelpayment" id="approvelpayment">
              <!-- <input type="hidden" name="payment_date_input" id="payment_date_input"> -->
            <input type="hidden" name="payment_cycle_hidden" id="payment_cycle_hidden">
            <input type="hidden" name="installment_txt_value" id="installment_txt_value">
           </form>
          </div>

          <div class="card mb-1 mt-2" id="filter_based_info_card_div">
            <div class="card-body pb-0 pt-2 bg-info-light">
              <div class="row">
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Scheme Category</label>
                  <p id="lable_text_scheme_cate" class="text-left font-custom-text">KMUT</p>
                </div>
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Scheme Code</label>
                  <p id="lable_text_scheme_code" class="text-left font-custom-text">CD94U</p>
                </div>
                
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Scheme Name</label>
                  <p id="lable_text_scheme" class="text-left font-custom-text">KALAINGAR MAHALIR URIMAI THITTAM</p>
                </div>
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Sub Scheme Name</label>
                  <p id="lable_text_sub_scheme" class="text-left font-custom-text">kmut</p>
                </div>
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Department</label>
                  <p id="lable_text_Department" class="text-left font-custom-text">Revenue And Disaster Management Department</p>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Sub Department</label>
                  <p id="lable_text_sub_department" class="text-left font-custom-text">Revenue Administration</p>
                </div>
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Payment Year-month</label>
                  <p id="lable_text_year_month" class="text-left font-custom-text"></p>
                </div>
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Payment Period</label>
                  <p id="lable_text_payment_period" class="text-left font-custom-text"></p>
                </div>
                <div class="col">
                  <label class="form-label fw-bold font-custom-lable">installment</label>
                  <p id="lable_text_installment" class="text-left font-custom-text"></p>
                </div>
                <div class="col"></div>
                <!-- <div class="col">
                  <label class="form-label fw-bold font-custom-lable">Payment Date</label>
                  <select name="label_payment_date" id="label_payment_date" class="form-select text-center mb-2">
                    <option value="" disabled selected>Payment Date Not Found</option>
                  </select>
                </div> -->
              </div>                   
            </div>
          </div>


          <div class="card mb-2 mt-3" id="tblCard">
            <div class="card-body">
              <ul class="nav nav-tabs my-3" id="myTab" role="tablist">
                <!--  <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Scheme Registration</button>
                  </li> -->
                  <li class="nav-item mx-2" role="presentation">
                    <button class="nav-link active" id="upload-process-tab" data-bs-toggle="tab" data-bs-target="#upload-process-tab-pane" type="button" role="tab" aria-controls="upload-process-tab-pane" aria-selected="false" onclick="tabClickValue(7)">Pending for Validation</button>
                  </li>
                <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false" onclick="tabClickValue(0)">Pending for Approval</button>
                </li>
                <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="disabled-tab1" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane2" type="button" role="tab" aria-controls="disabled-tab-pane2" aria-selected="false" value="3" onclick="tabClickValue(4)"> Generate Payment File </button>
                </li>
                <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="disabled-tab1" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane3" type="button" role="tab" aria-controls="disabled-tab-pane3" aria-selected="false" value="3" onclick="tabClickValue(5)"> Transfer Payment File to Bank </button>
                </li>
                <!-- <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="disabled-tab1" data-bs-toggle="tab" data-bs-target="#payment-emo-tab-pane" type="button" role="tab" aria-controls="payment-emo-tab-pane" aria-selected="false" value="3" onclick="tabClickValue(8)"> Payment for EMO </button>
                </li> -->
                <!-- <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="disabled-tab1" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane1" type="button" role="tab" aria-controls="disabled-tab-pane" aria-selected="false" value="3" onclick="tabClickValue(3)">Payment In-Progress</button>
                </li>
                <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="false" onclick="tabClickValue(1)">Payment Success</button>
                </li> -->
                <li class="nav-item" role="presentation">
                  <button class="nav-link mx-2" id="disabled-tab" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane" type="button" role="tab" aria-controls="disabled-tab-pane" aria-selected="false" value="2" onclick="tabClickValue(2)">Payment Failed</button>
                </li>
              </ul>
              <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="upload-process-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i> Pending for Validation</h5>
                        <div class="row p-2">
                          <div class="col text-end">
                            <button class="btn btn-success" onclick="deduplicateValidate();" type="button">Validate Beneficiaries</button>
                          </div>

                          <div class="clear-both"></div>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            <table class="table mt-3 w-100" class="table table-striped w-100 no-footer dataTable mt-3" id="uploadDataList" aria-describedby="uploadDataList_info">
                              <thead>
                                <tr>
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>

                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">District</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Taluk </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year and Month</th>
                                  <!-- <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year Month</th> -->
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">APB </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Total</th>
                                </tr>
                                <tr>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>                    
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="uploadDataList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                              </tbody>

                              <tfoot id="uploadDataList_tfoot">
                              </tfoot>
                            </table>
                          </div>
                        </div>
                          
                          <!-- <div class="col">
                              <button class="btn btn-success" onclick="deduplicateValidate();" type="button">Deduplication Validate</button>
                          </div> -->
                          <!-- <div class="col">
                              <button class="btn btn-success" type="button" id="transferToPaymetProcessBtn" disabled onclick="showTranferPaymentProcess();">Transfer to Payment Process</button>
                          </div> -->

                          <div class="col"></div>
                          <div class="col"></div>
                      </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i>  Pending for Approve

                          <span class="badge text-bg-danger c-pointer pulse" id="pending_approval_processing" style="margin-left: 5rem;">
                            <i class="bi bi-pencil-square"></i> Approving beneficiaries in progress: <span class="text-white" id="pending_approval_processing_count"></span> out of <span class="text-white" id="pending_approval_processing_total_count"></span> completed 
                          </span>

                          <span class="badge text-bg-info c-pointer pulse" id="progress_strat" style="margin-left: 5rem;">
                            <i class="bi bi-pencil-square"></i> Data collection is ongoing
                          </span>
                          

                          <form  id="paymentDateForm" method="post">
                            <div class="input-group pamentDateGroup">
                              <label for="paymentDate" class="form-label fw-bold">payment Date</label>
                                <input class="form-control form-control-sm mx-auto" type="date" name="paymentDate" id="paymentDate" style="width: 220px;">
                              <span class="paymentDate_error text-danger" id="paymentDate_error">Select Paymet Date</span>
                            </div>
                          </form>

                          <a class="btn btn-success float-end cbtn" id="selectApproval" style="margin-left:3px;" onclick="selectApprove();"><i class="bi bi-check2-circle"></i> Approve</a>
                          <a class="btn btn-success float-end cbtn" id="bulkApproval" onclick="allApprove();"><i class="bi bi-check2-circle"></i> Bulk Approve</a>
                          
                          <button class="btn btn-success float-end cbtn" id="selectApprovalBtn" disabled style="margin-left:3px;"><i class="bi bi-check2-circle" ></i> Approve</button>
                          <button class="btn btn-success float-end cbtn" id="bulkApprovalBtn" disabled><i class="bi bi-check2-circle"></i> Bulk Approve</button>
                        </h5>
                        <div class="clear-both"></div>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            <table class="table mt-3" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymentPendingList" aria-describedby="tblPaymentPendingList_info">
                              <thead>
                                <tr>
                                  <th><input class="form-check-input" type="checkbox" id="selectAllCheckbox" name="selectAllCheckbox"></th>

                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Month </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Name</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Mobile No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH / ABP</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Installment</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Transcation Date</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentPendingList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Action</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i>  Payment Success 
                          <!-- <span class="badge text-bg-danger c-pointer pulse d-inline"><i class="bi bi-pencil-square"></i> 10254</span> -->
                        </h5>
                        <div class="clear-both"></div>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            
                            <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymentSuccessList" aria-describedby="tblPaymentSuccessList_info">
                              <thead>
                                <tr>
                                  <!-- <th scope="col"><input class="form-check-input" type="checkbox" value="" ></th> -->
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Month </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Name</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Mobile No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH / ABP</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Installment ID</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Transcation Date</th>
                                  <!-- <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Remarks</th> -->
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentSuccessList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Action</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

             

                 <!-- payment response failure -->
                 <div class="tab-pane fade" id="disabled-tab-pane" role="tabpanel" aria-labelledby="disabled-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i>  Payment Failed 
                          <!-- <span class="badge text-bg-danger c-pointer pulse d-inline"><i class="bi bi-pencil-square"></i> 10254</span> -->
                          <lable class="failure_reason_lable" for="failur_reason_filter"> Rejected Reasons:<select id="failur_reason_filter" class="form-control form-control-sm" placeholder="" aria-controls="tblPaymentFailedList"><option value="">All</option></select>
                          </lable>
                          <form  id="reinitiatePaymentDateForm" method="post">
                            <div class="input-group reinitiatePamentDateGroup" style="width: 200px;position: absolute;right: 21rem;top: 5.2rem;">
                              <label for="reinitiatePaymentDate" class="form-label fw-bold">payment Date</label>
                                <input class="form-control form-control-sm mx-auto" type="date" name="reinitiatePaymentDate" id="reinitiatePaymentDate" style="width: 220px;">
                              <span class="reinitiatePaymentDate_error text-danger" id="reinitiatePaymentDate_error">Select Paymet Date</span>
                            </div>
                          </form>


                          <div class="dropdown float-end cbtn">
                            <button class="btn btn-danger btn-sm dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                              Re-Initiate
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                              <a class="dropdown-item" onclick="reInitiateApprove();">Selected</a>
                              <a class="dropdown-item" onclick="bulkReInitiateApprove();">All</a>
                            </div>
                          </div>

                          <div class="dropdown float-end cbtn">
                            <button class="btn btn-primary btn-sm dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
                              Transfer to EMO
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                              <a class="dropdown-item" onclick="failureToEmoSelectApprove();">Selected</a>
                              <a class="dropdown-item" onclick="failureToEmoBulkApprove();">All</a>
                            </div>
                          </div>

                          <!-- <a class="btn btn-primary float-end cbtn" onclick="failureToEmoApprove();">Transfer to EMO</a> -->
                          <!-- <a class="btn btn-danger float-end cbtn" style="margin-right:10px" onclick="reInitiateApprove();">Re-Initiate</a> -->
                          <!-- <a class="btn btn-danger float-end cbtn" style="margin-right:10px" onclick="bulkReInitiateApprove();">Bulk Re-Initiate</a> -->
                        </h5>
                        <div class="clear-both"></div>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymentFailedList" aria-describedby="tblPaymentFailedList_info">
                              <thead>
                                <tr>
                                  <th><input class="form-check-input" type="checkbox" id="selectAllCheckbox2" name="selectAllCheckbox2"></th>
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Month </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Name</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Mobile No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH / ABP</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Installment</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Payment Date</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Remarks</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFailedList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Action</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                              </tbody>
                            </table>
                           
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- payment response failure -->

                <div class="tab-pane fade" id="disabled-tab-pane1" role="tabpanel" aria-labelledby="disabled-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <div id="dynamic_heading"></div>
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i> 
                          Payment In-Progress
                          <!-- <span class="badge text-bg-danger c-pointer pulse d-inline"><i class="bi bi-pencil-square"></i> 10254</span> -->
                        </h5>
                        <div class="clear-both"></div>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            <!-- tblPaymentInprogressList  this table ID -->

                            <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymentInprogressList" aria-describedby="tblPaymentInprogressList_info">
                              <thead>
                                <tr>
                                  <!-- <th><input class="form-check-input" type="checkbox" id="selectAllCheckbox" name="selectAllCheckbox"></th> -->
                                  <!-- <th scope="col"><input class="form-check-input" type="checkbox" value="" ></th> -->
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Month </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Name</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Mobile No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH / ABP</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Installment</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Transcation Date</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentInprogressList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Action</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                              </tbody>
                            </table>

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- tbl Payment File Pre Generate List -->
                <div class="tab-pane fade" id="disabled-tab-pane2" role="tabpanel" aria-labelledby="disabled-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <div id="dynamic_heading"></div>
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i> 
                          Generate Payment File
                          <span class="badge text-bg-info c-pointer pulse" id="generate_payment_status"><i class="bi bi-pencil-square"></i> Payment File Generation is In-progress ...</span>
                              <div class="row mt-4" id="generate_file_status_cards"></div>
                        </h5>
                       
                        <a class="btn btn-success float-end cbtn" style="margin-left:3px;" onclick="triggerScript('generate_payment_file_cnrt')" id="generate_payment_real_btn"><i class="bi bi-check2-circle"></i> Generate Payment File</a>
                        <button class="btn btn-success float-end cbtn" style="margin-left:3px;" id="generate_payment_disable_btn" disabled>
                          <i class="bi bi-check2-circle"></i> Generate Payment File
                        </button>

                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            <!-- tblPaymentFilePreGenerateList  this table ID -->

                            <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymentFilePreGenerateList" aria-describedby="tblPaymentFilePreGenerateList_info">
                              <thead>
                                <tr>
                                  <!-- <th><input class="form-check-input" type="checkbox" id="selectAllCheckbox3"  name="selectAllCheckbox"></th> -->
                                  <!-- <th scope="col"><input class="form-check-input" type="checkbox" value="" ></th> -->
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Month </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Name</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Mobile No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH / ABP</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Installment</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Transcation Date</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentFilePreGenerateList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Action</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                              </tbody>
                            </table>

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- tbl Payment File Pre Generate List -->

                 <!-- tbl Transfer File List -->
                 <div class="tab-pane fade" id="disabled-tab-pane3" role="tabpanel" aria-labelledby="disabled-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <div id="dynamic_heading"></div>
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i> Transfer Payment File to Bank
                          <span class="badge text-bg-info c-pointer pulse" id="transfer_payment_status"><i class="bi bi-pencil-square"></i> Payment File Transfer to Bank is In-progress...</span>
                          <div class="row mt-4" id="tranfer_to_bank_file_status_cards"></div>
                        </h5>                        
                        <a class="btn btn-success float-end cbtn" onclick="triggerScript2('transfer_payment_file')" id="transfer_payment_enable">
                          <i class="bi bi-check2-circle"></i> Transfer Payment File to Bank
                        </a>
                        <button class="btn btn-success float-end cbtn" style="margin-left:3px;" id="transfer_payment_disable_btn" disabled>
                          <i class="bi bi-check2-circle"></i> Transfer Payment File to Bank
                        </button>

                        <div class="clear-both"></div>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            <!-- tblPaymentInprogressList  this table ID -->

                             <a class="btn btn-primary cbtn float-end mt-2" id="xlsx_btn" onclick="downloadTransferToBankPreExcel()"><i class="bi bi-file-earmark-excel"></i> EXCEL</a>
                              <a class="btn btn-primary mx-2 cbtn float-end mt-2" id="csv_btn" onclick="downloadTransferToBankPreCsv()"><i class="bi bi-file-earmark-pdf"></i> CSV</a>

                            <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymenTransferList" aria-describedby="tblPaymenTransferList_info">
                              <thead>
                                <tr>
                                  <!-- <th><input class="form-check-input" type="checkbox" id="selectAllCheckbox" name="selectAllCheckbox" aria-controls="tblPaymenTransferList"></th> -->
                                  <!-- <th scope="col"><input class="form-check-input" type="checkbox" value="" ></th> -->
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymenTransferList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymenTransferList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymenTransferList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH / ABP</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymenTransferList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Count</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymenTransferList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Total Amount</th>
                        
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymenTransferList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">File Generate Date</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymenTransferList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">File Name</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                              </tbody>
                              <tfoot id="tblPaymenTransferList_tfoot"></tfoot>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- tbl Transfer File List -->

                <!-- tbl Payment EMO  List -->
                <div class="tab-pane fade" id="payment-emo-tab-pane" role="tabpanel" aria-labelledby="disabled-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i> Payment for EMO </h5>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymentEmoList" aria-describedby="tblPaymentEmoList_info">
                              <thead>
                                <tr>
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Month </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Name</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Mobile No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH / ABP</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Installment</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Transcation Date</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentEmoList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Action</th>
                                </tr>
                              </thead>
                              <tbody></tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- tbl Payment EMO List -->

              </div>
            </div>
          </div>
          <!-- END: list card end here -->
          <!-- START: modal popup -->
          <!-- Button trigger modal -->
        </div>
      </section>
    </main>
    <!-- End #main -->
    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div class="copyright">
        &copy; Copyright <strong><span>TNeGA</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        Designed & Developed by <a href="https://tngis.tn.gov.in/" target="_blank">TNeGA</a>
      </div>
    </footer>
    <!-- End Footer -->
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
    <!-- Delete modal starts -->
    <!-- view data starts -->
    <div class="modal fade viewdatainfo" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="bi bi-file-earmark-person"></i>
              <span>Beneficiaries Payment Details</span>
            </h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body py-2">
            <div class="row scheme-data mb-2">
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Scheme</label>
                <label for="" class="form-label"><span id="popup_scheme"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Year</label>
                <label for="" class="form-label"><span id="popup_year"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Month</label>
                <label for="" class="form-label"><span id="popup_month"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Beneficiary Name</label>
                <label for="" class="form-label"><span id="popup_beneficiary_name"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Mobile No</label>
                <label for="" class="form-label"><span id="popup_beneficiary_mobile"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">ACH / ABP</label>
                <label for="" class="form-label"><span id="popup_account_type"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Installment</label>
                <label for="" class="form-label"><span id="popup_installment"></span> </label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Amount</label>
                <label for="" class="form-label"><span id="popup_amount"></span> </label>
              </div>
              <div class="col-md-4" style="display: none;">
                <label for="" class="form-label fw-bold">Transcation Date </label>
                <label for="" class="form-label"><span id="popup_transcation"></span></label>
              </div>
            </div>
            <div class="row mb-2 dashboard">
              <div class="row" id="check_activity"></div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- view data ends -->


    <!-- view data starts -->
    <div class="modal fade blulkapproveSummary" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="bi bi-file-earmark-person"></i> Bulk Approval Summary</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" id="pendingBulkApproveClose" aria-label="Close"></button>
          </div>
          <div class="modal-body py-2">
            <div class="row scheme-data mb-2">
              <div class="table-responsive">
                <table class="table mt-3 w-100" class="table table-striped w-100 no-footer dataTable mt-3" id="tblBulkApproveSummary" aria-describedby="tblBulkApproveSummary_info">
                  <thead>
                    <tr>
                      <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">District</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Taluk </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year Month</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Bulk Approve Status</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">APB </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Total</th>
                    </tr>
                    <tr>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>                    
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                    </tr>
                  </thead>
                  <tbody>
                    
                  </tbody>
                  <tfoot id="tblBulkApproveSummary_tfoot"></tfoot>
                </table>
              </div>
            </div>
            <div class="row mb-2 dashboard">
              
            </div>
          </div>
          <div class="modal-footer">
            <p id="tblBulkApproveSummary_action_status" class="left-container1 text-nowrap">
              <span class="ml-2 badge badge-primary bg-primary">Total - <span id="tblBulkApproveSummary_action_total">0</span></span>
              <span class="ml-2  badge badge-success bg-success">Success - <span id="tblBulkApproveSummary_action_success">0</span></span>
              <span class="ml-2 badge badge-danger bg-danger">Failed - <span id="tblBulkApproveSummary_action_failed">0</span></span>
            </p>
            <button type="button" class="btn btn-success" onclick="allApprovalPermissionEnable()" id="allApprovalPermissionEnable">Approve</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="bulkApproveCloseBtn">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- view data ends -->



    <!-- Reinitiate Bulk Approve summary -->
    <div class="modal fade reinitiateBlulkapproveSummary" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="bi bi-file-earmark-person"></i> Bulk Reinitiate Summary</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" id="reinitiateBlulkapproveSummaryCloseTop" aria-label="Close"></button>
          </div>
          <div class="modal-body py-2">
            <div class="row scheme-data mb-2">
              <div class="table-responsive">
                <table class="table mt-3 w-100" class="table table-striped w-100 no-footer dataTable mt-3" id="tblReinitiateBulkApproveSummary" aria-describedby="tblReinitiateBulkApproveSummary_info">
                  <thead>
                    <tr>
                      <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">District</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Taluk </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year Month</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Bulk Approve Status</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">APB </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Total</th>
                    </tr>
                    <tr>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>                    
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblReinitiateBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                    </tr>
                  </thead>
                  <tbody>
                    
                  </tbody>
                  <tfoot id="tblReinitiateBulkApproveSummary_tfoot"></tfoot>
                </table>
              </div>
            </div>
            <div class="row mb-2 dashboard">
              
            </div>
          </div>
          <div class="modal-footer">
            <p id="tblReinitiateBulkApproveSummary_action_status" class="left-container1 text-nowrap">
                <span class="ml-2 badge badge-primary bg-primary">Total - <span id="tblReinitiateBulkApproveSummary_action_total">0</span></span>
                <span class="ml-2  badge badge-success bg-success">Success - <span id="tblReinitiateBulkApproveSummary_action_success">0</span></span>
                <span class="ml-2 badge badge-danger bg-danger">Failed - <span id="tblReinitiateBulkApproveSummary_action_failed">0</span></span>
              </p>
            <input type="hidden" name="select_reason_code" id="select_reason_code">
            <button type="button" class="btn btn-success" onclick="allApprovalReinitiate()" id="allApprovalReinitiate">Re-Initiate</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="allApprovalReinitiateCloseBtn">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Reinitiate Bulk Approve summary -->




     <!-- EMO Bulk Approve summary -->
     <div class="modal fade emoBlulkapproveSummary" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="bi bi-file-earmark-person"></i>Bulk EMO Transfer Summary</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" id="emoBlulkapproveSummaryCloseTop" aria-label="Close"></button>
          </div>
          <div class="modal-body py-2">
            <div class="row scheme-data mb-2">
              <div class="table-responsive">
                <table class="table mt-3 w-100" class="table table-striped w-100 no-footer dataTable mt-3" id="tblEmoBulkApproveSummary" aria-describedby="tblEmoBulkApproveSummary_info">
                  <thead>
                    <tr>
                      <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">District</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Taluk </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year Month</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Bulk Approve Status</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">APB </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH </th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Total</th>
                    </tr>
                    <tr>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>                    
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblEmoBulkApproveSummary" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                    </tr>
                  </thead>
                  <tbody>
                    
                  </tbody>
                  <tfoot id="tblEmoBulkApproveSummary_tfoot"></tfoot>
                </table>
              </div>
            </div>
            <div class="row mb-2 dashboard">
              
            </div>
          </div>
          <div class="modal-footer">
            <p id="tblEmoBulkApproveSummary_action_status" class="left-container1 text-nowrap">
              <span class="ml-2 badge badge-primary bg-primary">Total - <span id="tblEmoBulkApproveSummary_action_total">0</span></span>
              <span class="ml-2  badge badge-success bg-success">Success - <span id="tblEmoBulkApproveSummary_action_success">0</span></span>
              <span class="ml-2 badge badge-danger bg-danger">Failed - <span id="tblEmoBulkApproveSummary_action_failed">0</span></span>
            </p>
            <input type="hidden" name="emo_reason_code" id="emo_reason_code">
            <button type="button" class="btn btn-success" onclick="allApprovalEmo()" id="allApprovalEmo">EMO Transfer</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="allApproveCloseBtn">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- EMO Bulk Approve summary -->





    <!-- function list -->

    <div class="modal fade deduplicationValidateFunctionsList" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="bi bi-file-earmark-person"></i> Validation Status</h1>
            <button type="button" class="btn-close" id="deduplicationValidateFunctionsListClose" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body py-2">
            <div class="row scheme-data mb-2">
              <div class="table-responsive">
                <table class="table mt-3 w-100" class="table table-striped w-100 no-footer dataTable mt-3" id="deduplicationValidateFunctionsList" aria-describedby="deduplicationValidateFunctionsList_info">
                  <thead>
                    <tr>
                      <th scope="col" class="sorting sorting_asc">Validation Type</th>
                      <th scope="col" class="sorting sorting_asc">Validation Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <h4 style="font-size: 1.2rem;font-weight: 600;">Aadhaar Validation</h4>
                        <span>
                          <ul>
                            <li>Blank validation</li>
                            <li>Aadhaar length validation</li>
                            <li>Validity based on <b>Verhoeff</b> algorithm</li>
                            <li>Duplicate Validation Within Received Payload(<i>Scheme +  Year Month of Payment + Installment Id + Aadhaar</i>)</li>
                          </ul>
                        </span>
                      </td>
                      <td class="function_1_td"> <span id="function_1"></span></td>
                    </tr>
                    <tr>
                      <td>
                        <h4  style="font-size: 1.2rem;font-weight: 600;">Bank account validation (<small>ACH Payment</small>)</h4>
                        <span>
                          <ul>
                            <li>Account no blank validation, Account no numeric validation</li>
                            <li>IFSC code length validation(<i>11 Characters</i>)</li>
                            <li>IIN No validation (<i>6 Digits</i>), IIN No numeric validation</li>
                            <li>Duplicate Account Validation Within Received Payload(<i>Scheme +  Year Month of Payment + Installment Id + Account no</i>)</li>
                          </ul>
                        </span>
                      </td>
                      <td class="function_2_td"><span id="function_2"></span></td>
                    </tr>
                    <tr>
                      <td>
                        <h4  style="font-size: 1.2rem;font-weight: 600;">Duplicate Beneficiaries (<small>Against Previous Payment</small>)</h4>
                        <span>
                          <ul>
                            <li>Duplicate APB Benificaries (<i>Scheme + Year Month of Payment + Installment Id +Aadhaar + Payment status [In progress / Success]</i>)</li>
                            <li>Duplicate ACH Benificaries (<i>Scheme + Year Month of Payment + Installment Id + Account No + Payment status [In progress / Success]</i>)</li>
                          </ul>
                        </span>
                      </td>
                      <td class="function_3_td"><span id="function_3"></span></td>
                    </tr>
                    <tr>
                      <td>
                        <h4  style="font-size: 1.2rem;font-weight: 600;">Obsolete Beneficiaries</h4>
                        <span>
                          <ul>
                            <li>Validate Obsolete Beneficiaries (<i>Scheme + Year Month of Payment + Installment Id +Aadhaar + Payment status [In progress / Success]</i>)</li>
                          </ul>
                        </span>
                      </td>
                      <td class="function_4_td"><span id="function_4"></span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="row mb-2 dashboard">
              
            </div>
          </div>
          <div class="modal-footer">
            

            <button type="button" class="btn btn-primary" onclick="viewSummary()" data-bs-dismiss="modal" id="deduplicationBtn">View Validation Summary</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="deduplicationvalidationCloseBtn">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- function list end -->


   


    <!-- view data starts deduplication Validaet Summary-->
    <div class="modal fade deduplicationValidateSummary" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="bi bi-card-list"></i> Validation Summary</h1>
            <button type="button" class="btn-close" id="validateSummaryClose" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body py-2">
            <div class="row scheme-data mb-2">
              <div class="table-responsive">
                <table class="table mt-3 w-100" class="table table-striped w-100 no-footer dataTable mt-3" id="deduplicationValidateSummary" aria-describedby="deduplicationValidateSummary_info">
                  <thead>
                    <tr>
                      <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme Name</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Subscheme Name</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">District Name</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Taluk Name</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year Month</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Total Count</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Valid Count</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Error Count</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Duplicate Benificiary</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Duplicate Aadhaar</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Duplicate Account</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Invalid Beneficiary Name</th>
                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Invalid IIN (or) IFSC</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Invalid Aadhaar</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Invalid Account</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Obsolete Beneficiary</th>

                      <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="deduplicationValidateSummary" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Download</th>
                    </tr>
                  </thead>
                  <tbody>
                    
                  </tbody>
                  <tfoot id="deduplicationValidateSummary_tfoot"></tfoot>
                </table>
              </div>
            </div>
            <div class="row mb-2 dashboard">
              
            </div>
          </div>
          <div class="modal-footer">
            <div class="container-fluid">
              <div class="row">
                <div class="col-md-7"><span class="align-self-start text-warning" id="valid_records_not_found_info"></span></div>
                <div class="col-md-4">
                  <button type="button" class="btn btn-success" onclick="transferToPending()" data-bs-dismiss="modal" id="transFerToValidBtn">Transfer valid beneficiaries for approval</button>
                </div>
                <div class="col-md-1">
                  <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- view data ends -->


        <!-- view data starts -->
        <div class="modal fade transferPaymentProcess" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
              <div class="modal-content">
                <div class="modal-header py-2">
                  <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="bi bi-file-earmark-person"></i> Transfer to Payment Process</h1>
                  <button type="button" class="btn-close" id="transferPaymentProcessCloseOne" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body py-2">
                  <div class="row scheme-data mb-2">
                    <div class="table-responsive">
                      <table class="table mt-3 w-100" class="table table-striped w-100 no-footer dataTable mt-3" id="transferPaymentProcess" aria-describedby="transferPaymentProcess_info">
                        <thead>
                          <tr>
                            <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                            <!-- <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme</th> -->
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">District</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Taluk </th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Transfer Payment Process Status</th>
                            <!-- <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="2" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year Month</th> -->
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">APB </th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">ACH </th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="2" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Total</th>
                          </tr>
                          <tr>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>                    
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Count</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="transferPaymentProcess" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Amount</th>
                            
                          </tr>
                        </thead>
                        <tbody>
                          
                        </tbody>

                        <tfoot id="transferPaymentProcess_tfoot"></tfoot>
                      </table>
                    </div>
                  </div>
                  <div class="row mb-2 dashboard">
                    
                  </div>
                </div>
                <div class="modal-footer">
                  <p id="transferPaymentProcess_action_status" class="left-container1 text-nowrap">
                  <span class="ml-2 badge badge-primary bg-primary">Total - <span id="transferPaymentProcess_action_total">0</span></span>
                  <span class="ml-2  badge badge-success bg-success">Success - <span id="transferPaymentProcess_action_success">0</span></span>
                  <span class="ml-2 badge badge-danger bg-danger">Failed - <span id="transferPaymentProcess_action_failed">0</span></span>
                  </p>
                  <button type="button" class="btn btn-success" onclick="TransferPaymentProcessInziated();" id="transferBtn">Transfer</button>
                  <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="TransferPaymentProcessCloseBtn">Close</button>
                </div>
              </div>
            </div>
          </div>
          <!-- view data ends -->





    <!-- view crop info ends -->
    <!-- Vendor JS Files -->
    
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script type="text/javascript" src="assets/vendor/jquery-validate/js/jquery.validate.min.js"></script>


    <!-- data table -->
    <script src="assets/vendor/datatable/jquery.dataTables.min.js"></script>
    <script src="assets/vendor/datatable/dataTables.bootstrap5.min.js"></script>
    <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.js"></script>
    <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.bootstrap4.js"></script>
    <script src="assets/vendor/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/jszip.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/pdfmake.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/vfs_fonts.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.colVis.min.js"></script>
    <script src="assets/vendor/sweetalert2/js/sweetalert.min.js"></script>
    <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
    <script src="assets/vendor/toggle/bootstrap-toggle.min.js"></script>
    <script src="assets/js/global.js"></script>
    <script src="assets/js/alpinejs_3_10_2.min.js" defer></script>
    <script src="assets/lang/reports.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js'></script>
    <script src="assets/scripts/xlsx.full.min.js"></script>
    <!-- data table -->



    
    <!-- Main JS File -->
    
    <script src="assets/js/global.js"></script>
    <script src="assets/js/base64tojson.js"></script>
    <script src="assets/js/crypto-js.js"></script>
    <script src="assets/js/aes.js"></script>
  

    <script type="text/javascript" src="assets/vendor/toastr/toastr.min.js"></script>
    
    <!-- Crypto js -->
    <script src="assets/vendor/encryption/crypto-js.min.js"></script>
    <!-- Encryption js -->
    <script src="assets/vendor/encryption/Encryption.js"></script>
    <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
    
    
 
<script type="text/javascript">
  var url = window.location.href;
  var page_url = url.split('/');
  var page = page_url[4];

  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  $(document).ready(function () {
    $(document).on({
          //  ajaxStart: function () {
          //    $('#preloader').show();
          //   //  console.log('preloader is show');
          //  },
          ajaxStop: function () {
            $('#preloader').hide();
            //  console.log('preloader is show');
          }
        });

    $('.official').each(function (i, obj) {
      var href = obj.getAttribute("href");
      if (href == page) {
        obj.classList.add('active');
      } else {
        obj.classList.remove('active');
      }
    });
    // $('#preloader').hide();
  
    var userDataString = getCookie('payment_official');
    if (!userDataString) {
      $('#preloader').show();
      window.location.href = "login.html";
    }

    userDataString = JSON.parse(userDataString);
    $('#official_username').text(userDataString['first_name']);
    $('#UserID').val(userDataString['user_id']);
    window.loginUser_id = userDataString['user_id'];
    reloID = userDataString['role_id'];
      roleBasedPageAllow(loginUser_id,reloID);

    
    getSchemeCategory();
    getDistricts();

    $('#ddl_sub_scheme').on('change',function(){

    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();
    $('#ddl_department').append($('<option>', {value: "",text: "--Select--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--Select--"}));
      
      $('#preloader').show();
      
      $.ajax({
        url: APIURL +'schem_filter',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: {case: "get_department",scheme_cate:$('#ddl_scheme_cate').val(),scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),sub_scheme_name:$
        ('#ddl_sub_scheme').val(),
        whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
       
        success: function(response) {
          $('#preloader').hide();
            //  console.log("department:", response);
            var department_code = response.data[0];
            console.log('response',response);
            // alert(2);
            getDepartment(department_code.department);
        },
        error: function(xhr, status, error) {
          $('#preloader').hide();
            console.log("Error:", error);
        }
      });
    });

    $('#ddl_district').on('change', function () {
      var district_code = $('#ddl_district').val();
      $('#ddl_taluk').empty();
      $('#ddl_taluk').append('<option value="">--All--</option>');
      getTaluk(district_code);
    });

});

function getCookie(name) {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.startsWith(name + '=')) {
        return cookie.substring(name.length + 1);
      }
    }
    return null;
  }

/* filters */
function getSchemeCategory(){
    $('#ddl_scheme_cate').empty();
    $('#ddl_scheme_name').empty();
    $('#ddl_sub_scheme').empty();
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();
    $('#ddl_scheme_cate').append($('<option>', {value: "", text: "--All--"}));
    $('#ddl_scheme_name').append($('<option>', {value: "", text: "--Select--"}));
    $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--Select--"}));
    $('#ddl_department').append($('<option>', {value: "",text: "--Select--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--Select--"}));
 
  $.ajax({
    url: APIURL +'schem_filter',
    type: "POST",
    headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
    data: {case: "get_scheme_category",get_column:"scheme_code",groupbycolumn:"scheme_code",user_id:loginUser_id},
    success: function(response) {
       //  console.log("Success:", response);
        var schemeCode = response.data;
       //  console.log('scheme code >>> ',schemeCode);
 
        $('#ddl_scheme_cate').empty();
        $('#ddl_scheme_cate').append($('<option>', {
              value: "",
              text: "--Select--"
          }));

        $.each(schemeCode, function (index, scheme) {
            // console.log('scheem code lenthg >>> ', schemeCode.length);
            if(schemeCode.length >1){
              $('#ddl_scheme_cate').append($('<option>', {
                value: scheme.scheme_category,
                text: scheme.scheme_category
            }));
            }else{
              $('#ddl_scheme_cate').append($('<option>', {
                value: scheme.scheme_category,
                text: scheme.scheme_category
            }).prop('selected', true));
            $('#ddl_scheme_cate').trigger('change');
            }
         });
    },
    error: function(xhr, status, error) {
        console.log("Error:", error);
    }
  });
}


$('#ddl_scheme_cate').on('change',function(){
  
    $('#ddl_scheme_code').empty();
    $('#ddl_scheme_name').empty();
    $('#ddl_sub_scheme').empty();
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();

    $('#ddl_scheme_code').append($('<option>', {value: "", text: "--Select--"}));
    $('#ddl_scheme_name').append($('<option>', {value: "", text: "--Select--"}));
    $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--Select--"}));
    $('#ddl_department').append($('<option>', {value: "",text: "--Select--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--Select--"}));

      // $('#payment_date_input').val('');

      let scheme_cate = $(this).val();
  if(scheme_cate ==''|| scheme_cate==null||scheme_cate==undefined){
    $('#ddl_year').empty();
    $('#ddl_payment_period').empty();
    $('#ddl_payment_installment').empty();
    $('#ddl_payment_cycle').text('Scheme Based Payment Period');
    
    $('#ddl_year').append($('<option>', {
          value: "",
          text: "Select Year - Month"
      }).attr('disabled','true').attr('selected', 'selected'));

      $('#ddl_payment_installment').append($('<option>', {
          value: "",
          text: "Select Installment"
      }).attr('disabled','true').attr('selected', 'selected'));

      $('#ddl_payment_period').append($('<option>', {
          value: "",
          text: "Select the Payment Period"
      }).attr('disabled','true').attr('selected', 'selected'));
      
  }
  
   $.ajax({
     url: APIURL +'schem_filter',
     type: "POST",
     headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
     data: {case: "get_scheme_code",get_column:"scheme_code",groupbycolumn:"scheme_code",whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
     success: function(response) {
        //  console.log("Success:", response);
         var schemeCode = response.data;
        //  console.log('scheme code >>> ',schemeCode);
  
         $('#ddl_scheme_code').empty();
         $('#ddl_scheme_code').append($('<option>', {
               value: "",
               text: "--Select--"
           }));  

        $.each(schemeCode, function (index, scheme) {
            // console.log('scheem code lenthg >>> ', schemeCode.length);
            if(schemeCode.length >1){
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
            }));
            }else{
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
            }).prop('selected', true));
            // $('#ddl_scheme_code').trigger('change');
            }
         });
         $('#ddl_scheme_code').trigger('change');
     },
     error: function(xhr, status, error) {
         console.log("Error:", error);
     }
   });
})



$('#ddl_scheme_code').on('change',function(){

     $('#ddl_sub_scheme').empty();
     $('#ddl_scheme_name').empty();
     $('#ddl_sub_scheme').empty();
     $('#ddl_department').empty();
     $('#ddl_sub_department').empty();

     $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--Select--"}));
     $('#ddl_scheme_name').append($('<option>', {value: "", text: "--Select--"}));
     $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--Select--"}));
     $('#ddl_department').append($('<option>', {value: "",text: "--Select--"}));
     $('#ddl_sub_department').append($('<option>', {value: "",text: "--Select--"}));

      $('#preloader').show();
   $.ajax({
   url: APIURL +'schem_filter',
   type: "POST",
   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
   data: {case: "get_scheme",scheme_code:$('#ddl_scheme_code').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
   success: function(response) {
    $('#preloader').hide();
      //  console.log("Success:", response);
       var schemeCode = response.data;
      //  console.log(schemeCode.scheme_code);
       $('#ddl_scheme_name').empty();
       $('#ddl_scheme_name').append($('<option>', {
             value: "",
             text: "--Select--"
         }));
       // Iterate over the JSON object and append options
       $.each(schemeCode, function (index, scheme) {
        // console.log('scheem code lenthg >>> ', schemeCode.length);
        if(schemeCode.length >1){
          $('#ddl_scheme_name').append($('<option>', {value: scheme.scheme_name,text: scheme.scheme_name}));
        }else{
          $('#ddl_scheme_name').append($('<option>', {value: scheme.scheme_name,text: scheme.scheme_name}).prop('selected', true));
        //  $('#ddl_scheme_name').trigger('change');
        }
       });
       $('#ddl_scheme_name').trigger('change');
   },
   error: function(xhr, status, error) {
    $('#preloader').hide();
       console.log("Error:", error);
   }
 });

});

$('#ddl_scheme_name').on('change',function(){

   
   // $('#ddl_scheme_name').empty();
   $('#ddl_sub_scheme').empty();
   $('#ddl_department').empty();
   $('#ddl_sub_department').empty();

   
   // $('#ddl_scheme_name').append($('<option>', {value: "", text: "--Select--"}));
   $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--Select--"}));
   $('#ddl_department').append($('<option>', {value: "",text: "--Select--"}));
   $('#ddl_sub_department').append($('<option>', {value: "",text: "--Select--"}));


$('#preloader').show();
   $.ajax({
   url: APIURL +'schem_filter',
   type: "POST",
   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
   data: {case: "get_sub_scheme",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(), whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
   success: function(response) {
    $('#preloader').hide();
      //  console.log("Success:", response);
       var schemeCode = response.data;
      //  console.log(schemeCode.scheme_code);
       $('#ddl_sub_scheme').empty();
       $('#ddl_sub_scheme').append($('<option>', {
             value: "",
             text: "--Select--"
         }));
       // Iterate over the JSON object and append options
       $.each(schemeCode, function (index, scheme) {
        if(schemeCode.length > 1){
          $('#ddl_sub_scheme').append($('<option>', {
             value: scheme.subscheme_name,
             text: scheme.subscheme_name
         }));
        }else{
          $('#ddl_sub_scheme').append($('<option>', {
             value: scheme.subscheme_name,
             text: scheme.subscheme_name
         }).prop('selected', true));
        }
        // $('#ddl_sub_scheme').trigger('change');
       });
       $('#ddl_sub_scheme').trigger('change');
   },
   error: function(xhr, status, error) {
    $('#preloader').hide();
       console.log("Error:", error);
   }
 });

});

// get_scheme


/* filters */
function getDepartment(depID){
     $('#ddl_department').empty();
   $('#ddl_sub_department').empty();

   $('#ddl_department').append($('<option>', {value: "",text: "--Select--"}));
   $('#ddl_sub_department').append($('<option>', {value: "",text: "--Select--"}));
    $('#preloader').show();
    let scheme_cate = $('#ddl_scheme_cate').val();

    
$.ajax({
   url: APIURL +'get_department',
   type: "POST",
   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
   data: {type: "department"},
   success: function(response) {
       // console.log("Success:",JSON.parse(response)[0].data );
       var department = response[0].data;
       // Handle the successful response here
      //  $('#ddl_department').empty();
      //  $('#ddl_department').append($('<option>', {
      //        value: "",
      //        text: "--Select--"
      //    }));
     
      if(scheme_cate == '' || scheme_cate === 0){
                  $('#ddl_department').empty();
                  $('#ddl_department').append($('<option>', {val: '', text: '--All--' }));
                  $('#ddl_payment_cycle').empty();
                  $('#ddl_payment_cycle').append($('<option>', {val: '', text: 'Scheme Based Payment Period' }));
      }
      else{
        
       // Iterate over the JSON object and append options
       $.each(department, function (index, dep) {
         if(dep.department_code==depID){
           $('#ddl_department').append($('<option>', {
             value: dep.department_code,
             text: dep.department_name
           }).attr('selected', 'selected'));
           // $('#ddl_department').trigger('change');
          
           $.ajax({
                 url: APIURL +'schem_filter',
                 type: "POST",
                 headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
                 data: {case: "get_sub_department",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),sub_scheme_name:$('#ddl_sub_scheme').val(),department:$('#ddl_department').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
                 success: function(response) {
                  $('#preloader').hide();
                    //  console.log("department:", response);
                     var subdepartment_code = response.data[0];
                    //  console.log(subdepartment_code.department);
                     get_sub_department(dep.department_code,subdepartment_code.subdepartment);
                 },
                 error: function(xhr, status, error) {
                  $('#preloader').hide();
                     console.log("Error:", error);
                 }
             });
           
         }
       });
      }
   },
   error: function(xhr, status, error) {
       console.log("Error:", error);
       // Handle the error here
   }
 });
}


// $('#ddl_department').on('change',function(){
 function get_sub_department(depID,subDepID){
   $('#ddl_sub_department').empty();
   $('#ddl_sub_department').append($('<option>', {value: "",text: "--Select--"}));
    $('#preloader').show();
     // var department = $('#ddl_department').val();
     
     $.ajax({
     url: APIURL +'get_department',
     type: "POST",
     headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
     data: {type: "sub_department",whereColumn:$('#ddl_scheme_cate').val(),department_code:depID},
    
     success: function(response) {
      $('#preloader').hide();
      
         // console.log("Success:",JSON.parse(response)[0].data );
         var department = response[0].data;
         // Handle the successful response here
         $('#ddl_sub_department').empty();
         $('#ddl_sub_department').append($('<option>', {
               value: "",
               text: "--Select--"
           }));
         // Iterate over the JSON object and append options
         $.each(department, function (index, sub_dep) {
           if(sub_dep.sub_department_code==subDepID){
             $('#ddl_sub_department').append($('<option>', {
               value: sub_dep.sub_department_code,
               text: sub_dep.sub_department_name
           }).attr('selected', 'selected'));
           }
           
         });
         get_schemebyuser(loginUser_id);
        //  $("#formFilters").submit();
     },
     error: function(xhr, status, error) {
      $('#preloader').hide();
         console.log("Error:", error);
         // Handle the error here
     }
   });
 }

  function getDistricts(){
      const userDataString = getCookie("payment_official");
      const userData = JSON.parse(userDataString);

    
      $('#ddl_district').selectpicker('destroy');

      var districtID=0;
      var data=[];
      if(userData['district_code']!=0){
      districtID=userData['district_code'];
      data={ case: 'district',district_code: districtID,user_id:userData['user_id']};
      } else {
      data={ case: 'district',user_id:userData['user_id']};
      }

      $('#ddl_taluk').empty();
      $('#ddl_taluk').append('<option value="">--All--</option>');
      $('#preloader').show();
    $.ajax({
      url: userMasterAPIURL+'userMaster',
      method: 'POST',
      headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: data,
      dataType: 'json',
      success: function (response) {
        $('#preloader').hide();
        //console.log(response);
        var district = response.district;
        var districtDropdown = $("#ddl_district");
        $('#ddl_district').empty();
        $('#ddl_district').append($('<option>', {value: "",text: "--All--"}));
          
        if(districtID==0 || districtID ==undefined){
        populateDropdown('ddl_district', response.districts, 'district');              
        } else {
        districtDropdown.html('<option value="'+district['district_code']+'">'+district['district_name']+'</option>');
        $('#ddl_district').trigger('change');
        var district_code= district['district_code'];
          getTaluk(district_code);
        }

        $('#ddl_district').selectpicker();

      },
      error: function () {
        $('#preloader').hide();
        console.error('Error fetching district data');
      }
    });
  }


  

  /*START : Get Taluk list*/
  function getTaluk(districtID){
    
      $('#ddl_taluk').selectpicker('destroy');
    $('#ddl_taluk').empty();
    $('#ddl_taluk').append('<option value="">--All--</option>');
    // var district=$("#ddl_district").val();
      const userDataString = getCookie("payment_official");
      const userData = JSON.parse(userDataString);

      // var district=district_code;
      var talukID=0;
      var data=[];
      if(userData['taluk_code']!=0){
      // districtID=userData['district_code'];
      talukID=userData['taluk_code'];
      data={ case: 'taluk',district_code: districtID,taluk_code: talukID,user_id:userData['user_id']};
      } else {
      data={ case: 'taluk',district_code: districtID,user_id:userData['user_id']};
      }
      $('#preloader').show();
    
    $.ajax({
      url: userMasterAPIURL+'userMaster', // Replace with your API endpoint
      method: 'POST',
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: data,
      dataType: 'json',
      success: function (response) {
        $('#preloader').hide();
        /*$('#ddl_taluk').empty();
        $.each(response.taluk, function (index, value) 
        {
            $('#ddl_taluk').append('<option value="' + value.taluk_code + '">' + value.taluk_name + ' </option>');
        });*/
        var taluk = response.taluk
        var talukDropdown = $("#ddl_taluk");
      //  populateDropdown('ddl_taluk', response.taluk, 'taluk'); 
        if(talukID==0){
          populateDropdown('ddl_taluk', response.taluk, 'taluk');             
        } else {
          
          talukDropdown.html('<option value="'+taluk['taluk_code']+'">'+taluk['taluk_name']+'</option>');
        $('#ddl_taluk').trigger('change');
        }
        $('#ddl_taluk').selectpicker();
      },
      error: function () {
        $('#preloader').hide();
        Swal.fire({
          icon: "error",
          title: "Service Error!",
          showConfirmButton: false,
          timer: 2000
        })
      }
    });
  }

  //   $("#from_date").prop("disabled", true);
  //   $("#to_date").prop("disabled", true);

  //   // selectbox
  //   $("#ddl_month_col").hide();
  //   $("#ddl_year_col").hide();
    
  //   $("#ddl_month_col").prop("disabled", true);
  //   $("#ddl_year_col").prop("disabled", true);




  // $('#dayWeekMonthFilter').on('change',function(){
  //     var payment_period = $('#dayWeekMonthFilter').val();
  //     if(payment_period == 0){
  //       $("#from_date_col").show();
  //       $("#to_date_col").show();
  //       $("#from_date").prop("disabled", false);
  //       $("#to_date").prop("disabled", false);

  //       $("#ddl_month_col").hide();
  //       $("#ddl_year_col").hide();
  //       $("#ddl_month").prop("disabled", true);
  //       $("#ddl_year").prop("disabled", true);

  //     }else if(payment_period == 4){

  //       $("#from_date_col").hide();
  //       $("#to_date_col").hide();
  //       $("#from_date").prop("disabled", false);
  //       $("#to_date").prop("disabled", false);

  //       $("#ddl_month_col").show();
  //       $("#ddl_year_col").show();
  //       $("#ddl_month").prop("disabled", false);
  //       $("#ddl_year").prop("disabled", false);
    
  //     } else{
  //       $("#from_date").val('');
  //       $("#from_date").prop("disabled", true);
  //       $("#to_date").val('');
  //       $("#to_date").prop("disabled", true);

  //       $("#from_date_col").show();
  //       $("#to_date_col").show();
  //       $("#from_date").prop("disabled", true);
  //       $("#to_date").prop("disabled", true);

  //       $("#ddl_month_col").hide();
  //       $("#ddl_year_col").hide();
  //       $("#ddl_month").prop("disabled", true);
  //       $("#ddl_year").prop("disabled", true);
  //     }
  // });

  // // $('#from_date').on('change', function() {
  // //     $('#today').prop('checked', false);
  // //     $('#thisweek').prop('checked', false);
  // //     $('#thismonth').prop('checked', false);
  // // });

  // $('#to_date').on('change', function() {
  //     $('#today').prop('checked', false);
  //     $('#thisweek').prop('checked', false);
  //     $('#thismonth').prop('checked', false);
  //     var fromDate = $('#from_date').val();
  //     var toDate = $(this).val();
  //     // Check if "to_date" is earlier than "from_date"
  //     if (fromDate && toDate && fromDate > toDate) {
  //       alert('To Date should not be earlier than From Date.');
  //       // You can reset the "to_date" value or take other actions here
  //       $(this).val('');
  //     }
  // });

  $('#paymentDate').on('change', function() {
    var todayDate = new Date(); 
    todayDate.setDate(todayDate.getDate() - 1);
    var toDate = new Date($(this).val());
    if (toDate < todayDate) {
        alert('To Date should be a future date.');
        $(this).val('');
    }
    $('#paymentDate_error').hide();
  });


  $('#reinitiatePaymentDate').on('change', function() {
    var todayDate = new Date(); 
    todayDate.setDate(todayDate.getDate() - 1);
    var toDate = new Date($(this).val());
    if (toDate < todayDate) {
        alert('To Date should be a future date.');
        $(this).val('');
    }
    $('#reinitiatePaymentDate_error').hide();
  });
  


var formsFilter = [];
window.localStorage.removeItem('filters');
/*from submit*/
$(document).ready(function() {


$('#filter_based_info_card_div').hide();
$('#tblCard').hide();


  $("#formFilters").validate({
          rules: {
            ddl_scheme_cate: {required: true},
            ddl_scheme_code: {required: true},
            ddl_scheme_name: {required: true},
            ddl_sub_scheme: {required: true},
            ddl_department: {required: true},
            ddl_sub_department: {required: true},
            ddl_year :{required: true},
            ddl_payment_period: {required: true},
            ddl_payment_installment : {required: true},
            ddl_year : {required: true},
          },
          messages: {
            ddl_scheme_cate: {required: "Select the Scheme Category"},
            ddl_scheme_code: {required: "Select the Scheme Code"},
            ddl_scheme_name: {required: "Select the scheme Name"},
            ddl_sub_scheme: {required: "Select the Sub Scheme Name"},
            ddl_department: {required: "Select the Deparment"},
            ddl_sub_department: {required: "Select the Sub Deparment"},
            ddl_year :{required: "Select the Year Month"},
            ddl_payment_period: {required: "Select the Payment Period"},
            ddl_payment_installment : {required: "Select the Installment"},
          },
          errorClass: "help-inline text-danger",
          errorElement: "span",
          errorPlacement: function (error, element) {
              if (element.attr("id") === "ddl_year") {
                  error.insertAfter(element.parent()); // Place error after the parent container of ddl_year
              } else {
                  error.insertAfter(element); // Place error after the element
              }
          },
          highlight: function(element, errorClass, validClass) {
              $(element).parents('.form-group').addClass('has-error');
          },
          unhighlight: function(element, errorClass, validClass) {
              $(element).parents('.form-group').removeClass('has-error');
              $(element).parents('.form-group').addClass('has-success');
          },
          submitHandler: function(form,e) {
              e.preventDefault();
              // console.log('Form submitted');
              formsFilter.length = 0;
              formsFilter = [];
              var formData = $(form).serialize();
              window.localStorage.removeItem('filters');
              window.localStorage.setItem('filters', JSON.stringify(formData));
              // window.localStorage.setItem('filters', formData);
              var tabId = $('#approvelpayment').val();
              if(tabId==''){tabId = 7;}

                tabClickValue(tabId);

              // $("#tblCard").show();
              /*scroll function*/
              $('html, body').animate({
                scrollTop: $("#tblCard").offset().top
              }, 2000);

              $('#lable_text_scheme_cate').text($('#ddl_scheme_cate').val());
              $('#lable_text_scheme_code').text($('#ddl_scheme_code').val());
              $('#lable_text_scheme').text($('#ddl_scheme_name').val());
              $('#lable_text_sub_scheme').text($('#ddl_sub_scheme').val());
              $('#lable_text_Department').text($("#ddl_department option:selected").text());
              $('#lable_text_sub_department').text($("#ddl_sub_department option:selected").text());
              

              let paymentCycle = $('#ddl_payment_cycle').text();
              if($("#ddl_payment_period option:selected").val()!='' && $("#ddl_payment_period option:selected").val()!=null && $("#ddl_payment_period option:selected").val()!=undefined){
                paymentCycle = $('#ddl_payment_cycle').text()+'-'+$("#ddl_payment_period option:selected").text();
              }

              $('#lable_text_payment_period').text(paymentCycle);
              
              $('#lable_text_year_month').text($("#ddl_year option:selected").text());
              $('#lable_text_installment').text($("#ddl_payment_installment option:selected").text());
              // $('#lable_text_month').text(mm);
              

              if ($('#ddl_scheme_code').val() !== '' && $('#ddl_scheme_name').val() !== '' && $('#ddl_sub_scheme').val() !== '' && $('#ddl_department').val() !== '' && $('#ddl_sub_department').val() !== '') {
                // if(($('#payment_date_input').val()=='' )|| ($('#payment_date_input').val() == null) || ($('#payment_date_input').val() == undefined)){
                //   getpaymentDate();
                // }
                  $('#filter_based_info_card_div').show();
                  $('#tblCard').show();
                  // $('#btnfilter').click();
                  $('#accordionExample .accordion-collapse').collapse('hide');

                  var tabId = $('#approvelpayment').val();
                  if(tabId==''){tabId = 7;}

                  tabClickValue(tabId);

                  $('html, body').animate({
                    scrollTop: $("#tblCard").offset().top
                    }, 2000);


              }else{
                $('#filter_based_info_card_div').hide();
              }

             

              // $('#filter_based_info_card_div').show();
              
              // $('#btnfilter').click();
              // $('#accordionExample .accordion-collapse').collapse('hide');
              // $('#reinitiatePaymentDate').val('');
              return false;
          }
    });

        $.validator.addMethod("verhoeff", function(value, element) {
         let uidValidate = checkUID(value);
          return uidValidate;
        },"Please Enter the Valide Aadhaar No.");
});








function checkUID(uid) {
    if (uid.length != 12) {
        return false;
    }

    var Verhoeff = {
        "d": [[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
            [1, 2, 3, 4, 0, 6, 7, 8, 9, 5],
            [2, 3, 4, 0, 1, 7, 8, 9, 5, 6],
            [3, 4, 0, 1, 2, 8, 9, 5, 6, 7],
            [4, 0, 1, 2, 3, 9, 5, 6, 7, 8],
            [5, 9, 8, 7, 6, 0, 4, 3, 2, 1],
            [6, 5, 9, 8, 7, 1, 0, 4, 3, 2],
            [7, 6, 5, 9, 8, 2, 1, 0, 4, 3],
            [8, 7, 6, 5, 9, 3, 2, 1, 0, 4],
            [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]],
        "p": [[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
            [1, 5, 7, 6, 2, 8, 3, 0, 9, 4],
            [5, 8, 0, 3, 7, 9, 6, 1, 4, 2],
            [8, 9, 1, 6, 0, 4, 3, 5, 2, 7],
            [9, 4, 5, 3, 1, 2, 6, 8, 7, 0],
            [4, 2, 8, 6, 5, 7, 3, 9, 0, 1],
            [2, 7, 9, 3, 8, 0, 6, 4, 1, 5],
            [7, 0, 4, 6, 9, 1, 3, 2, 5, 8]],
        "j": [0, 4, 3, 2, 1, 5, 6, 7, 8, 9],
        "check": function (str) {
            var c = 0;
            str.replace(/\D+/g, "").split("").reverse().join("").replace(/[\d]/g, function (u, i) {
                c = Verhoeff.d[c][Verhoeff.p[i % 8][parseInt(u, 10)]];
            });
            return c;

        },
        "get": function (str) {

            var c = 0;
            str.replace(/\D+/g, "").split("").reverse().join("").replace(/[\d]/g, function (u, i) {
                c = Verhoeff.d[c][Verhoeff.p[(i + 1) % 8][parseInt(u, 10)]];
            });
            return Verhoeff.j[c];
        }
    };

    String.prototype.verhoeffCheck = (function () {
        var d = [[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
            [1, 2, 3, 4, 0, 6, 7, 8, 9, 5],
            [2, 3, 4, 0, 1, 7, 8, 9, 5, 6],
            [3, 4, 0, 1, 2, 8, 9, 5, 6, 7],
            [4, 0, 1, 2, 3, 9, 5, 6, 7, 8],
            [5, 9, 8, 7, 6, 0, 4, 3, 2, 1],
            [6, 5, 9, 8, 7, 1, 0, 4, 3, 2],
            [7, 6, 5, 9, 8, 2, 1, 0, 4, 3],
            [8, 7, 6, 5, 9, 3, 2, 1, 0, 4],
            [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]];
        var p = [[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
            [1, 5, 7, 6, 2, 8, 3, 0, 9, 4],
            [5, 8, 0, 3, 7, 9, 6, 1, 4, 2],
            [8, 9, 1, 6, 0, 4, 3, 5, 2, 7],
            [9, 4, 5, 3, 1, 2, 6, 8, 7, 0],
            [4, 2, 8, 6, 5, 7, 3, 9, 0, 1],
            [2, 7, 9, 3, 8, 0, 6, 4, 1, 5],
            [7, 0, 4, 6, 9, 1, 3, 2, 5, 8]];

        return function () {
            var c = 0;
            this.replace(/\D+/g, "").split("").reverse().join("").replace(/[\d]/g, function (u, i) {
                c = d[c][p[i % 8][parseInt(u, 10)]];
            });
            return (c === 0);
        };
    })();

    if (Verhoeff['check'](uid) === 0) {
        return true;
    } else {
        return false;
    }
}

window.getCurrentTabId = -1;
tabClickValue(7);
$('#select_reason_code').val('');
function tabClickValue(tabID){
  
  var dataFilters = window.localStorage.getItem('filters');
/* get value to inputs*/
  var input_schemCode = $('#ddl_scheme_code').val();
  var input_schemName = $('#ddl_scheme_name').val();
  var input_subScheme = $('#ddl_sub_scheme').val();
  var input_dep = $('#ddl_department').val();
  var input_subDep = $('#ddl_sub_department').val();
  var input_dateMonthYear = $('#dayWeekMonthFilter').val();
/* get value to inputs*/


  getCurrentTabId = tabID;
  // $('#preloader').show();
  if(tabID==0){
    $('#approvelpayment').val(0);
      if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
        get_pending_paymment_list(dataFilters,1);
        $('#profile-tab-pane').show();
      } else {$('#profile-tab-pane').hide();}  

  }else if(tabID==1){
    $('#approvelpayment').val(1);
      if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
        get_success_paymment_list(dataFilters,3);
        $('#contact-tab-pane').show();
      } else {$('#contact-tab-pane').hide();}/*{fileter,success}*/

  }else if(tabID==2){
    $('#approvelpayment').val(2);
    
    if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
        get_failed_paymment_list(dataFilters,4,null);
        $('#disabled-tab-pane').show();
      } else {$('#disabled-tab-pane').hide();}

  }else if(tabID==3){
    $('#approvelpayment').val(3);
      console.log(tabID);
      if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
        get_inprogress_paymment_list(dataFilters,2);
        $('#disabled-tab-pane1').show();
      } else {$('#disabled-tab-pane1').hide();}/*{fileter,inprogress}*/
  }
  else if(tabID==4){
    $('#approvelpayment').val(4);

    if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
      get_generate_payment_file_pre_list(dataFilters,5);
        $('#disabled-tab-pane2').show();
      } else {$('#disabled-tab-pane2').hide();}   /*{fileter,generate}*/
  }
  else if(tabID==5){
    $('#approvelpayment').val(5);
      if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
        get_transfer_payment_to_bank_pre_list(dataFilters,6);
        $('#disabled-tab-pane3').show();
      } else {$('#disabled-tab-pane3').hide();}/*{fileter,transfer payment to bank}*/
  }
  else if(tabID==6){
    $('#approvelpayment').val(6);
      console.log(tabID);
  }else if(tabID == 7){
    $('#approvelpayment').val(7);
        if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
          uploadDataList(dataFilters, 7);
          $('#uploadDataList').show();
        } else {$('#uploadDataList').hide();}
  }
  else if(tabID == 8){
    $('#approvelpayment').val(8);
        if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
          payment_emo_list(dataFilters, 8);
          $('#uploadDataList').show();
        } else {$('#uploadDataList').hide();}
  }
}


let tableRecordCount = 0;


function get_pending_paymment_list(dataFilters,approveStatus){
  $('#preloader').show();

    $('#tblPaymentPendingList').DataTable().clear().destroy();
    $('#tblPaymentPendingList').DataTable({
        "aLengthMenu": [10, 25, 50,100],
        "pageLength": 50,
        "footer": true,
        "dom": 'Bfrtip',
        "buttons": [
          // {
          //       extend: 'csv',
          //       text: 'CSV',
          //       filename: 'Payment Lists',
          //       exportOptions: {
          //           rows: ':visible', // Export visible rows
          //           modifier: {
          //               selected: null // Export all rows, not just selected
          //           }
          //       }
          //   },
          //   {
          //       extend: 'excel',
          //       text: 'Excel',
          //       filename: 'Payment Lists' // Set custom filename for Excel
          //   },
          //   {
          //       extend: 'pdf',
          //       text: 'PDF',
          //       filename: 'Payment Lists' // Set custom filename for PDF
          //   }
          ],
        "searching": true,
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": APIURL + 'payment_list',
            "type": "POST",
            "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
            "dataType": "JSON",
            "data": function (data) {
              data.fileters = dataFilters;
              data.approveStatus = approveStatus;
              data.user_id = loginUser_id;
            },
          "beforeSend": function () {
            // $('#preloader').show();
            tblPreloaderEnable('tblPaymentPendingList');
          },
          "error": function (xhr, error, thrown) {
                Swal.fire({
                    icon: "error",
                    title: 'Service Error !',
                    showConfirmButton: false,
                    timer: 2000
                });
                $('#preloader').hide();
            },
            "dataSrc": 'data',
          },
        "columns": [
        
            { "data": "checkbox" },
            { "data": "S.No", render: function (data, type, row, meta) {
                return meta.row + meta.settings._iDisplayStart + 1;
                }
            },
            { "data": "scheme_name" },
            { "data": "year_code" },
            { "data": "month_name" },
            { "data": "benificiary_name" },
            { "data": "benificiary_mobile_no"},
            { "data": "payment_mode_name"},
            { "data": "installment_id"},
            { "data": "amount"},
            { "data": "created_dt"},
            { "data": "action" },
            // Add more columns as needed
            // Example: { "data": "complaint_raised_by" },
        ],
        "aoColumnDefs": [{
          'bSortable': false,
          'aTargets': [0]
        }],
        "drawCallback": function (settings) {
            // Your drawCallback logic goes here
            // For example, updating dropdowns or other elements after the table is drawn
        },
        "initComplete": function (settings, json) {
         $('#preloader').hide(); // Hide the preloader after DataTable initialization
         tableRecordCount = json.recordsTotal;
        }
    });  
}



function get_inprogress_paymment_list(dataFilters,approveStatus){

    $('#tblPaymentInprogressList').DataTable().clear().destroy();
    $('#tblPaymentInprogressList').DataTable({
        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        "pageLength": 30, 
        "footer": true,
        "dom": 'Bfrtip',
        "buttons": [
          {
                extend: 'csv',
                text: 'CSV',
                filename: 'Payment Lists',
                exportOptions: {
                    rows: ':visible', // Export visible rows
                    modifier: {
                        selected: null // Export all rows, not just selected
                    }
                }
            },
            {
                extend: 'excel',
                text: 'Excel',
                filename: 'Payment Lists' // Set custom filename for Excel
            },
            {
                extend: 'pdf',
                text: 'PDF',
                filename: 'Payment Lists' // Set custom filename for PDF
            }],
        "searching": true,
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": APIURL + 'payment_list',
            "type": "POST",
            "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
            "dataType": "JSON",
            "data": function (data) {
              data.fileters = dataFilters;
              data.approveStatus = approveStatus;
              data.user_id = loginUser_id;
            },
            "beforeSend": function () {
            $('#preloader').show(); // Show the preloader before sending the request
            tblPreloaderEnable('tblPaymentInprogressList');
            },
            "error": function (xhr, error, thrown) {
                Swal.fire({
                    icon: "error",
                    title: 'Service Error !',
                    showConfirmButton: false,
                    timer: 2000
                });
                $('#preloader').hide();
            },
            "dataSrc": 'data',
        },
        "columns": [
          // { "data": "checkbox" },
            { "data": "S.No", render: function (data, type, row, meta) {
                return meta.row + meta.settings._iDisplayStart + 1;
                }
            },
            { "data": "scheme_name" },
            { "data": "year_code" },
            { "data": "month_name" },
            { "data": "benificiary_name" },
            { "data": "benificiary_mobile_no"},
            { "data": "payment_mode_name"},
            { "data": "installment_id"},
            { "data": "amount"},
            { "data": "created_dt"},
            { "data": "action" },
            // Add more columns as needed
            // Example: { "data": "complaint_raised_by" },
        ],
        "aoColumnDefs": [{
          'bSortable': false,
          'aTargets': [0]
        }],
        "drawCallback": function (settings) {
            // Your drawCallback logic goes here
            // For example, updating dropdowns or other elements after the table is drawn
        },
        "initComplete": function (settings, json) {
        $('#preloader').hide(); // Hide the preloader after DataTable initialization
        tableRecordCount = json.recordsTotal;
        }
    });  
}

$('.failure_reason_lable').hide();

function get_failed_paymment_list(dataFilters,approveStatus,rejected_reason){
  $('.dataTables_filter').hide();
  $('#tblPaymentFailedList').DataTable().clear().destroy();
  $('#tblPaymentFailedList').DataTable({
      // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      "pageLength": 30, 
      "footer": true,
      "dom": 'Bfrtip',
      "buttons": [
        // {
        //       extend: 'csv',
        //       text: 'CSV',
        //       filename: 'Payment Lists',
        //       exportOptions: {
        //           rows: ':visible', // Export visible rows
        //           modifier: {
        //               selected: null // Export all rows, not just selected
        //           }
        //       }
        //   },
        //   {
        //       extend: 'excel',
        //       text: 'Excel',
        //       filename: 'Payment Lists' // Set custom filename for Excel
        //   },
        //   {
        //       extend: 'pdf',
        //       text: 'PDF',
        //       filename: 'Payment Lists' // Set custom filename for PDF
        //   }
        ],
      "searching": true,
      "processing": true,
      "serverSide": true,
      "ajax": {
          "url": APIURL + 'payment_list',
          "type": "POST",
          "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          "dataType": "JSON",
          "data": function (data) {
            data.fileters = dataFilters;
            data.approveStatus = approveStatus;
            data.user_id = loginUser_id;
            data.rejected_reason = rejected_reason;
          },
          "beforeSend": function () {
              $('#preloader').show();
              $('#tblPaymentFailedList_wrapper > .dt-buttons').hide();
              $('#tblPaymentFailedList_filter.dataTables_filter').hide();
              $('.failure_reason_lable').hide();
          },
          "error": function (xhr, error, thrown) {
              Swal.fire({
                  icon: "error",
                  title: 'Service Error !',
                  showConfirmButton: false,
                  timer: 2000
              });
              $('#preloader').hide();
          },
          "dataSrc": 'data',
      },
      "columns": [
          { "data": "checkbox" },
          { "data": "S.No", render: function (data, type, row, meta) {
              return meta.row + meta.settings._iDisplayStart + 1;
              }
          },
          { "data": "scheme_name" },
          { "data": "year_code" },
          { "data": "month_name" },
          { "data": "benificiary_name" },
          { "data": "benificiary_mobile_no"},
          { "data": "payment_mode_name"},
          { "data": "installment_id"},
          { "data": "amount"},
          { "data": "created_dt"},
          // { "data": "rejection_reason"},
          { "data": function (data, type, row, meta) {
            let return_reasons = '';          
            if(data.rejection_reason!==null){
              return_reasons = data.rejection_reason;
            }else{
              return_reasons = data.rejection_reason_code;
            }
            return return_reasons;
          }
          },
          { "data": "action" },
          // Add more columns as needed
          // Example: { "data": "complaint_raised_by" },
      ],
      "aoColumnDefs": [{
            'bSortable': false,
            'aTargets': [0]
          }],
      "drawCallback": function (settings) {
          // Your drawCallback logic goes here
          // For example, updating dropdowns or other elements after the table is drawn
          $('#tblPaymentFailedList_filter.dataTables_filter').show();
          $('#tblPaymentFailedList_wrapper > .dt-buttons').show();
          $('.failure_reason_lable').show();
      },
      "initComplete": function(settings, json) {
        $('#tblPaymentFailedList_filter.dataTables_filter').show();
        $('#tblPaymentFailedList_wrapper > .dt-buttons').show();
        $('.failure_reason_lable').show();
            $('#preloader').hide(); // Hide the preloader after DataTable initialization
            tableRecordCount = json.recordsTotal;
            if (tableRecordCount != 0) {

                // console.log('json rejectio reason ',json.rejected_reson);
                if (json.rejected_reson !== null) {
                      var selectFilterHtml = '<option value="">--All--</option>';
                      let selected;
                      $.each(json.rejected_reson, function(index, reason) {
                          if(rejected_reason == reason.rejection_reason_code){
                            selected = "selected";
                          }else{
                            selected = '';
                          }
                          //reason.rejection_reason_code
                        selectFilterHtml += '<option value="' + reason.rejection_reason_code + '" '+selected+'>' + (reason.rejection_reason ? reason.rejection_reason: reason.rejection_reason_code) +'</option>';
                    });
                    $('#failur_reason_filter').html(selectFilterHtml);
              }
            }else{
              $('.failure_reason_lable').hide();
              $('#tblPaymentFailedList_wrapper > .dt-buttons').hide();
              $('#tblPaymentFailedList_filter.dataTables_filter').hide();
              $('#failur_reason_filter').html('');
            }
        }
  });  
}




$('#failur_reason_filter').on('change',function(){
  var dataFilters = window.localStorage.getItem('filters');
    // alert($(this).val());
    let rejected_reason_value = $(this).val();
    
    get_failed_paymment_list(dataFilters,4,rejected_reason_value);
});


function get_success_paymment_list(dataFilters,approveStatus){
  $('#tblPaymentSuccessList').DataTable().clear().destroy();
  $('#tblPaymentSuccessList').DataTable({
      // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      "pageLength": 30, 
      "footer": true,
      "dom": 'Bfrtip',
      "buttons": [
        {
              extend: 'csv',
              text: 'CSV',
              filename: 'Payment Lists',
              exportOptions: {
                  rows: ':visible', // Export visible rows
                  modifier: {
                      selected: null // Export all rows, not just selected
                  }
              }
          },
          {
              extend: 'excel',
              text: 'Excel',
              filename: 'Payment Lists' // Set custom filename for Excel
          },
          {
              extend: 'pdf',
              text: 'PDF',
              filename: 'Payment Lists' // Set custom filename for PDF
          }],
      "searching": true,
      "processing": true,
      "serverSide": true,
      "ajax": {
          "url": APIURL + 'payment_list',
          "type": "POST",
          "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          "dataType": "JSON",
          "data": function (data) {
            data.fileters = dataFilters;
            data.approveStatus = approveStatus;
            data.user_id = loginUser_id;
          },
          "beforeSend": function () {
            $('#preloader').show(); // Show the preloader before sending the request
           },
          "error": function (xhr, error, thrown) {
              Swal.fire({
                  icon: "error",
                  title: 'Service Error !',
                  showConfirmButton: false,
                  timer: 2000
              });
              $('#preloader').hide();
          },
          "dataSrc": 'data',
      },
      "columns": [
          { "data": "S.No", render: function (data, type, row, meta) {
              return meta.row + meta.settings._iDisplayStart + 1;
              }
          },
          { "data": "scheme_name" },
          { "data": "year_code" },
          { "data": "month_name" },
          { "data": "benificiary_name" },
          { "data": "benificiary_mobile_no"},
          { "data": "payment_mode_name"},
          { "data": "installment_id"},
          { "data": "amount"},
          { "data": "created_dt"},
          { "data": "action" },
          // Add more columns as needed
          // Example: { "data": "complaint_raised_by" },
      ],
      "drawCallback": function (settings) {
          // Your drawCallback logic goes here
          // For example, updating dropdowns or other elements after the table is drawn
      },
      "initComplete": function (settings, json) {
        $('#preloader').hide(); // Hide the preloader after DataTable initialization
        tableRecordCount = json.recordsTotal;
        // $('#tblPaymentFailedList_filter').html(`<label>Search1:<input type="search" class="form-control form-control-sm" placeholder="" aria-controls="tblPaymentFailedList"></label>`);
    }
  });
}


function get_generate_payment_file_pre_list(dataFilters,approveStatus){

$('#tblPaymentFilePreGenerateList').DataTable().clear().destroy();
$('#tblPaymentFilePreGenerateList').DataTable({
    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
    "pageLength": 30, 
    "footer": true,
    "dom": 'Bfrtip',
    "buttons": [
      // {
      //       extend: 'csv',
      //       text: 'CSV',
      //       filename: 'Payment Lists',
      //       exportOptions: {
      //           rows: ':visible', // Export visible rows
      //           modifier: {
      //               selected: null // Export all rows, not just selected
      //           }
      //       }
      //   },
      //   {
      //       extend: 'excel',
      //       text: 'Excel',
      //       filename: 'Payment Lists' // Set custom filename for Excel
      //   },
      //   {
      //       extend: 'pdf',
      //       text: 'PDF',
      //       filename: 'Payment Lists' // Set custom filename for PDF
      //   }
      ],
    "searching": true,
    "processing": true,
    "serverSide": true,
    "ajax": {
        "url": APIURL + 'payment_list',
        "type": "POST",
        "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        "dataType": "JSON",
        "data": function (data) {
          data.fileters = dataFilters;
          data.approveStatus = approveStatus;
          data.user_id = loginUser_id;
        },
        "beforeSend": function () {
            $('#preloader').show(); // Show the preloader before sending the request
        },
        "error": function (xhr, error, thrown) {
            Swal.fire({
                icon: "error",
                title: 'Service Error !',
                showConfirmButton: false,
                timer: 2000
            });
            $('#preloader').hide();
        },
        "dataSrc": 'data',
    },
    "columns": [
      // { "data": "checkbox"},
        { "data": "S.No", render: function (data, type, row, meta) {
            return meta.row + meta.settings._iDisplayStart + 1;
            }
        },
        { "data": "scheme_name" },
        { "data": "year_code" },
        { "data": "month_name" },
        { "data": "benificiary_name" },
        { "data": "benificiary_mobile_no"},
        { "data": "payment_mode_name"},
        { "data": "installment_id"},
        { "data": "amount"},
        { "data": "created_dt"},
        { "data": "action" },
        // Add more columns as needed
        // Example: { "data": "complaint_raised_by" },
    ],
    "aoColumnDefs": [{
      'bSortable': false,
      'aTargets': [0]
    }],
    "drawCallback": function (settings) {
        // Your drawCallback logic goes here
        // For example, updating dropdowns or other elements after the table is drawn
    },
    "initComplete": function (settings, json) {
      // alert('preloader hide is working');
        $('#preloader').hide(); // Hide the preloader after DataTable initialization
        tableRecordCount = json.recordsTotal;
    }
}); 
}


let pre_transfer_to_bank_row_count = 0;

function get_transfer_payment_to_bank_pre_list(dataFilters,approveStatus){

  let selectedScheme = $('#lable_text_scheme_cate').text();
  let yearmonth = $('#lable_text_year_month').text();

$('#tblPaymenTransferList').DataTable().clear().destroy();
$('#tblPaymenTransferList').DataTable({
    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
    "pageLength": 30, 
    "footer": true,
    "dom": 'Bfrtip',
    "buttons": [
        // {
        //     extend: 'csv',
        //     text: 'CSV',
        //     filename: selectedScheme+'-Pre-Transfer-to-Bank-Files-'+yearmonth,
        //     exportOptions: {
        //         rows: ':visible', // Export visible rows
        //         modifier: {
        //             selected: null // Export all rows, not just selected
        //         }
        //     }
        // },
        // {
        //     extend: 'excel',
        //     text: 'Excel',
        //     filename: selectedScheme+'-Pre-Transfer-to-Bank-Files-'+yearmonth // Set custom filename for Excel
        // },
        // {
        //     extend: 'pdf',
        //     text: 'PDF',
        //     filename: selectedScheme+'-Pre-Transfer-to-Bank-Files-'+yearmonth // Set custom filename for PDF
        // }
      ],
    "searching": true,
    "processing": true,
    "serverSide": true,
    "ajax": {
        "url": APIURL + 'payment_transfer_to_bank_list',
        "type": "POST",
        "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        "dataType": "JSON",
        "data": function (data) {
          data.fileters = dataFilters;
          data.approveStatus = approveStatus;
          data.user_id = loginUser_id;
        },
        "beforeSend": function () {
          $('#tblPaymenTransferList_tfoot').hide();
            $('#preloader').show(); // Show the preloader before sending the request
        },
        "error": function (xhr, error, thrown) {
            Swal.fire({
                icon: "error",
                title: 'Service Error !',
                showConfirmButton: false,
                timer: 2000
            });
            $('#preloader').hide();
        },
        "dataSrc": 'data',
    },
    "columns": [
      // { "data": "checkbox" },
        { "data": "S.No", render: function (data, type, row, meta) {
            return meta.row + meta.settings._iDisplayStart + 1;
            }
        },
        { "data": "scheme_name" },
        { "data": "payment_mode" },
        { "data": "benificiary_count" },
        { "data": "total_amount" },
        { "data": "file_created_date"},
        { "data": "file_name"},
        // { "data": "payment_mode_name"},
        // { "data": "installment_id"},
        // { "data": "amount"},
        // { "data": "created_dt"},
        // { "data": "action" },
        // Add more columns as needed
        // Example: { "data": "complaint_raised_by" },
    ],
    "aoColumnDefs": [{
      'bSortable': false,
      'aTargets': [0]
    }],
    "drawCallback": function (settings) {
        // Your drawCallback logic goes here
        // For example, updating dropdowns or other elements after the table is drawn
    },
    "initComplete": function (settings, json) {
        $('#preloader').hide(); // Hide the preloader after DataTable initialization
        tableRecordCount = json.recordsTotal;
        pre_transfer_to_bank_row_count = json.recordsTotal;
    },
    "footerCallback": function (row, data, start, end, display) {
          var api = this.api();

          // console.log('data >>> ', data);

          if(data.length !=0 && data.length != undefined){
          
            let total_table_row =  `<tr>
              <th id="footerColumn0"></th>
              <th id="footerColumn1">Total</th>
              <th id="footerColumn2"></th>
              <th id="footerColumn3"></th>
              <th id="footerColumn4"></th>
              <th id="footerColumn5"></th>
              <th id="footerColumn6"></th>
            </tr>`;
            
            $('#tblPaymenTransferList_tfoot').html(total_table_row);
            $('#tblPaymenTransferList_tfoot').show();
          }else{
           $('#tblPaymenTransferList_tfoot').hide();
          }

          var columnsToSum = [3,4];

          columnsToSum.forEach(function (columnIndex) {
              var sum = api.column(columnIndex, { page: 'current' }).data()
                  .reduce(function (a, b) {
                      var val = parseFloat(b);
                      // return isNaN(val) ? a : a + val;
                      return isNaN(val) ? a : a + val;
                  }, 0);
                  
                  // $('#footerColumn'+columnIndex).text(sum);
                  $('#tblPaymenTransferList_tfoot #footerColumn' + columnIndex).text(sum);

              // console.log("Sum for column " + columnIndex + ": " + sum);

              $(api.column(columnIndex).footer()).html(sum);
          });
      }
});  
}


function downloadTransferToBankPreExcel(){
  if(pre_transfer_to_bank_row_count!=0){
        let selectedScheme = $('#lable_text_scheme_cate').text();
        let yearmonth = $('#lable_text_year_month').text();
        let filename = `${selectedScheme}-Pre-transfer-to-bank-files-${yearmonth}`;

        var userDataString = getCookie('payment_official');
        userDataString = JSON.parse(userDataString);
        window.loginUser_id = userDataString['user_id'];
        $('#preloader').show();
        var dataFilters = window.localStorage.getItem('filters');

        $.ajax({
          url: APIURL + 'payment_transfer_to_bank_list_download',
          method: 'POST',
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: {fileters:dataFilters,approveStatus:6,user_id:loginUser_id},
          dataType: 'json',
          success: function (response) {
            if(response.data!=null){
              exportJsonToExcel(response.data,filename);
            }else{
              $('#preloader').hide();
              Swal.fire({
              icon: "error",
              title: 'Data is Empty !',
              showConfirmButton: false,
              timer: 2000
              });
            }
          },
          error: function (xhr, status, error) {
            $('#preloader').hide();
              Swal.fire({
              icon: "error",
              title: 'Service Error',
              showConfirmButton: false,
              timer: 2000
              });
            console.log("Error:", error);
          }
        });
  }else{
      Swal.fire({
          icon: "error",
          title: "Data Not Found",
          showConfirmButton: false,
          timer: 2000
        })
  }
}


function downloadTransferToBankPreCsv(){
  if(pre_transfer_to_bank_row_count!=0){
        let selectedScheme = $('#lable_text_scheme_cate').text();
        let yearmonth = $('#lable_text_year_month').text();
        let filename = `${selectedScheme}-Pre-transfer-to-bank-files-${yearmonth}`;

        var userDataString = getCookie('payment_official');
        userDataString = JSON.parse(userDataString);
        window.loginUser_id = userDataString['user_id'];
        $('#preloader').show();
        var dataFilters = window.localStorage.getItem('filters');

        $.ajax({
          url: APIURL + 'payment_transfer_to_bank_list_download',
          method: 'POST',
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: {fileters:dataFilters,approveStatus:6,user_id:loginUser_id},
          dataType: 'json',
          success: function (response) {
            if(response.data!=null){
              convertJsonToCsv(response.data,filename);
            }else{
              $('#preloader').hide();
              Swal.fire({
              icon: "error",
              title: 'Data is Empty !',
              showConfirmButton: false,
              timer: 2000
              });
            }
          },
          error: function (xhr, status, error) {
            $('#preloader').hide();
              Swal.fire({
              icon: "error",
              title: 'Service Error',
              showConfirmButton: false,
              timer: 2000
              });
            console.log("Error:", error);
          }
        });
  }else{
      Swal.fire({
          icon: "error",
          title: "Data Not Found",
          showConfirmButton: false,
          timer: 2000
        })
  }
}


function populateDropdown(dropdownId, data, fieldName) {
    const dropdown = document.getElementById(dropdownId);

    // Clear existing options
    //dropdown.innerHTML = '<option value="">--Select--</option>';

    // Populate options from data
    data.forEach(item => {
      const option = document.createElement('option');
      option.value = item[fieldName + '_code'];
      option.textContent = item[fieldName + '_name'];
      dropdown.appendChild(option);
    });
  }



  $('#selectAllCheckbox').on('change', function () {
    // console.log($(this).prop('checked'));
      $('tbody :checkbox').prop('checked', $(this).prop('checked'));
  });

  
  $('#selectAllCheckbox2').on('change', function () {
    // console.log($(this).prop('checked'));
      $('tbody :checkbox').prop('checked', $(this).prop('checked'));
  });

  $('#selectAllCheckbox3').on('change', function () {
    // console.log($(this).prop('checked'));
      $('tbody :checkbox').prop('checked', $(this).prop('checked'));
  });


  function selectApprove(){
      var paymentDate = $('#paymentDate').val();
        if(paymentDate == ''){
          $('#paymentDate_error').show();
          $('#paymentDate').addClass('text-danger');
          var scrollTarget = document.getElementById('paymentDateForm');
          scrollableContainer.scrollTop = scrollTarget.offsetTop;
          return false;
        }

    var userDataString = getCookie('payment_official');
     userDataString = JSON.parse(userDataString);
    let userID = userDataString['user_id'];
    var checkboxValues = [];
    var dataFilters = window.localStorage.getItem('filters');



    $('input[name="pending_check[]"]:checked').each(function () {
      checkboxValues.push($(this).val());
    });

    if (checkboxValues.length === 0) {
      Swal.fire({
          icon: "error",
          title: "Kindly select beneficiary!",
          showConfirmButton: false,
          timer: 2000
        })
    } else {
        // console.log('Checkbox values are present.');
        $('#preloader').show();
        $.ajax({
          url: APIURL+'selectApprove', // Replace with your API endpoint
          method: 'POST',
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: {groupOfarray:checkboxValues,fileters:dataFilters,approveStatus:1,user_id:userID,paymentDate:paymentDate},
          dataType: 'json',
          success: function (response) {
            $('#preloader').hide();
            $('#paymentDate').val('');
            if(response.success == 1)
            {
              output = response.data;
              // console.log(output);
              Swal.fire({
                icon: "success",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
              });
              setTimeout(() => {
                get_pending_paymment_list(dataFilters,1);
              }, 2000);
            }
            else if(response.success == 0)
            {
              $('#preloader').hide();
              Swal.fire({
                icon: "error",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
              })
              //$('#div_make_payment').addClass('d-none');
            }
          },
          error: function () {
            $('#paymentDate').val('');
            $('#preloader').hide();
            Swal.fire({
              icon: "error",
              title: "Service Error!",
              showConfirmButton: false,
              timer: 2000
            })
          }
        });
    }
  }

  let intervalId;
  
  $('#pending_approval_processing').hide();
  $('#paymentDate_error').hide();
  $('#reinitiatePaymentDate_error').hide();

  $('#paymentDate').removeClass('text-danger');


let buklApproveSummary = [];
let buklApproveSummaryTotalCount = 0;
  function allApprove(){
      // checPaymentvalidate(paymentDate);
      $('#allApprovalPermissionEnable').prop('disabled',true);
      
    var input_schemCode = $('#ddl_scheme_code').val();
    var input_schemName = $('#ddl_scheme_name').val();
    var input_subScheme = $('#ddl_sub_scheme').val();
    var input_dep = $('#ddl_department').val();
    var input_subDep = $('#ddl_sub_department').val();
    var input_dateMonthYear = $('#dayWeekMonthFilter').val();

    let selectedScheme = $('#lable_text_scheme_cate').text();
    let yearmonth = $('#lable_text_year_month').text();

  if(input_schemCode !='' && input_schemName !='' && input_subScheme !='' && input_dep !='' && input_subDep !='' && input_dateMonthYear != ''){
          var paymentDate = $('#paymentDate').val();
            if(paymentDate == ''){
              $('#paymentDate_error').show();
              $('#paymentDate').addClass('text-danger');
              var scrollTarget = document.getElementById('paymentDateForm');
              scrollableContainer.scrollTop = scrollTarget.offsetTop;
              return false;
          }else{
              $("#formFilters").submit();
             $('.blulkapproveSummary').modal({backdrop: 'static',keyboard: false}).modal('show');
             $('#bulkApproveCloseBtn').hide();
              var dataFilters = window.localStorage.getItem('filters');
              var approveStatus = 1;
              $('#preloader').show();
              $('#tblBulkApproveSummary').DataTable().clear().destroy();
              $('#tblBulkApproveSummary').DataTable({
              "aLengthMenu": [10, 25, 50,100],
              "pageLength": -1,
              "footer": true,
              "dom": 'Bfrtip',
              "buttons": [
              {
                  extend: 'csv',
                  text: 'CSV',
                  filename: selectedScheme+'-bulk-approval-summary-'+yearmonth,
                  exportOptions: {
                      rows: ':visible', // Export visible rows
                      modifier: {
                          selected: null // Export all rows, not just selected
                      }
                  }
              },
              {
                  extend: 'excel',
                  text: 'Excel',
                  filename: selectedScheme+'-bulk-approval-summary-'+yearmonth // Set custom filename for Excel
              },
              {
                  extend: 'pdf',
                  text: 'PDF',
                  filename: selectedScheme+'-bulk-approval-summary-'+yearmonth // Set custom filename for PDF
              }],
              "searching": true,
              "processing": true,
              "serverSide": true,
              "ajax": {
              "url": APIURL + 'fn_payment_getbulkapprovestatistic',
              "type": "POST",
              "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
              "dataType": "JSON",
              "data": function (data) {
                data.fileters = dataFilters;
                data.approveStatus = approveStatus;
                data.user_id = loginUser_id;
              },
              "beforeSend": function () {
                $('#tblBulkApproveSummary_tfoot').hide();
                $('#preloader').show(); // Show the preloader before sending the request
                tblPreloaderEnable('tblBulkApproveSummary');
              },
              "error": function (xhr, error, thrown) {
                  Swal.fire({
                      icon: "error",
                      title: 'Service Error !',
                      showConfirmButton: false,
                      timer: 2000
                  });
                  $('#preloader').hide();
              },

              "dataSrc": 'data',
              },
              "columns": [

              // { "data": "checkbox" },
              { "data": "S.No", render: function (data, type, row, meta) {
                  return meta.row + meta.settings._iDisplayStart + 1;
                  }
              },
              { "data": "scheme_name" },
              { "data": "distrinct_name" },
              { "data": "taluk_name" },
              { "data": "yyyymm"},
              { "data": "trackingID",
              "render": function (data, type, row) {
                return '<a href ="#" style="cursor:default !important;text:decoration:none !important;" id="bulk_'+data+'"><span class="badge bg-warning btn-sm cursor-auto"><i class="bi bi-check2-circle"></i> Yet to Approval</span></a>';
              }},
              { "data": "apb_benificiaries_count" },
              { "data": "apb_benificiaries_amount"},
              { "data": "ach_benificiaries_count"},
              { "data": "ach_benificiaries_amount"},
              { "data": "total_count"},
              { "data": "total_value"},
            
              // { 
              //   // "data": "Total count", 
              //   "render": function (data, type, row, meta) {
              //   // Check if the properties are defined before accessing them
              //     var apbCount = row.apb_benificiaries_count || 0;
              //     var achCount = row.ach_benificiaries_count || 0;
              //     return apbCount + achCount;
              //   }
              // },
              // { 
              //   // "data": "Total Amount", 
              //   "render": function (data, type, row, meta) {
              //   // Check if the properties are defined before accessing them
              //     var apbAmount = row.apb_benificiaries_amount || 0;
              //     var achAmount = row.ach_benificiaries_amount || 0;
              //     return parseInt(apbAmount) + parseInt(achAmount);
              //   }
              // },

              // Add more columns as needed
              // Example: { "data": "complaint_raised_by" },
              ],
              "aoColumnDefs": [{
              'bSortable': false,
              'aTargets': [0]
              }],
              "drawCallback": function (settings) {
              // Your drawCallback logic goes here
              // For example, updating dropdowns or other elements after the table is drawn
              },
              "initComplete": function (settings, json) {
                $('#preloader').hide(); // Hide the preloader after DataTable initialization
                buklApproveSummary = json.data;
                $('#tblBulkApproveSummary_action_status').hide();
                if (!buklApproveSummary || buklApproveSummary.length === 0) {     
                    $('#allApprovalPermissionEnable').hide();  
                    $('#allApprovalPermissionEnable').prop('disabled', true);
                  } else {
                    $('#allApprovalPermissionEnable').show();
                    $('#allApprovalPermissionEnable').prop('disabled', false);
                  }
                  buklApproveSummaryTotalCount = buklApproveSummary.length;

                  
              },
              "footerCallback": function (row, data, start, end, display) {
                  var api = this.api();

                  // console.log('data >>> ', data);

                  if(data.length !=0 && data.length != undefined){

                    let total_table_row =  `<tr>
                      <th id="footerColumn0"></th>
                      <th id="footerColumn1"></th>
                      <th id="footerColumn2">Total</th>
                      <th id="footerColumn3"></th>
                      <th id="footerColumn4"></th>
                      <th id="footerColumn5"></th>
                      <th id="footerColumn6"></th>
                      <th id="footerColumn7"></th>
                      <th id="footerColumn8"></th>
                      <th id="footerColumn9"></th>
                      <th id="footerColumn10"></th>
                      <th id="footerColumn11"></th>
                    </tr>`;
                    $('#tblBulkApproveSummary_tfoot').html(total_table_row);

                    $('#tblBulkApproveSummary_tfoot').show();
                  }else{
                    $('#tblBulkApproveSummary_tfoot').hide();
                  }

                  var columnsToSum = [6,7,8,9,10,11];

                  columnsToSum.forEach(function (columnIndex) {
                      var sum = api.column(columnIndex, { page: 'current' }).data()
                          .reduce(function (a, b) {
                              var val = parseFloat(b);
                              // return isNaN(val) ? a : a + val;
                              return isNaN(val) ? a : a + val;
                          }, 0);
                          
                          $('#tblBulkApproveSummary_tfoot #footerColumn'+columnIndex).text(sum);

                      // console.log("Sum for column " + columnIndex + ": " + sum);

                      $(api.column(columnIndex).footer()).html(sum);
                  });
              }
              }); 
          }
  }
  else{
      Swal.fire({
          icon: "error",
          title: "Select must scheme code, scheme name,Subscheme, department, sub department and payment period",
          showConfirmButton: true,
          timer: 2000
      });
    $("#formFilters").submit();
    $("html, body").animate({ scrollTop: 0 }, 3000);
  }
}

$('#tblBulkApproveSummary_action_status').hide();

function allApprovalPermissionEnable(){
  // console.log('all approvel enabled clicked');
  // console.log('bukl Approve Summary', buklApproveSummary);

  $('#allApprovalPermissionEnable').prop('disabled',true);
  $('#allApprovalPermissionEnable').hide();

  buklApproveSummary.forEach(items => {
    if(items.status == 0){
      $('#bulk_'+items.trackingID).html(`<span class="badge bg-warning btn-sm cursor-auto"><i class="bi bi-check2-circle"></i> Yet to Approve </span>`);
    }
  });

  if (buklApproveSummary.length > 0) {
      const batchSize = 5;
      var  trackingIDArr = buklApproveSummary.filter(n => n.status == 0);
      var runningprocess = buklApproveSummary.filter(n => n.status == 1);

      var loopcounter = batchSize;
      loopcounter = loopcounter - runningprocess.length;
      
      if (loopcounter > 0)
      {
        if (loopcounter > trackingIDArr.length)
        {
           loopcounter = trackingIDArr.length;
        }
        bulkApproveProcessBatch(0,loopcounter,trackingIDArr);
      }
  } else {
      Swal.fire({
          icon: "error",
          title: 'Summary is Empty !',
          showConfirmButton: false,
          timer: 2000
      });
  }

}



function bulkApproveProcessBatch(startIndex, loopcounter, trackingIDArr){

  var paymentDate = $('#paymentDate').val();
  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  let userID = userDataString['user_id'];
  var dataFilters = window.localStorage.getItem('filters');

  let transferToPaymentUniqId = [];
    // const endIndex = Math.min(startIndex + loopcounter, bulkTransferPaymentProcessSummary.length);

    for (let i = startIndex; i < loopcounter; i++) {

      // console.log(trackingIDArr[i]);

      // transferToPaymentUniqId.push(trackingIDArr[i].trackingID);
      $.each( buklApproveSummary, function( j, obj ) {
            if(obj.trackingID == trackingIDArr[i].trackingID){           
              obj.status = 1;
            }
          });

          // $('.blulkapproveSummary .modal-body').scrollTop($('#bulk_'+trackingIDArr[i].trackingID).offset().top);
          $('#bulk_'+trackingIDArr[i].trackingID).focus();
      $.ajax({
        url: APIURL+'allApprove',
        method: 'POST',
        headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { fileters: dataFilters,summaryDistrictCode:trackingIDArr[i].district_code,summaryTalukCode:trackingIDArr[i].taluk_code, approveStatus: 1,user_id:userID,trackingId:trackingIDArr[i].trackingID,paymentDate:paymentDate},
        dataType: 'json',
        success: function (response) {
          if(response.success == 0){
            let ouput = response.data;
            
            $('#bulk_' + ouput.trackingid).html('<span class="badge bg-danger btn-sm">Failed !</span>');
            $.each(buklApproveSummary, function( j, obj ) {
                if(obj.trackingID == ouput.trackingid){         
                  obj.status = 3;
                }
            });
            // $('.blulkapproveSummary .modal-body').scrollTop($('#bulk_'+ouput.trackingid).offset().top)
          }
        },
        error: function (xhr, status, error) {

          $('#bulk_' + trackingIDArr[i].trackingID).html('<span class="badge bg-danger btn-sm">Failed !</span>');
            $.each(buklApproveSummary, function( j, obj ) {
                if(obj.trackingID == trackingIDArr[i].trackingID){         
                  obj.status = 3;
                }
            });
            // $('.blulkapproveSummary .modal-body').scrollTop($('#bulk_'+trackingIDArr[i].trackingID).offset().top);
          console.log("Error:", error);
        }
        });
          bulkApproveUpdatestatus(trackingIDArr[i].trackingID);
      $('#preloader').hide();
    }
}

function bulkApproveUpdatestatus(trakingId){
  
  $('#preloader').hide();
  $.ajax({
      url: APIURL + 'bulkApprovalStatus',
      method: 'POST',
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: { trackingId: trakingId },
      dataType: 'json',
      success: function (response) {
        $('#preloader').hide();
        let output = response.data[0];
        if (output.status == 2) {
          $('#bulk_'+trakingId).html('<span class="badge bg-success btn-sm"><i class="bi bi-check2-circle"></i>' + output.updated_count + ' Approved </span>');
          $.each( buklApproveSummary, function( j, obj ) {
            if(obj.trackingID == trakingId){         
              obj.status = 2;
            }
            // $('.blulkapproveSummary .modal-body').scrollTop($('#bulk_'+trakingId).offset().top);
          });

          var  pendingSummary = buklApproveSummary.filter(n => n.status == 0);
          var  runningCount = buklApproveSummary.filter(n => n.status == 1);
          var checkCount = pendingSummary.length + runningCount.length;
          console.log('check count >> ',checkCount);
          if(checkCount!=0){
            allApprovalPermissionEnable();
          }
        } else {
          var failedTrackid = buklApproveSummary.filter(n => n.status == 3);

          // If the tracking ID is not in the failedTrackid array, update the HTML content
          if (failedTrackid.every(failedObj => failedObj.trackingID !== trakingId)) {
              $('#bulk_'+trakingId).html('<span class="badge bg-info btn-sm">' + output.updated_count + ' In-progress</span>');
              setTimeout(() => { bulkApproveUpdatestatus(trakingId);}, 3000);
          }else{
            var  pendingSummary = buklApproveSummary.filter(n => n.status == 0);
          var  runningCount = buklApproveSummary.filter(n => n.status == 1);
          var checkCount = pendingSummary.length + runningCount.length;
          console.log('check count >> ',checkCount);
          if(checkCount!=0){
            allApprovalPermissionEnable();
          }
            // allApprovalPermissionEnable();
          }
          
        }

        var successArr = buklApproveSummary.filter(n => n.status == 2);
        var failedArr = buklApproveSummary.filter(n => n.status == 3);
        
        let successAndFailedCount = successArr.length + failedArr.length;

        if(buklApproveSummaryTotalCount == successAndFailedCount){
          $('#tblBulkApproveSummary_action_status').show();
          $('#tblBulkApproveSummary_action_total').text(successAndFailedCount);
          $('#tblBulkApproveSummary_action_success').text(successArr.length);
          $('#tblBulkApproveSummary_action_failed').text(failedArr.length);
          // debugger;
          $('#bulkApproveCloseBtn').show();
          $('#paymentDate').val('');
        }

      },
      error: function (xhr, status, error) {
        console.log("Error:", error);
      }
    });
    $('#preloader').hide();
}

$('#bulkApproveCloseBtn').on('click',function(){
  tabClickValue(0);
});



// function allApprovalPermissionEnable(){
//   // console.log('bulk aproval count');
//   // console.log(buklApproveSummary);

//   // buklApproveSummary.forEach(summaryParems => {
//   //  console.log(summaryParems.district_code);
//   //   console.log(summaryParems.taluk_code);
//   // });
  

//   var paymentDate = $('#paymentDate').val();
//     var userDataString = getCookie('payment_official');
//        userDataString = JSON.parse(userDataString);
//       let userID = userDataString['user_id'];
//       var dataFilters = window.localStorage.getItem('filters');
      
//       const uniqueId = generateUniqueId();
//       console.log(uniqueId);
//       // window.localStorage.removeItem('bulkApprvelID');
//       window.localStorage.setItem('bulkApprvelID', uniqueId);
      
//         // Swal.fire({
//         //   title: "Are you sure?",
//         //   text: "A list of all pending payments is processed for approval as you have selected above!",
//         //   icon: "warning",
//         //   showCancelButton: true,
//         //   confirmButtonColor: "#DD6B55",
//         //   confirmButtonText: "Yes, All Approve it!",
//         //   cancelButtonText: "No, cancel plx!",
//         //   focusConfirm: false,
//         //   allowOutsideClick: false
//         // }).then((result) => {
//         //   if (result.isConfirmed) {
//             let totalSummaryCount = 0; // Initialize as a number

//             buklApproveSummary.forEach(totalSUmmary => {
//             // Calculate the sum for each item
//             const sum = parseInt(totalSUmmary.ach_benificiaries_count) + parseInt(totalSUmmary.apb_benificiaries_count);
//             // Add the sum to the total
//             totalSummaryCount += sum;
//             });

//             console.log(totalSummaryCount);

//             $('#preloader').hide();
//             let bulkApprveIDGroupup = [];
//               buklApproveSummary.forEach((summaryParems, index) => {
//                   const uniqueId = generateUniqueId();
//                   console.log(uniqueId);
//                   // window.localStorage.removeItem('bulkApprvelID');
//                   bulkApprveIDGroupup.push(uniqueId);
//                   setTimeout(() => {
//                     $.ajax({
//                         url: APIURL + 'allApprove',
//                         method: 'POST',
//                         headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
//                         data: { fileters: dataFilters,summaryDistrictCode:summaryParems.district_code,summaryTalukCode:summaryParems.taluk_code, approveStatus: 1,user_id:userID,trackingId:uniqueId,paymentDate:paymentDate},
//                         dataType: 'json',
//                         async: true,
//                     });
//                   }, index * 200);
//               });
            
//                window.localStorage.setItem('bulkApprvelID', bulkApprveIDGroupup);
               
//               Swal.fire({
//                   icon: "success",
//                   title: "Pending Payment Bulk Approve Initiated",
//                   showConfirmButton: false,
//                   timer: 2000
//               });

//             //  intervalId = setInterval(getCurrentBulkApprovalCount, 2000);
//             setTimeout(function() {getCurrentBulkApprovalCount();}, 3000);
            
//             window.localStorage.setItem('bulkApprvelstatustrigger',0);
//             $('#paymentDate').val('');
// }





let checkValue = window.localStorage.getItem('bulkApprvelstatustrigger');

// if (checkValue != undefined && checkValue != '' && checkValue == 0) {
  //  intervalId = setInterval(getCurrentBulkApprovalCount, 3000);
// }
intervalId = 1;
// setTimeout(function() {getCurrentBulkApprovalCount();},200);

$('#progress_strat').hide();
$('#selectApprovalBtn').hide();
$('#bulkApprovalBtn').hide();
$('#progress_strat').hide();

var showColletionData = true;

function getCurrentBulkApprovalCount() {
  $('#selectApproval').show();
    $('#bulkApproval').show();
    let getTriggerid = window.localStorage.getItem('bulkApprvelID');
    var dataFilters = window.localStorage.getItem('filters');
    console.log('get trigger id');
    console.log(getTriggerid);
  if(intervalId !== undefined){
    // $('#preloader').hide();
    if (intervalId == 1) {
      $('#progress_strat').show();
    }

    console.log('intervalId', intervalId);

    if(intervalId ==1){
      get_pending_paymment_list(dataFilters,1);
    }

    $('#selectApproval').hide();
    $('#bulkApproval').hide();
    $('#selectApprovalBtn').show();
    $('#bulkApprovalBtn').show();

    
    $.ajax({
      url: APIURL + 'bulkApprovalStatus',
      method: 'POST',
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: { trackingId: getTriggerid },
      dataType: 'json',
      success: function (response) {
        console.log('bulkapproval status response >>> ', response.data);
        var output = response.data[0];

        if (output.status ==1 || output.status ==2 ||output.status ==0) {
          showColletionData = false;
          $('#progress_strat').hide();
          $('#pending_approval_processing').show();
          
          if(output.status ==1 ||output.status ==0){
            setTimeout(function() {getCurrentBulkApprovalCount();}, 5000);
          }
          
          if (output.status == 2) {
            console.log('clearInterval path enable');            
            $('#pending_approval_processing').hide();
            $('#selectApproval').show();
            $('#bulkApproval').show();
            $('#selectApprovalBtn').hide();
            $('#bulkApprovalBtn').hide();
            // clearInterval(intervalId);
            window.localStorage.setItem('bulkApprvelstatustrigger', output.status);
            
            /* just One time loaded table*/
            // if(intervalId ==1){
            //   console.log('increment interval id', intervalId);
              get_pending_paymment_list(dataFilters,1);
            // }

            
          } else {
            $('#pending_approval_processing_count').text(output.updated_count);
            $('#pending_approval_processing_total_count').text(output.total_count);
            window.localStorage.setItem('bulkApprvelstatustrigger', output.status);
          }
        } else {
          $('#progress_strat').hide();
        }

        intervalId++;
      },
        error: function(xhr, status, error) {
          // $('#preloader').hide();
          console.log("Error:", error);
        }
    });
  }
  
}


function reInitiateApprove(){

  var reinitiatePaymentDate = $('#reinitiatePaymentDate').val();
  if(reinitiatePaymentDate == ''){
        $('#reinitiatePaymentDate_error').show();
        $('#reinitiatePaymentDate').addClass('text-danger');
          var scrollTarget = document.getElementById('reinitiatePaymentDateForm');
          if (scrollTarget) {
              document.body.scrollTop = scrollTarget.offsetTop;
              document.documentElement.scrollTop = scrollTarget.offsetTop;
          }
        return false;
    }

    var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    let userID = userDataString['user_id'];
    var checkboxValues = [];
    var dataFilters = window.localStorage.getItem('filters');

   

    $('input[name="failed_check[]"]:checked').each(function () {
    checkboxValues.push($(this).val());
    });
    if (checkboxValues.length === 0) {
      Swal.fire({
          icon: "error",
          title: "Kindly select beneficiary!",
          showConfirmButton: false,
          timer: 2000
        })
    } else {
      $('#preloader').show();
        // console.log('Checkbox values are present.');
        $.ajax({
          url: APIURL+'reinitiateApprove', // Replace with your API endpoint
          method: 'POST',
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: {groupOfarray:checkboxValues,fileters:dataFilters,approveStatus:4,user_id:userID,payment_date:reinitiatePaymentDate},
          dataType: 'json',
          success: function (response) {
            $('#preloader').hide();
            $('#reinitiatePaymentDate').val('');
            if(response.success == 1)
            {
              output = response.data;
              console.log(output);
              Swal.fire({
                icon: "success",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
              });
              setTimeout(() => {
                get_failed_paymment_list(dataFilters,4,null);
              }, 2000);
            }
            else if(response.success == 0)
            {
              Swal.fire({
                icon: "error",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
              })
              //$('#div_make_payment').addClass('d-none');
            }
          },
          error: function () {
            $('#preloader').hide();
            Swal.fire({
              icon: "error",
              title: "Service Error!",
              showConfirmButton: false,
              timer: 2000
            })
          }
        });

    }

}



// failureToEmoBulkApprove ------

let failureToEmoBulkApproveArr = [];
let failureToEmoBulkApproveArrCount = 0;
  function failureToEmoBulkApprove(){
      // checPaymentvalidate(paymentDate);
      $('#allApprovalEmo').prop('disabled',true);
      $('#allApproveCloseBtn').prop('disabled',false);
      $('#allApproveCloseBtn').show();
      
    var input_schemCode = $('#ddl_scheme_code').val();
    var input_schemName = $('#ddl_scheme_name').val();
    var input_subScheme = $('#ddl_sub_scheme').val();
    var input_dep = $('#ddl_department').val();
    var input_subDep = $('#ddl_sub_department').val();
    var input_dateMonthYear = $('#dayWeekMonthFilter').val();

  if(input_schemCode !='' && input_schemName !='' && input_subScheme !='' && input_dep !='' && input_subDep !='' && input_dateMonthYear != ''){

    let selectedScheme = $('#lable_text_scheme_cate').text();
    let yearmonth = $('#lable_text_year_month').text();
          // var paymentDate = $('#reinitiatePaymentDate').val();
          //   if(paymentDate == ''){
          //     $('#reinitiatePaymentDate_error').show();
          //     $('#reinitiatePaymentDate').addClass('text-danger');
              
          //     var scrollTarget = document.getElementById('reinitiatePaymentDateForm');
          //     if (scrollTarget) {
          //         document.body.scrollTop = scrollTarget.offsetTop;
          //         document.documentElement.scrollTop = scrollTarget.offsetTop;
          //     }
          //     return false;
          // }else{
            let reason_code = $('#failur_reason_filter').val();
              $("#formFilters").submit();
             $('.emoBlulkapproveSummary').modal({backdrop: 'static',keyboard: false}).modal('show');
              var dataFilters = window.localStorage.getItem('filters');
              var approveStatus = 1;
              $('#preloader').show();
              $('#tblEmoBulkApproveSummary').DataTable().clear().destroy();
              $('#tblEmoBulkApproveSummary').DataTable({
              "aLengthMenu": [10, 25, 50,100],
              "pageLength": -1,
              "footer": true,
              "dom": 'Bfrtip',
              "buttons": [
              {
                  extend: 'csv',
                  text: 'CSV',
                  filename: selectedScheme+'-Bulk EMO Transfer Summary-'+yearmonth,
                  exportOptions: {
                      rows: ':visible', // Export visible rows
                      modifier: {
                          selected: null // Export all rows, not just selected
                      }
                  }
              },
              {
                  extend: 'excel',
                  text: 'Excel',
                  filename: selectedScheme+'-Bulk EMO Transfer Summary-'+yearmonth // Set custom filename for Excel
              },
              {
                  extend: 'pdf',
                  text: 'PDF',
                  filename: selectedScheme+'-Bulk EMO Transfer Summary-'+yearmonth // Set custom filename for PDF
              }],
              "searching": true,
              "processing": true,
              "serverSide": true,
              "ajax": {
              "url": APIURL + 'emo_bulk_summary',
              "type": "POST",
              "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
              "dataType": "JSON",
              "data": function (data) {
                data.fileters = dataFilters;
                data.approveStatus = approveStatus;
                data.user_id = loginUser_id;
                data.reason_code = reason_code;
              },
              "beforeSend": function () {
                $('#tblEmoBulkApproveSummary_tfoot').hide();
                $('#preloader').show(); // Show the preloader before sending the request
                tblPreloaderEnable('tblEmoBulkApproveSummary');
              },
              "error": function (xhr, error, thrown) {
                  Swal.fire({
                      icon: "error",
                      title: 'Service Error !',
                      showConfirmButton: false,
                      timer: 2000
                  });
                  $('#preloader').hide();
              },

              "dataSrc": 'data',
              },
              "columns": [

              // { "data": "checkbox" },
              { "data": "S.No", render: function (data, type, row, meta) {
                  return meta.row + meta.settings._iDisplayStart + 1;
                  }
              },
              { "data": "scheme_name" },
              { "data": "distrinct_name" },
              { "data": "taluk_name" },
              { "data": "yyyymm"},
              { "data": "trackingID",
              "render": function (data, type, row) {
                return '<a href ="#" style="cursor:default !important;text:decoration:none !important;" id="bulk_'+data+'"><span class="badge bg-warning btn-sm cursor-auto"><i class="bi bi-check2-circle"></i> Yet to Transfer</span></a>';
              }},
              { "data": "apb_benificiaries_count" },
              { "data": "apb_benificiaries_amount"},
              { "data": "ach_benificiaries_count"},
              { "data": "ach_benificiaries_amount"},
              { "data": "total_count"},
              { "data": "total_value"},

              // Add more columns as needed
              // Example: { "data": "complaint_raised_by" },
              ],
              "aoColumnDefs": [{
              'bSortable': false,
              'aTargets': [0]
              }],
              "drawCallback": function (settings) {
              // Your drawCallback logic goes here
              // For example, updating dropdowns or other elements after the table is drawn
              },
              "initComplete": function (settings, json) {
                $('#preloader').hide(); // Hide the preloader after DataTable initialization
                failureToEmoBulkApproveArr = json.data;
                $('#tblEmoBulkApproveSummary_action_status').hide();
                    
                if (typeof failureToEmoBulkApproveArr === 'undefined' || failureToEmoBulkApproveArr === null) {
                  failureToEmoBulkApproveArr = [];
                } else {
                  failureToEmoBulkApproveArrCount = failureToEmoBulkApproveArr.length;
                }

                if (!failureToEmoBulkApproveArr || failureToEmoBulkApproveArr.length === 0) {                
                    $('#allApprovalEmo').prop('disabled', true);
                    $('#allApprovalEmo').hide();
                  } else {
                    $('#allApprovalEmo').prop('disabled', false);
                    $('#allApprovalEmo').show();
                  }
              },
                "footerCallback": function (row, data, start, end, display) {
                var api = this.api();

                // console.log('data >>> ', data);

                if(data.length !=0 && data.length != undefined){

                let total_table_row =  `<tr>
                    <th id="footerColumn0"></th>
                    <th id="footerColumn1"></th>
                    <th id="footerColumn2">Total</th>
                    <th id="footerColumn3"></th>
                    <th id="footerColumn4"></th>
                    <th id="footerColumn5"></th>
                    <th id="footerColumn6"></th>
                    <th id="footerColumn7"></th>
                    <th id="footerColumn8"></th>
                    <th id="footerColumn9"></th>
                    <th id="footerColumn10"></th>
                    <th id="footerColumn11"></th>
                </tr>`;
                $('#tblEmoBulkApproveSummary_tfoot').html(total_table_row);

                  $('#tblEmoBulkApproveSummary_tfoot').show();
                }else{
                  $('#tblEmoBulkApproveSummary_tfoot').hide();
                }

                var columnsToSum = [6,7,8,9,10,11];

                columnsToSum.forEach(function (columnIndex) {
                var sum = api.column(columnIndex, { page: 'current' }).data()
                  .reduce(function (a, b) {
                      var val = parseFloat(b);
                      return isNaN(val) ? a : a + val;
                  }, 0);
                  $('#tblEmoBulkApproveSummary_tfoot #footerColumn'+columnIndex).text(sum);
                // console.log("Sum for column " + columnIndex + ": " + sum);

                $(api.column(columnIndex).footer()).html(sum);
                });
                }
              }); 
          // }
  }
  else{
      Swal.fire({
          icon: "error",
          title: "Select must scheme code, scheme name,Subscheme, department, sub department and payment period",
          showConfirmButton: true,
          timer: 2000
      });
    $("#formFilters").submit();
    $("html, body").animate({ scrollTop: 0 }, 3000);
  }
}



$('#tblEmoBulkApproveSummary_action_status').hide();

function allApprovalEmo(){
// console.log('all approvel enabled clicked');
  
  // $('#allApproveCloseBtn').prop('disabled',true);
  $('#allApprovalEmo').prop('disabled',true);
  
  $('#allApprovalEmo').hide();
  $('#allApproveCloseBtn').hide();

  failureToEmoBulkApproveArr.forEach(items => {
    if(items.status == 0){
      $('#bulk_'+items.trackingID).html(`<span class="badge bg-warning btn-sm cursor-auto"><i class="bi bi-check2-circle"></i> Yet to Transfer</span>`);
    }
  });
  

  if (failureToEmoBulkApproveArr.length > 0) {
      const batchSize = 5;
      var  trackingIDArr = failureToEmoBulkApproveArr.filter(n => n.status == 0);
      var runningprocess = failureToEmoBulkApproveArr.filter(n => n.status == 1);

      var loopcounter = batchSize;
      loopcounter = loopcounter - runningprocess.length;
      
      if (loopcounter > 0)
      {
        if (loopcounter > trackingIDArr.length)
        {
           loopcounter = trackingIDArr.length;
        }
        failureToEmoBulkApproveProcessBatch(0,loopcounter,trackingIDArr);
      }
  } else {
      Swal.fire({
          icon: "error",
          title: 'Summary is Empty !',
          showConfirmButton: false,
          timer: 2000
      });
  }

}



function failureToEmoBulkApproveProcessBatch(startIndex, loopcounter, trackingIDArr){
  let reason_code = $('#emo_reason_code').val();
  var reinitiatePaymentDate = $('#reinitiatePaymentDate').val();
  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  let userID = userDataString['user_id'];
  var dataFilters = window.localStorage.getItem('filters');

  let transferToPaymentUniqId = [];

    for (let i = startIndex; i < loopcounter; i++) {

      // console.log(trackingIDArr[i]);

      $.each( failureToEmoBulkApproveArr, function( j, obj ) {
            if(obj.trackingID == trackingIDArr[i].trackingID){           
              obj.status = 1;
            }
          });

          $('#bulk_'+trackingIDArr[i].trackingID).focus();
       //   $('.emoBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+trackingIDArr[i].trackingID).offset().top);

      $.ajax({
        url: APIURL+'emoAllApprove',
        method: 'POST',
        headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { fileters: dataFilters,summaryDistrictCode:trackingIDArr[i].district_code,summaryTalukCode:trackingIDArr[i].taluk_code, approveStatus: 1,user_id:userID,trackingId:trackingIDArr[i].trackingID,paymentDate:reinitiatePaymentDate,reason_code:reason_code},
        dataType: 'json',
        success: function (response) {
          if(response.success == 0){
            let ouput = response.data;
            
            $('#bulk_' + ouput.trackingid).html('<span class="badge bg-danger btn-sm">Failed !</span>');
            $.each(failureToEmoBulkApproveArr, function( j, obj ) {
                if(obj.trackingID == ouput.trackingid){         
                  obj.status = 3;
                }
            });
            // $('.emoBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+ouput.trackingid).offset().top);
          }
          
        },
        error: function (xhr, status, error) {
          $('#bulk_' + trackingIDArr[i].trackingID).html('<span class="badge bg-danger btn-sm">Failed !</span>');
            $.each(failureToEmoBulkApproveArr, function( j, obj ) {
                if(obj.trackingID == trackingIDArr[i].trackingID){         
                  obj.status = 3;
                }
            });
            // $('.emoBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+trackingIDArr[i].trackingID).offset().top);
          console.log("Error:", error);
        }
        });
          failureToEmoBulkApproveUpdatestatus(trackingIDArr[i].trackingID);
      $('#preloader').hide();
    }
}

function failureToEmoBulkApproveUpdatestatus(trakingId){
  $('#preloader').hide();
  $.ajax({
      url: APIURL + 'bulkApprovalStatus',
      method: 'POST',
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: { trackingId: trakingId },
      dataType: 'json',
      success: function (response) {
        $('#preloader').hide();
        let output = response.data[0];
        if (output.status == 2) {
          $('#bulk_'+trakingId).html('<span class="badge bg-success btn-sm"><i class="bi bi-check2-circle"></i>' + output.updated_count + ' Transferred</span>');
          $.each( failureToEmoBulkApproveArr, function( j, obj ) {
            if(obj.trackingID == trakingId){         
              obj.status = 2;
            }
          });
          //  $('.emoBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+trakingId).offset().top);
          console.log($('#bulk_'+trakingId));
          allApprovalEmo();
          
        } else {
          var failedTrackid = failureToEmoBulkApproveArr.filter(n => n.status == 3);

          if (failedTrackid.every(failedObj => failedObj.trackingID !== trakingId)) {
              $('#bulk_'+trakingId).html('<span class="badge bg-info btn-sm">' + output.updated_count + ' In-progress</span>');
              setTimeout(() => { failureToEmoBulkApproveUpdatestatus(trakingId);}, 3000);
          }else{
            console.log($('#bulk_'+trakingId));
          //  $('.emoBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+trakingId).offset().top);
            allApprovalEmo();
          }
        }

          var successArr = failureToEmoBulkApproveArr.filter(n => n.status == 2);
          var failedArr = failureToEmoBulkApproveArr.filter(n => n.status == 3);

          let successAndFailedCount = failedArr.length + successArr.length;

          if(failureToEmoBulkApproveArrCount == successAndFailedCount){
            $('#tblEmoBulkApproveSummary_action_status').show();
            $('#tblEmoBulkApproveSummary_action_total').text(successAndFailedCount);
            $('#tblEmoBulkApproveSummary_action_success').text(successArr.length);
            $('#tblEmoBulkApproveSummary_action_failed').text(failedArr.length);
              

            $('#allApproveCloseBtn').show();
            $('#paymentDate').val('');
          }

      },
      error: function (xhr, status, error) {
        console.log("Error:", error);
      }
    });
    $('#preloader').hide();
}

$('#allApproveCloseBtn').on('click',function(){
  tabClickValue(2);
});


// failureToEmoBulkApprove ------

function failureToEmoSelectApprove(){
    
    var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    let userID = userDataString['user_id'];
    var checkboxValues = [];
    var dataFilters = window.localStorage.getItem('filters');

    $('input[name="failed_check[]"]:checked').each(function () {
    checkboxValues.push($(this).val());
    });
    if (checkboxValues.length === 0) {
        Swal.fire({
          icon: "error",
          title: "Kindly select beneficiary!",
          showConfirmButton: false,
          timer: 2000
        });
    } else {
      $('#preloader').show();
        // console.log('Checkbox values are present.');
        $.ajax({
          url: APIURL+'select_emo_transfer', // Replace with your API endpoint
          method: 'POST',
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: {groupOfarray:checkboxValues,fileters:dataFilters,approveStatus:4,user_id:userID},
          dataType: 'json',
          success: function (response) {
            $('#preloader').hide();
            if(response.success == 1)
            {
              output = response.data;
              console.log(output);
              Swal.fire({
                icon: "success",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
              });
              setTimeout(() => {
                get_failed_paymment_list(dataFilters,4,null);
              }, 2000);
            }
            else if(response.success == 0)
            {
              $('#preloader').hide();
              Swal.fire({
                icon: "error",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
              })
              //$('#div_make_payment').addClass('d-none');
            }
          },
          error: function () {
            $('#preloader').hide();
            Swal.fire({
              icon: "error",
              title: "Service Error!",
              showConfirmButton: false,
              timer: 2000
            })
          }
        });
    }

}

// reinitiate bulk 
let bulkReInitiateApproveArr = [];
let bulkReInitiateApproveArrCount = 0;
  function bulkReInitiateApprove(){
      // checPaymentvalidate(paymentDate);
      $('#allApprovalReinitiate').prop('disabled',true);

      $('#allApprovalReinitiateCloseBtn').prop('disabled',false);
      $('#allApprovalReinitiate').hide();
      
    var input_schemCode = $('#ddl_scheme_code').val();
    var input_schemName = $('#ddl_scheme_name').val();
    var input_subScheme = $('#ddl_sub_scheme').val();
    var input_dep = $('#ddl_department').val();
    var input_subDep = $('#ddl_sub_department').val();
    var input_dateMonthYear = $('#dayWeekMonthFilter').val();
    let reason_code = $('#failur_reason_filter').val();

  if(input_schemCode !='' && input_schemName !='' && input_subScheme !='' && input_dep !='' && input_subDep !='' && input_dateMonthYear != ''){
          var paymentDate = $('#reinitiatePaymentDate').val();
            if(paymentDate == ''){
              $('#reinitiatePaymentDate_error').show();
              $('#reinitiatePaymentDate').addClass('text-danger');
              
              var scrollTarget = document.getElementById('reinitiatePaymentDateForm');
              if (scrollTarget) {
                  document.body.scrollTop = scrollTarget.offsetTop;
                  document.documentElement.scrollTop = scrollTarget.offsetTop;
              }
              return false;
          }else{
              $("#formFilters").submit();
             $('.reinitiateBlulkapproveSummary').modal({backdrop: 'static',keyboard: false}).modal('show');

              let selectedScheme = $('#lable_text_scheme_cate').text();
              let yearmonth = $('#lable_text_year_month').text();
              var dataFilters = window.localStorage.getItem('filters');
              var approveStatus = 1;
              $('#preloader').show();
              $('#tblReinitiateBulkApproveSummary').DataTable().clear().destroy();
              $('#tblReinitiateBulkApproveSummary').DataTable({
              "aLengthMenu": [10, 25, 50,100],
              "pageLength": -1,
              "footer": true,
              "dom": 'Bfrtip',
              "buttons": [
              {
                  extend: 'csv',
                  text: 'CSV',
                  filename: selectedScheme+'-bulk reinitiate summary-'+yearmonth,
                  exportOptions: {
                      rows: ':visible', // Export visible rows
                      modifier: {
                          selected: null // Export all rows, not just selected
                      }
                  }
              },
              {
                  extend: 'excel',
                  text: 'Excel',
                  filename: selectedScheme+'-Bulk reinitiate summary-'+yearmonth // Set custom filename for Excel
              },
              {
                  extend: 'pdf',
                  text: 'PDF',
                  filename: selectedScheme+'-bulk reinitiate summary-'+yearmonth // Set custom filename for PDF
              }],
              "searching": true,
              "processing": true,
              "serverSide": true,
              "ajax": {
              "url": APIURL + 'reinitiate_bulk_summary',
              "type": "POST",
              "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
              "dataType": "JSON",
              "data": function (data) {
                data.fileters = dataFilters;
                data.approveStatus = approveStatus;
                data.user_id = loginUser_id;
                data.reason_code = reason_code;
              },
              "beforeSend": function () {
                $('#tblReinitiateBulkApproveSummary_tfoot').hide();
                $('#preloader').show(); // Show the preloader before sending the request
                tblPreloaderEnable('tblReinitiateBulkApproveSummary');
              },
              "error": function (xhr, error, thrown) {
                  Swal.fire({
                      icon: "error",
                      title: 'Service Error !',
                      showConfirmButton: false,
                      timer: 2000
                  });
                  $('#preloader').hide();
              },

              "dataSrc": 'data',
              },
              "columns": [

              // { "data": "checkbox" },
              { "data": "S.No", render: function (data, type, row, meta) {
                  return meta.row + meta.settings._iDisplayStart + 1;
                  }
              },
              { "data": "scheme_name" },
              { "data": "distrinct_name" },
              { "data": "taluk_name" },
              { "data": "yyyymm"},
              { "data": "trackingID",
              "render": function (data, type, row) {
                return '<a href ="#" style="cursor:default !important;text:decoration:none !important;" id="bulk_'+data+'"><span class="badge bg-warning btn-sm cursor-auto"><i class="bi bi-check2-circle"></i> Yet to Reinitiate</span></a>';
              }},
              { "data": "apb_benificiaries_count" },
              { "data": "apb_benificiaries_amount"},
              { "data": "ach_benificiaries_count"},
              { "data": "ach_benificiaries_amount"},
              { "data": "total_count"},
              { "data": "total_value"},
              ],
              "aoColumnDefs": [{
              'bSortable': false,
              'aTargets': [0]
              }],
              "drawCallback": function (settings) {
              // Your drawCallback logic goes here
              // For example, updating dropdowns or other elements after the table is drawn
              },
              "initComplete": function (settings, json) {
                $('#preloader').hide(); // Hide the preloader after DataTable initialization
                  bulkReInitiateApproveArr = json.data;
                  $('#tblReinitiateBulkApproveSummary_action_status').hide();
                  if (bulkReInitiateApproveArr === undefined || bulkReInitiateApproveArr.length === undefined) {
                    bulkReInitiateApproveArr = [];
                  } else {
                    bulkReInitiateApproveArrCount = bulkReInitiateApproveArr.length;
                  }

                  if (!bulkReInitiateApproveArr || bulkReInitiateApproveArr.length === 0) {                
                    $('#allApprovalReinitiate').prop('disabled', true);
                    $('#allApprovalReinitiate').hide();
                  } else {
                    $('#allApprovalReinitiate').prop('disabled', false);
                    $('#allApprovalReinitiate').show();
                  }
              },
              "footerCallback": function (row, data, start, end, display) {
                  var api = this.api();

                  // console.log('data >>> ', data);

                  if(data.length !=0 && data.length != undefined){
                    let total_table_row =  `<tr>
                        <th id="footerColumn0"></th>
                        <th id="footerColumn1"></th>
                        <th id="footerColumn2">Total</th>
                        <th id="footerColumn3"></th>
                        <th id="footerColumn4"></th>
                        <th id="footerColumn5"></th>
                        <th id="footerColumn6"></th>
                        <th id="footerColumn7"></th>
                        <th id="footerColumn8"></th>
                        <th id="footerColumn9"></th>
                        <th id="footerColumn10"></th>
                        <th id="footerColumn11"></th>
                    </tr>`;
                    $('#tblReinitiateBulkApproveSummary_tfoot').html(total_table_row);
                    
                    $('#tblReinitiateBulkApproveSummary_tfoot').show();
                  }else{
                    $('#tblReinitiateBulkApproveSummary_tfoot').hide();
                  }

                  var columnsToSum = [6,7,8,9,10,11];

                  columnsToSum.forEach(function (columnIndex) {
                  var sum = api.column(columnIndex, { page: 'current' }).data()
                    .reduce(function (a, b) {
                        var val = parseFloat(b);
                        return isNaN(val) ? a : a + val;
                    }, 0);
                    $('#tblReinitiateBulkApproveSummary_tfoot #footerColumn'+columnIndex).text(sum);
                  // console.log("Sum for column " + columnIndex + ": " + sum);

                  $(api.column(columnIndex).footer()).html(sum);
                  });
              }
              }); 
          }
  }
  else{
      Swal.fire({
          icon: "error",
          title: "Select must scheme code, scheme name,Subscheme, department, sub department and payment period",
          showConfirmButton: true,
          timer: 2000
      });
    $("#formFilters").submit();
    $("html, body").animate({ scrollTop: 0 }, 3000);
  }
}


$('#tblReinitiateBulkApproveSummary_action_status').hide();

function allApprovalReinitiate(){

// console.log('bukl Approve Summary', bulkReInitiateApproveArr);
  
  $('#allApprovalReinitiate').prop('disabled',true);
  // $('#allApprovalReinitiateCloseBtn').prop('disabled',true);

  $('#allApprovalReinitiate').hide();
  $('#allApprovalReinitiateCloseBtn').hide();

  bulkReInitiateApproveArr.forEach(items => {
    if(items.status == 0){
      $('#bulk_'+items.trackingID).html(`<span class="badge bg-warning btn-sm cursor-auto"><i class="bi bi-check2-circle"></i> Yet to Reinitiate</span>`);
    }
  });

  if (bulkReInitiateApproveArr.length > 0) {
      const batchSize = 5;
      var  trackingIDArr = bulkReInitiateApproveArr.filter(n => n.status == 0);
      var runningprocess = bulkReInitiateApproveArr.filter(n => n.status == 1);

      var loopcounter = batchSize;
      loopcounter = loopcounter - runningprocess.length;
      
      if (loopcounter > 0)
      {
        if (loopcounter > trackingIDArr.length)
        {
           loopcounter = trackingIDArr.length;
        }
        bulkReinitiateApproveProcessBatch(0,loopcounter,trackingIDArr);
      }
  } else {
      Swal.fire({
          icon: "error",
          title: 'Summary is Empty !',
          showConfirmButton: false,
          timer: 2000
      });
  }

}



function bulkReinitiateApproveProcessBatch(startIndex, loopcounter, trackingIDArr){

  let reason_code = $('#select_reason_code').val();
  console.log('reason_code >>> ', reason_code );

  var paymentDate = $('#reinitiatePaymentDate').val();
  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  let userID = userDataString['user_id'];
  var dataFilters = window.localStorage.getItem('filters');

  let transferToPaymentUniqId = [];

    for (let i = startIndex; i < loopcounter; i++) {

      // console.log(trackingIDArr[i]);

      $.each( bulkReInitiateApproveArr, function( j, obj ) {
            if(obj.trackingID == trackingIDArr[i].trackingID){           
              obj.status = 1;
            }
          });

          // $('.reinitiateBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+trackingIDArr[i].trackingID).offset().top);
          $('#bulk_'+trackingIDArr[i].trackingID).focus();
      $.ajax({
        url: APIURL+'reinitiateAllApprove',
        method: 'POST',
        headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: { fileters: dataFilters,summaryDistrictCode:trackingIDArr[i].district_code,summaryTalukCode:trackingIDArr[i].taluk_code, approveStatus: 1,user_id:userID,trackingId:trackingIDArr[i].trackingID,paymentDate:paymentDate,reason_code:reason_code},
        dataType: 'json',
        success: function (response) {
          // $('#reinitiatePaymentDate').val('');
          if(response.success == 0){
            let ouput = response.data;
            
            $('#bulk_' + ouput.trackingid).html('<span class="badge bg-danger btn-sm">Failed !</span>');
            $.each(bulkReInitiateApproveArr, function( j, obj ) {
                if(obj.trackingID == ouput.trackingid){         
                  obj.status = 3;
                }
            });
            // $('.reinitiateBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+ouput.trackingid).offset().top);
          }
        },
        error: function (xhr, status, error) {
          $('#bulk_' + trackingIDArr[i].trackingID).html('<span class="badge bg-danger btn-sm">Failed !</span>');
            $.each(bulkReInitiateApproveArr, function( j, obj ) {
                if(obj.trackingID == trackingIDArr[i].trackingID){         
                  obj.status = 3;
                }
            });
            // $('.reinitiateBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+trackingIDArr[i].trackingID).offset().top);
          console.log("Error:", error);
        }
        });
          bulkReinitiateApproveUpdatestatus(trackingIDArr[i].trackingID);
      $('#preloader').hide();
    }
}

function bulkReinitiateApproveUpdatestatus(trakingId){
  $('#preloader').hide();
  $.ajax({
      url: APIURL + 'bulkApprovalStatus',
      method: 'POST',
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: { trackingId: trakingId },
      dataType: 'json',
      success: function (response) {
        $('#preloader').hide();
        let output = response.data[0];
        if (output.status == 2) {
          $('#bulk_'+trakingId).html('<span class="badge bg-success btn-sm"><i class="bi bi-check2-circle"></i>' + output.updated_count + ' Reinitiated </span>');
          $.each( bulkReInitiateApproveArr, function( j, obj ) {
            if(obj.trackingID == trakingId){         
              obj.status = 2;
            }
          });
          // $('.reinitiateBlulkapproveSummary .modal-body').scrollTop($('#bulk_'+trakingId).offset().top);
          allApprovalReinitiate();
        } else {
          var failedTrackid = bulkReInitiateApproveArr.filter(n => n.status == 3);

          if (failedTrackid.every(failedObj => failedObj.trackingID !== trakingId)) {
              $('#bulk_'+trakingId).html('<span class="badge bg-info btn-sm">' + output.updated_count + ' In-progress</span>');
              setTimeout(() => { bulkReinitiateApproveUpdatestatus(trakingId);}, 3000);
          }else{
            allApprovalReinitiate();
          }
        }

        var successArr = bulkReInitiateApproveArr.filter(n => n.status == 2);
        var failedArr = bulkReInitiateApproveArr.filter(n => n.status == 3);

        let successAndFailedCount = successArr.length + failedArr.length;

        if(bulkReInitiateApproveArrCount == successAndFailedCount){
            $('#tblReinitiateBulkApproveSummary_action_status').show();
            $('#tblReinitiateBulkApproveSummary_action_total').text(successAndFailedCount);
            $('#tblReinitiateBulkApproveSummary_action_success').text(successArr.length);
            $('#tblReinitiateBulkApproveSummary_action_failed').text(failedArr.length);

            $('#allApprovalReinitiateCloseBtn').show();
            $('#paymentDate').val('');
        }
      },
      error: function (xhr, status, error) {
        console.log("Error:", error);
      }
    });
    $('#preloader').hide();
}


$('#allApprovalReinitiateCloseBtn').on('click',function(){
  tabClickValue(2);
});


  $('#generate_payment_status').hide();
  $('#generate_payment_disable_btn').hide();

let start = 0;
function triggerScript(scriptName) {
  start=1;
  var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    window.loginUser_id = userDataString['user_id'];

  window.localStorage.setItem('generate_payment_enable', true);
  var input_schemCode = $('#ddl_scheme_code').val();
  var input_schemName = $('#ddl_scheme_name').val();
  var input_subScheme = $('#ddl_sub_scheme').val();
  var input_dep = $('#ddl_department').val();
  var input_subDep = $('#ddl_sub_department').val();
  var input_dateMonthYear = $('#dayWeekMonthFilter').val();
  
  if(input_schemCode !='' && input_schemName !='' && input_subScheme !='' && input_dep !='' && input_subDep !='' && input_dateMonthYear != ''){
    $("#formFilters").submit();
    var dataFilters = window.localStorage.getItem('filters');
    // console.log('trigger script Name ', generate_payment_file_cnrt);
    // console.log(typeof generate_payment_file_cnrt);
    $('#preloader').show();
      /**/
      $('#generate_payment_real_btn').hide();
      $('#generate_payment_status').addClass('d-inline');
      $('#generate_payment_status').show();
      $('#generate_payment_disable_btn').show();
      /**/ 
  $.ajax({
    url: APIURL + 'execute_script', // Replace with your API endpoint
    method: 'GET', // Change the method to GET
    headers: {
        'X-APP-KEY': config.app_key,
        'X-APP-NAME': config.app_name
    },
    data: {
      script: scriptName,
      fileters:dataFilters,
      user_id:loginUser_id
    },
    dataType: 'json',
    success: function (response) {
      start = 2;
      $('#preloader').hide();
      $('#generate_payment_status').removeClass('d-inline');
      $('#generate_payment_status').hide();
      $('#generate_payment_disable_btn').hide();
      $('#generate_payment_real_btn').show();
      window.localStorage.setItem('generate_payment_enable', false);
        if (response.success == 1) {
            output = response.data;
            console.log(output);
            Swal.fire({
                icon: "success",
                title: "Generated Payment File Completed Successfully",//response.message,
                showConfirmButton: false,
                timer: 2000
            });

            $('#generate_file_status_cards').html('');
            
            setTimeout(() => {
              get_generate_payment_file_pre_list(dataFilters,5);
            }, 2000);
        } else if (response.success == 0) {
            Swal.fire({
                icon: "error",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
            })
        }
    },
    error: function () {
      start = 2;
      window.localStorage.setItem('generate_payment_enable', false);
      $('#generate_payment_status').removeClass('d-inline');
      $('#generate_payment_status').hide();
      $('#generate_payment_disable_btn').hide();
      $('#generate_payment_real_btn').show();
      $('#preloader').hide();
        Swal.fire({
            icon: "error",
            title: "Service Error!",
            showConfirmButton: false,
            timer: 2000
        })
        get_generate_payment_file_pre_list(dataFilters,5);
    }
  });

  generateFileStatus();


  }else{
      Swal.fire({
          icon: "error",
          title: "select best scheme code, scheme name,Subscheme, department, sub department and payment period",
          showConfirmButton: true,
          timer: 2000
      });
    $("#formFilters").submit();
  }

}



// file created status get

function generateFileStatus(){
    var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    window.loginUser_id = userDataString['user_id'];

    var dataFilters = window.localStorage.getItem('filters');

  $.ajax({
    url: APIURL + 'file_gentrated_status', // Replace with your API endpoint
    method: 'POST', // Change the method to GET
    headers: {
        'X-APP-KEY': config.app_key,
        'X-APP-NAME': config.app_name
    },
    data: {
      fileters:dataFilters,
      user_id:loginUser_id
    },
    dataType: 'json',
    success: function (response) {
        if (response.success == 1) {
            output = response.data;
            let column = ``;
            $('#generate_file_status_cards').html('');
            
            if(start != 2){
                output.forEach(files => {
                let sumValues = files.pending+files.completed;
                  
                    column += `<div class="d-flex">
                                  <div class="col mx-2 text-center mb-2 align-items-stretch">
                                  <div class="card col-4 info-card customers-card-lavander h-100">
                                    <div class="card-body pt-3">
                                      <h3 id="card_total_invalid_count" class="fw-bold">${files.payment_date}</h3>
                                      <span class="badge bg-primary">Payment date</span>
                                    </div>
                                    <div class="row mb-3">
                                      <div class="col-md" style="border-right: 2px solid #0d6efd !important;">
                                        <h3 id="card_aadhar_invalid_count" class="fw-bold">${files.total}</h3>
                                        <span class="badge bg-blue">Total</span>
                                      </div>
                                      <div class="col-md" style="border-right: 2px solid #0d6efd !important;">
                                        <h3 id="card_ac_invalid_count" class="fw-bold">${files.pending}</h3>
                                        <span class="badge card-green-orange">Pending</span>
                                      </div>
                                      <div class="col-md" style="border-right: 2px solid #0d6efd !important;">
                                        <h3 id="card_obsolete_invalid_count" class="fw-bold">${files.completed}</h3>
                                        <span class="badge bg-success" >Processed</span>
                                      </div>
                                      <div class="col-md">
                                        <h3 id="card_obsolete_invalid_count" class="fw-bold">${files.files_count}</h3>
                                        <span class="badge bg-info" >Files Created</span>
                                      </div>
                                    </div>
                                  </div>
                                  </div>
                                </div>`;
                  
               
                });

                $('#generate_file_status_cards').html(column);

                // debugger;
                generateFileStatus();
            }
            

            
        } else if (response.success == 0) {
          $('#generate_file_status_cards').html('');
        }
    },
    error: function () {
      
    }
    
  });
}


$('#transfer_payment_status').hide();
$('#transfer_payment_disable_btn').hide();

let transferStrat = 0;
function triggerScript2(scriptName) {
  transferStrat = 1;
  var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    window.loginUser_id = userDataString['user_id'];

  window.localStorage.setItem('transfer_payment_enable', true);
  var dataFilters = window.localStorage.getItem('filters');
  $('#transfer_payment_status').addClass('d-inline');
  $('#transfer_payment_status').show();
  $('#transfer_payment_disable_btn').show();
  $('#transfer_payment_enable').hide();

  var dataFilters = window.localStorage.getItem('filters');
  // $('#preloader').show();
  $.ajax({
    url: APIURL + 'execute_script', // Replace with your API endpoint
    method: 'GET', // Change the method to GET
    headers: {
        'X-APP-KEY': config.app_key,
        'X-APP-NAME': config.app_name
    },
    data: {
      script: scriptName,
      fileters:dataFilters,
      user_id:loginUser_id
    },
    dataType: 'json',
    success: function (response) {
      transferStrat = 2;
      $('#transfer_payment_status').removeClass('d-inline');
      $('#transfer_payment_status').hide();
      $('#transfer_payment_disable_btn').hide();
      $('#transfer_payment_enable').show();
      // $('#preloader').hide();
      $('#tranfer_to_bank_file_status_cards').html('');
      window.localStorage.setItem('transfer_payment_enable', false);
        if (response.success == 1) {
            output = response.data;
            // console.log(output);
            Swal.fire({
                icon: "success",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
            });
            setTimeout(() => {
              get_transfer_payment_to_bank_pre_list(dataFilters,6);
            }, 2000);
            
        } else if (response.success == 0) {
            Swal.fire({
                icon: "error",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
            })
        }
    },
    error: function () {
      transferStrat = 2;
      // $('#preloader').hide();
      window.localStorage.setItem('transfer_payment_enable', false);
      $('#transfer_payment_status').removeClass('d-inline');
      $('#transfer_payment_status').hide();
      $('#transfer_payment_disable_btn').hide();
      $('#transfer_payment_enable').show();
        Swal.fire({
            icon: "error",
            title: "Service Error!",
            showConfirmButton: false,
            timer: 2000
        })
        get_transfer_payment_to_bank_pre_list(dataFilters,6);
    }
  });

  transferredToBankFileStatus();
}



function transferredToBankFileStatus(){
    var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    window.loginUser_id = userDataString['user_id'];

    var dataFilters = window.localStorage.getItem('filters');

  $.ajax({
    url: APIURL + 'file_tranferred_to_bank_status', // Replace with your API endpoint
    method: 'POST', // Change the method to GET
    headers: {
        'X-APP-KEY': config.app_key,
        'X-APP-NAME': config.app_name
    },
    data: {
      fileters:dataFilters,
      user_id:loginUser_id
    },
    dataType: 'json',
    success: function (response) {
        if (response.success == 1) {
            output = response.data;
            let column = ``;
            $('#tranfer_to_bank_file_status_cards').html(column);
            if(transferStrat !=2){
              output.forEach(files => {
                let sumValues = files.pending+files.transferred;
                
                  column +=  `<div class="d-flex">
                    <div class="col mx-2 text-center mb-2 align-items-stretch">
                    <div class="card col-4 info-card customers-card-lavander h-100">
                    <div class="card-body pt-3">
                    <h3 id="card_total_invalid_count" class="fw-bold">${files.payment_date}</h3>
                    <span class="badge bg-primary">Payment date</span>
                    </div>
                    <div class="row mb-3">
                    <div class="col-md" style="border-right: 2px solid #0d6efd !important;">
                    <h3 id="card_aadhar_invalid_count" class="fw-bold">${files.total}</h3>
                    <span class="badge bg-blue">Total</span>
                    </div>
                    <div class="col-md" style="border-right: 2px solid #0d6efd !important;">
                    <h3 id="card_ac_invalid_count" class="fw-bold">${files.pending}</h3>
                    <span class="badge card-green-orange">Pending</span>
                    </div>
                    <div class="col-md">
                    <h3 id="card_obsolete_invalid_count" class="fw-bold">${files.transferred}</h3>
                    <span class="badge bg-success" >Transferred</span>
                    </div>
                    </div>
                    </div>
                    </div>
                  </div>`;
              });
              
              $('#tranfer_to_bank_file_status_cards').html(column);
  
              transferredToBankFileStatus();
            }
        } else if (response.success == 0) {
          $('#tranfer_to_bank_file_status_cards').html('');
        }
    },
    error: function () {
      
    }
    
  });
}

function viewScheme(listID){
    // $('#popup_head').text('')
    $('#popup_scheme').text('')
    $('#popup_year').text('')
    $('#popup_month').text('')
    $('#popup_beneficiary_name').text('')
    $('#popup_beneficiary_mobile').text('')
    $('#popup_account_type').text('')
    $('#popup_installment').text('')
    $('#popup_amount').text('')
    $('#popup_transcation').text('');
    $('#check_activity').text('');
  $('#preloader').show();
  $.ajax({
    url: APIURL + 'viewpopupData', // Replace with your API endpoint
    method: 'POST', // Change the method to GET
    headers: {
        'X-APP-KEY': config.app_key,
        'X-APP-NAME': config.app_name
    },
    data: {
      list_id: listID
    },
    dataType: 'json',
    success: function (response) {
      $('#preloader').hide();
        if (response.success == 1) {
            output = response.data[0];
            timeLine = response.data.timeline;
            // $('#popup_head').text(output.beneficiary_name);
            $('#popup_scheme').text(output.scheme_name);
            $('#popup_year').text(output.year_part);
            $('#popup_month').text(output.Month);
            $('#popup_beneficiary_name').text(output.beneficiary_name);
            $('#popup_beneficiary_mobile').text(output.beneficiary_mobile_no);
            $('#popup_account_type').text(output.payment_mode);
            $('#popup_installment').text(output.installment_id);
            $('#popup_amount').text(output.amount);
            $('#popup_transcation').text(output.created_ts);

            // console.log();
              var activeColStart = `<div class="col-lg-12">`;
              var activeColEnd = `</div>`;
              
              var activeTitleOne = `<h5 class="card-title mb-2 px-2"><i class="bi bi-check2-circle"></i> Activity</h5>`;
              var activeTitletwo = `<h5 class="card-title mb-2 px-2"><i class="bi bi-check2-circle"></i> Re-Initiate Activity</h5>`;
              let timelineValue = '';
              // console.log('time line ', timeLine);
              timeLine.forEach((action, key) => {
                timelineValue += `<div class="activity-item d-flex">
                <div class="activite-label">${key + 1}</div>
                <i class="bi bi-circle-fill activity-badge  align-self-start" style="color:#9090bf"></i>
                <div class="activity-content">
                 ${action.action_desc}
                </div>
                </div>`;
              });

              // Transcation by <span class="text-danger">${action.action_by}</span>, <small>${action.action_ts}</small>

              
              var transcation = `${activeColStart}<div class="activity">${activeTitleOne}`+`${timelineValue}</div>${activeColEnd}`;
              

              $('#check_activity').html(transcation);

        } else if (response.success == 0) {
            Swal.fire({
                icon: "error",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
            })
        }
    },
    error: function () {
      $('#preloader').hide();
      Swal.fire({
          icon: "error",
          title: "Service Error!",
          showConfirmButton: false,
          timer: 2000
      })
    }
  });
}

function generateUniqueId() {
  const timestamp = new Date().getTime();
  // const random = Math.floor(Math.random() * 1000); // Adjust the range as needed
  return `${timestamp}`;//${random}
}


function tblPreloaderEnable(tableName){
      var processingDiv = document.getElementById(tableName+'_processing');
      var displayStatus = window.getComputedStyle(processingDiv).display;
      if (displayStatus === 'block') {
      $('#'+tableName+'_processing').html(`<div id="preloader"></div>`);
      } else {
        $('#'+tableName+'_processing').text(`<div id="preloader"></div>`);
      }
}



var generate_payment_enable = window.localStorage.getItem('generate_payment_enable');
var transfer_payment_enable = window.localStorage.getItem('transfer_payment_enable');

if(generate_payment_enable === 'true'){
  // triggerScript('generate_payment_file_cnrt');
  $('#generate_payment_real_btn').hide();
  $('#generate_payment_status').addClass('d-inline');
  $('#generate_payment_status').show();
  $('#generate_payment_disable_btn').show();
}

if(transfer_payment_enable === 'true'){
  // triggerScript2('transfer_payment_file')
    $('#transfer_payment_status').addClass('d-inline');
    $('#transfer_payment_status').show();
    $('#transfer_payment_disable_btn').show();
    $('#transfer_payment_enable').hide();
}



// upload beneficiary list move to panding processer
function viewSummary(){
  let selectedScheme = $('#lable_text_scheme_cate').text();
let yearmonth = $('#lable_text_year_month').text();

  $('#transFerToValidBtn').hide();
      window.localStorage.setItem('deDuplicatePopup',2);

      $('.deduplicationValidateSummary').modal({backdrop: 'static',keyboard: false}).modal('show');
      var dataFilters = window.localStorage.getItem('filters');
      var approveStatus = 1;

      $('#preloader').show();
      $('#deduplicationValidateSummary').DataTable().clear().destroy();
      $('#deduplicationValidateSummary').DataTable({
      "aLengthMenu": [10, 25, 50,100],
      "pageLength": -1,
      "footer": true,
      "dom": 'Bfrtip',
      "buttons": [
      {
          extend: 'csv',
          text: 'CSV',
          filename: selectedScheme+'-Validation-summary-'+yearmonth,
          exportOptions: {
              rows: ':visible', // Export visible rows
              modifier: {
                  selected: null // Export all rows, not just selected
              }
          }
      },
      {
          extend: 'excel',
          text: 'Excel',
          filename: selectedScheme+'-Validation-summary-'+yearmonth // Set custom filename for Excel
      },
      {
          extend: 'pdf',
          text: 'PDF',
          filename: selectedScheme+'-Validation-summary-'+yearmonth // Set custom filename for PDF
      }],
      "searching": true,
      "processing": true,
      "serverSide": true,
      "ajax": {
      "url": APIURL + 'fn_payment_validatebenificiaries',
      "type": "POST",
      "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      "dataType": "JSON",
      "data": function (data) {
      data.fileters = dataFilters;
      data.approveStatus = approveStatus;
      data.user_id = loginUser_id;
      },
      "beforeSend": function () {
        $('#deduplicationValidateSummary_tfoot').hide();
      $('#preloader').show(); // Show the preloader before sending the request
      tblPreloaderEnable('deduplicationValidateSummary');
      },
      "error": function (xhr, error, thrown) {
          Swal.fire({
              icon: "error",
              title: 'Service Error !',
              showConfirmButton: false,
              timer: 2000
          });
          $('#preloader').hide();
      },

      "dataSrc": 'data',
      },
      "columns": [

      // { "data": "checkbox" },
      { "data": "S.No", render: function (data, type, row, meta) {
          return meta.row + meta.settings._iDisplayStart + 1;
          }
      },
      { "data": "scheme_name" },
      { "data": "subscheme_name" },
      { "data": "district_name" },
      { "data": "taluk_name"},
      { "data": "yyyymm" },
      { "data": "total_count"},
      { "data": function (data, type, row, meta) {
          return data.total_count - data.error_count;
          }
      },
      { "data": "error_count"},
      { "data": "duplicatebenificiary"},
      { "data": "duplicateaadhaar"},
      { "data": "duplicateaccount"},
      { "data": "invalidbeneficiaryname"},
      { "data": "invalidiinorifsc"},
      { "data": "invalidaadhaar"},
      { "data": "invalidaccount"},
      { "data": "obsolete_beneficiary"},
      
      { "data": function (data, type, row, meta) {
          return '<a onclick="downloadFileDuplicates(' + data.distirict_code + ',' + data.taluk_code + ',\'' + data.district_name + '\',\'' + data.taluk_name + '\')" ><span class="btn btn-primary btn-sm"><i class="bi bi-download"></i> Download</span></span>';
          }
      },
      ],
      "aoColumnDefs": [{
      'bSortable': false,
      'aTargets': [0]
      }],
      "drawCallback": function (settings) {
      // Your drawCallback logic goes here
      // For example, updating dropdowns or other elements after the table is drawn
      },
      "initComplete": function (settings, json) {
      $('#preloader').hide();
      $('#transFerToValidBtn').show();
      buklApproveSummary = json.data;
      
        let checkvalidCount = false;
        if(buklApproveSummary != null){
          for (let i = 0; i < buklApproveSummary.length; i++) {
            let rowValid = buklApproveSummary[i];
            let validaCount = rowValid.total_count - rowValid.error_count;
              if (validaCount > 0) {
                checkvalidCount = true;
                break;
              }
          }
        }
      
        let noRecordInfo = `<span class="badge badge-danger custom-btn"><i class="bi bi-info-circle"></i> No valid records to transfer</span>`;
        
      if(checkvalidCount!=false){
        if(buklApproveSummary==null){
          TransferPermissionBtnDisable();
          $('.deduplicationValidateSummary').modal('hide');
          $('#transFerToValidBtn').show();
        }
        $('#valid_records_not_found_info').html('');
      }else{
        $('#transFerToValidBtn').hide();
        $('#valid_records_not_found_info').html(noRecordInfo);        
      }

      },
      "footerCallback": function (row, data, start, end, display) {
          var api = this.api();
          if(data.length !=0 && data.length != undefined){

              let total_table_row =  `<tr>
                <th id="footerColumn0"></th>
                <th id="footerColumn1"></th>
                <th id="footerColumn2"></th>
                <th id="footerColumn3"></th>
                <th id="footerColumn4"></th>
                <th id="footerColumn5">Total</th>
                <th id="footerColumn6"></th>
                <th id="footerColumn7"></th>
                <th id="footerColumn8"></th>
                <th id="footerColumn9"></th>
                <th id="footerColumn10"></th>
                <th id="footerColumn11"></th>
                <th id="footerColumn12"></th>
                <th id="footerColumn13"></th>
                <th id="footerColumn14"></th>
                <th id="footerColumn15"></th>
                <th id="footerColumn16"></th>
              </tr>`;

            $('#deduplicationValidateSummary_tfoot').html(total_table_row);

            $('#deduplicationValidateSummary_tfoot').show();
          }else{
           $('#deduplicationValidateSummary_tfoot').hide();
          }

          var columnsToSum = [6,7,8,9,10,11,12,13,14,15,16];

          columnsToSum.forEach(function (columnIndex) {
            
              var sum = api.column(columnIndex, { page: 'current' }).data()
                  .reduce(function (a, b) {
                      var val = parseFloat(b);
                      return isNaN(val) ? a : a + val;
                  }, 0);
                  $('#deduplicationValidateSummary_tfoot #footerColumn'+columnIndex).text(sum);           
              $(api.column(columnIndex).footer()).html(sum);
          });
      }
      });
}


var bulkTransferPaymentProcessSummary = [];
var bulkTransferPaymentProcessSummaryCount = 0;


let transferPaymentProcessApproveStatus = window.localStorage.getItem('transferPaymentProcess');

if(transferPaymentProcessApproveStatus === null){
  window.localStorage.setItem('transferPaymentProcess', 'false');
}

function showTranferPaymentProcess(){
  let selectedScheme = $('#lable_text_scheme_cate').text();
  let yearmonth = $('#lable_text_year_month').text();

  $('#transferBtn').prop('disabled',false);
  let transferPaymentProcess = window.localStorage.getItem('transferPaymentProcess');
  $('#deduplicationValidateFunctionsListClose').click();
  $('validateSummaryClose').click();

  if(transferPaymentProcess == 'true'){
    $('.transferPaymentProcess').modal({backdrop: 'static',keyboard: false}).modal('show');
  }else{
    var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    window.loginUser_id = userDataString['user_id'];

    $('.transferPaymentProcess').modal({backdrop: 'static',keyboard: false}).modal('show');
        var dataFilters = window.localStorage.getItem('filters');
        var approveStatus = 1;
        $('#preloader').show();
        
        $('#transferPaymentProcess').DataTable().clear().destroy();
        $('#transferPaymentProcess').DataTable({
        "aLengthMenu": [10, 25, 50,100],
        "pageLength": -1,
        "footer": true,
        "dom": 'Bfrtip',
        "buttons": [
        {
            extend: 'csv',
            text: 'CSV',
            filename: selectedScheme+'-Transfer-summary-'+yearmonth,
            exportOptions: {
                rows: ':visible', // Export visible rows
                modifier: {
                    selected: null // Export all rows, not just selected
                }
            }
        },
        {
            extend: 'excel',
            text: 'Excel',
            filename: selectedScheme+'-Transfer-summary-'+yearmonth // Set custom filename for Excel
        },
        {
            extend: 'pdf',
            text: 'PDF',
            filename: selectedScheme+'-Transfer-summary-'+yearmonth // Set custom filename for PDF
        }],
        "searching": false,
        "processing": true,
        "serverSide": true,
        "ajax": {
        "url": APIURL + 'transferPaymentSummaryList',
        "type": "POST",
        "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        "dataType": "JSON",
        "data": function (data) {
        data.fileters = dataFilters;
        data.approveStatus = approveStatus;
        data.user_id = loginUser_id;
        },
        "beforeSend": function () {
          $('#transferPaymentProcess_tfoot').hide();
        $('#preloader').show(); // Show the preloader before sending the request
        tblPreloaderEnable('transferPaymentProcess');
        },
        "error": function (xhr, error, thrown) {
            Swal.fire({
                icon: "error",
                title: 'Service Error !',
                showConfirmButton: false,
                timer: 2000
            });
            $('#preloader').hide();
        },

        "dataSrc": 'data',
        },
        "columns": [

        // { "data": "checkbox" },
        { "data": "S.No", render: function (data, type, row, meta) {
            return meta.row + meta.settings._iDisplayStart + 1;
            }
        },
        // { "data": "scheme_name" },
        { "data": "district_name" },
        { "data": "taluk_name" },
        // { "data": "trackingID"},
        {
        "data": "trackingID",
        "render": function (data, type, row) {
            // Customize the content here
            return '<a href ="#" style="cursor:default !important;text:decoration:none !important;" id="'+data+'"><span class="badge bg-warning btn-sm cursor-auto"><i class="bi bi-check2-circle"></i> Yet to Transfer</span></a>';
        }
        },
        { "data": "apb_count" },
        { "data": "apb_amount"},
        { "data": "ach_count"},
        { "data": "ach_amount"},
        { "data": "total_count"},
        { "data": "total_amount"},
        // Add more columns as needed
        // Example: { "data": "complaint_raised_by" },
        ],
        "aoColumnDefs": [{
        'bSortable': false,
        'aTargets': [0]
        }],
        "drawCallback": function (settings) {
        // Your drawCallback logic goes here
        // For example, updating dropdowns or other elements after the table is drawn
        },
        "initComplete": function (settings, json) {
        $('#preloader').hide(); // Hide the preloader after DataTable initialization
        var districtTalukArr = [];
      
         $('#transferBtn').hide();
         $('#transferPaymentProcess_action_status').hide();
          if (json.data && json.data.length > 0) {
          $('#transferBtn').show();
          json.data.forEach(summary => {
            districtTalukArr.push({
                "district": summary.distirict_code,
                "taluk": summary.taluk_code,
                "trackingID": summary.trackingID,
                "status": 0
            });

          });

          bulkTransferPaymentProcessSummary = districtTalukArr;
          bulkTransferPaymentProcessSummaryCount = districtTalukArr.length;
            // witchModalisActiveCheck();
          }
          $('#TransferPaymentProcessCloseBtn').hide();

        },
          "footerCallback": function (row, data, start, end, display) {
            var api = this.api();

            // console.log('data >>> ', data);

            if(data.length !=0 && data.length != undefined){
              

              let total_table_row =  `<tr>
              <th id="footerColumn0"></th>
              <th id="footerColumn1"></th>
              <th id="footerColumn2"></th>
              <th id="footerColumn3">Total</th>
              <th id="footerColumn4"></th>
              <th id="footerColumn5"></th>
              <th id="footerColumn6"></th>
              <th id="footerColumn7"></th>
              <th id="footerColumn8"></th>
              <th id="footerColumn9"></th>
              </tr>`;
            $('#transferPaymentProcess_tfoot').html(total_table_row);

            $('#transferPaymentProcess_tfoot').show();
            }else{
              $('#transferPaymentProcess_tfoot').hide();
            }

            var columnsToSum = [4, 5, 6, 7, 8, 9];

            columnsToSum.forEach(function (columnIndex) {
                var sum = api.column(columnIndex, { page: 'current' }).data()
                    .reduce(function (a, b) {
                        var val = parseFloat(b);
                        return isNaN(val) ? a : a + val;
                    }, 0);
                    
                    $('#transferPaymentProcess_tfoot #footerColumn'+columnIndex).text(sum);

                $(api.column(columnIndex).footer()).html(sum);
            });
        }
        });
  }
   
}

function downloadFileDuplicates(district_code,taluk_code,district_name,taluk_name){
  let yearmonth = $('#lable_text_year_month').text();
  let filename = `${district_name}-${taluk_name}-Validation Summary-${yearmonth}`;
  var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString);
    window.loginUser_id = userDataString['user_id'];
  $('#preloader').show();
  var dataFilters = window.localStorage.getItem('filters');
  $.ajax({
      url: APIURL + 'transferToPaymentProcessDownload',
      method: 'POST',
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: {fileters:dataFilters,district_code:district_code,taluk_code:taluk_code,user_id:loginUser_id},
      dataType: 'json',
      success: function (response) {
        if(response.data!=null){
          exportJsonToExcel(response.data,filename);
        }else{
          Swal.fire({
          icon: "error",
          title: 'Summary is Empty !',
          showConfirmButton: false,
          timer: 2000
          });
        }
      },
      error: function (xhr, status, error) {
        console.log("Error:", error);
      }
    });
}

$('#transferPaymentProcess_action_status').hide();

function TransferPaymentProcessInziated(){

  bulkTransferPaymentProcessSummary.forEach(items => {
    if(items.status == 0){
      $('#'+items.trackingID).html(`<span class="badge bg-warning btn-sm cursor-auto"><i class="bi bi-check2-circle"></i> Yet to Transfer</span>`);
    }
  });

  if (bulkTransferPaymentProcessSummary.length > 0) {
      $('#transferBtn').prop('disabled',true);
      $('#transferBtn').hide();
      const batchSize = 5;
      var  trackingIDArr = bulkTransferPaymentProcessSummary.filter(n => n.status == 0);
      var runningprocess = bulkTransferPaymentProcessSummary.filter(n => n.status == 1);

      var loopcounter = batchSize;
      loopcounter = loopcounter - runningprocess.length;
      
      if (loopcounter > 0)
      {
        if (loopcounter > trackingIDArr.length)
        {
           loopcounter = trackingIDArr.length;
        }
        processBatch(0,loopcounter,trackingIDArr);
      }
  } else {
      Swal.fire({
          icon: "error",
          title: 'Summary is Empty ...!',
          showConfirmButton: false,
          timer: 2000
      });
  }
}

let failedTrackingIDs = [];

function processBatch(startIndex, loopcounter, trackingIDArr) {
  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  window.loginUser_id = userDataString['user_id'];

  var dataFilters = window.localStorage.getItem('filters');

  let transferToPaymentUniqId = [];
    // const endIndex = Math.min(startIndex + loopcounter, bulkTransferPaymentProcessSummary.length);
    for (let i = startIndex; i < loopcounter; i++) {

      // console.log(trackingIDArr[i]);
      // transferToPaymentUniqId.push(trackingIDArr[i].trackingID);
      $.each( bulkTransferPaymentProcessSummary, function( j, obj ) {
            if(obj.trackingID == trackingIDArr[i].trackingID){              
              obj.status = 1;
            }
          });

          $('#'+trackingIDArr[i].trackingID).focus();
          console.log(trackingIDArr[i].trackingID);
          // alert(trackingIDArr[i].trackingID);

          // console.log('transferPaymentProcessbulkapproveNew', trackingIDArr[i]);
          // $('.transferPaymentProcess .modal-body').scrollTop($('#'+trackingIDArr[i].trackingID).offset().top)
          // $('#'+trackingIDArr[i].trackingID).focus();
      $.ajax({
        url: APIURL+'transferPaymentProcessbulkapproveNew',
        method: 'POST',
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: {district:trackingIDArr[i].district, taluk:trackingIDArr[i].taluk, trackingID:trackingIDArr[i].trackingID, user_id:loginUser_id,fileters:dataFilters},
        dataType: 'json',
        success: function (response) {
          if(response.success == 0){
            let ouput = response.data;
            $('#' + ouput.trackingid).html('<span class="badge bg-danger btn-sm">Failed !</span>');
            $.each(bulkTransferPaymentProcessSummary, function( j, obj ) {
                if(obj.trackingID == ouput.trackingid){         
                  obj.status = 3;
                }
            });
            // $('.transferPaymentProcess .modal-body').scrollTop($('#'+trackingIDArr[i].trackingID).offset().top)
          }
        },
        error: function (xhr, status, error) {
          $('#' + trackingIDArr[i].trackingID).html('<span class="badge bg-danger btn-sm">Failed !</span>');
            $.each(bulkTransferPaymentProcessSummary, function( j, obj ) {
                if(obj.trackingID == trackingIDArr[i].trackingID){
                  obj.status = 3;
                }
            });
            // $('.transferPaymentProcess .modal-body').scrollTop($('#'+trackingIDArr[i].trackingID).offset().top)
            console.log("Error:", error);
        }
        });

          updatestatus(trackingIDArr[i].trackingID);
      $('#preloader').hide();
    }
}



function updatestatus(trakingId)
{
  
  $('#preloader').hide();
  $.ajax({
      url: APIURL + 'bulkApprovalStatus',
      method: 'POST',
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: { trackingId: trakingId },
      dataType: 'json',
      success: function (response) {
        $('#preloader').hide();
        // console.log(trakingId);
        // console.log(response);
        let output = response.data[0];
        if (output.status == 2) {
          $('#' + trakingId).html('<span class="badge bg-success btn-sm"><i class="bi bi-check2-circle"></i>' + output.updated_count + ' Transferred</span>');
          $.each( bulkTransferPaymentProcessSummary, function( j, obj ) {
            if(obj.trackingID == trakingId){
              obj.status = 2;
            }
          });

          // $('.transferPaymentProcess .modal-body').scrollTop($('#'+trakingId).offset().top)
          TransferPaymentProcessInziated();
          
        } else {
          var failedTrackid = bulkTransferPaymentProcessSummary.filter(n => n.status == 3);

          // If the tracking ID is not in the failedTrackid array, update the HTML content
          if (failedTrackid.every(failedObj => failedObj.trackingID !== trakingId)) {
              $('#' + trakingId).html('<span class="badge bg-info btn-sm">' + output.updated_count + ' In-progress</span>');
              setTimeout(() => { updatestatus(trakingId);}, 3000);
          }else{
            TransferPaymentProcessInziated();
          }
          
        }
        

        

        var successArr = bulkTransferPaymentProcessSummary.filter(n => n.status == 2);
        var failedArr = bulkTransferPaymentProcessSummary.filter(n => n.status == 3);
        
        let successAndFailedCount = successArr.length + failedArr.length;

        if(bulkTransferPaymentProcessSummaryCount == successAndFailedCount){
          // $('.blulkapproveSummary').modal('hide');
          // $('.blulkapproveSummary').modal('hide');
            $('#transferPaymentProcess_action_status').show();
            $('#transferPaymentProcess_action_total').text(successAndFailedCount);
            $('#transferPaymentProcess_action_success').text(successArr.length);
            $('#transferPaymentProcess_action_failed').text(failedArr.length);


          $('#TransferPaymentProcessCloseBtn').show();
          
          //pending process call
          $('#paymentDate').val('');
        }


      },
      error: function (xhr, status, error) {
        console.log("Error:", error);
      }
    });
    $('#preloader').hide();
}


$('#TransferPaymentProcessCloseBtn').on('click',function(){
  tabClickValue(7);
  $('#transferBtn').show();
  $('#transferBtn').prop('disabled',false);
});





function tblPreloaderEnable(tableName){
      var processingDiv = document.getElementById(tableName+'_processing');
      var displayStatus = window.getComputedStyle(processingDiv).display;
      if (displayStatus === 'block') {
      $('#'+tableName+'_processing').html(`<div id="preloader"></div>`);
      } else {
        $('#'+tableName+'_processing').text(`<div id="preloader"></div>`);
      }
}


function generateUniqueId() {
    const timestamp = new Date().getTime();
    return `${timestamp}`;
}



function exportJsonToExcel(jsonData, file_name) {
  // debugger;
  var data = jsonData.map(obj => Object.values(obj));
  var ws = XLSX.utils.aoa_to_sheet([Object.keys(jsonData[0])].concat(data));
  var wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
  var binaryData = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'binary' });
  var blob = new Blob([s2ab(binaryData)], { type: 'application/octet-stream' });
  saveAs(blob, file_name + '.xlsx');
  $('#preloader').hide();
}

function s2ab(s) {
  var buf = new ArrayBuffer(s.length);
  var view = new Uint8Array(buf);
  for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
  return buf;
}

function convertJsonToCsv(jsonData,filename) {
    // Extract column headers from the first object
    let columns = Object.keys(jsonData[0]);

    // Create CSV content
    let csvContent = [
        columns.join(','), // Header row
        ...jsonData.map(obj => columns.map(col => obj[col]).join(',')) // Data rows
    ].join('\n');

    // return csvContent;

    let blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    let link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.setAttribute('download', filename+'.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    $('#preloader').hide();
}

let checkUploaderData = [];

function uploadDataList(dataFilters,approveStatus){

  let selectedScheme = $('#lable_text_scheme_cate').text();
  let yearmonth = $('#lable_text_year_month').text();


  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  window.loginUser_id = userDataString['user_id'];
  $('#preloader').show();
  
  $('#uploadDataList').DataTable().clear().destroy();
  $('#uploadDataList').DataTable({
      "aLengthMenu": [10, 25, 50,100],
      "pageLength": -1,
      "footer": true,
      "dom": 'Bfrtip',
      "buttons": [
        {
              extend: 'csv',
              text: 'CSV',
              filename: selectedScheme+'-Prevalidation-Summary-'+yearmonth,
              exportOptions: {
                  rows: ':visible', // Export visible rows
                  modifier: {
                      selected: null // Export all rows, not just selected
                  }
              }
          },
          {
              extend: 'excel',
              text: 'Excel',
              filename: selectedScheme+'-Prevalidation-Summary-'+yearmonth // Set custom filename for Excel
          },
          {
              extend: 'pdf',
              text: 'PDF',
              filename: selectedScheme+'-Prevalidation-Summary-'+yearmonth // Set custom filename for PDF
          }],
      "searching": false,
      "processing": true,
      "serverSide": true,
      "ajax": {
          "url": APIURL + 'uploadData_list',
          "type": "POST",
          "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          "dataType": "JSON",
          "data": function (data) {
            data.fileters = dataFilters;
            data.approveStatus = approveStatus;
            data.user_id = loginUser_id;
          },
        "beforeSend": function () {
          // $('#preloader').show();
          $('#uploadDataList_tfoot').hide();
          tblPreloaderEnable('uploadDataList');
        },
        "error": function (xhr, error, thrown) {
              Swal.fire({
                  icon: "error",
                  title: 'Service Error !',
                  showConfirmButton: false,
                  timer: 2000
              });
              $('#preloader').hide();
          },
          "dataSrc": 'data',
        },
      "columns": [
    
          { "data": "S.No", render: function (data, type, row, meta) {
              return meta.row + meta.settings._iDisplayStart + 1;
              }
          },
          { "data": "scheme_name" },
          { "data": "district_name" },
          { "data": "taluk_name" },
          { "data": "yyyymm" },
          { "data": "apb_count"},
          { "data": "apb_amount"},
          { "data": "ach_count"},
          { "data": "ach_amount"},
          { "data": "total_count"},
          { "data": "total_amount" },
          // Add more columns as needed
          // Example: { "data": "complaint_raised_by" },
      ],
    "aoColumnDefs": [{
        'bSortable': false,
        'aTargets': [0]
    }],
      "drawCallback": function (settings) {
          // Your drawCallback logic goes here
          // For example, updating dropdowns or other elements after the table is drawn
      },
      "initComplete": function (settings, json) {
      $('#preloader').hide(); // Hide the preloader after DataTable initialization

      checkUploaderData = json.data;
      },
      "footerCallback": function (row, data, start, end, display) {
          var api = this.api();

          // console.log('data >>> ', data);

          if(data.length !=0 && data.length != undefined){
                     let total_table_row =  `<tr>
                      <th id="footerColumn0"></th>
                      <th id="footerColumn1"></th>
                      <th id="footerColumn2"></th>
                      <th id="footerColumn3"></th>
                      <th id="footerColumn4">Total</th>
                      <th id="footerColumn5"></th>
                      <th id="footerColumn6"></th>
                      <th id="footerColumn7"></th>
                      <th id="footerColumn8"></th>
                      <th id="footerColumn9"></th>
                      <th id="footerColumn10"></th>
                      </tr>`;
              $('#uploadDataList_tfoot').html(total_table_row);

            $('#uploadDataList_tfoot').show();
          }else{
           $('#uploadDataList_tfoot').hide();
          }

          var columnsToSum = [5,6,7,8,9,10];
          
          columnsToSum.forEach(function (columnIndex) {
              var sum = api.column(columnIndex, { page: 'current' }).data()
                  .reduce(function (a, b) {
                      var val = parseFloat(b);
                      // return isNaN(val) ? a : a + val;
                      return isNaN(val) ? a : a + val;
                  }, 0);
                  $('#uploadDataList_tfoot #footerColumn' + columnIndex).text(sum);
                  // $('#uploadDataList_tfoot > #footerColumn'+columnIndex).text(sum);

              // console.log("Sum for column " + columnIndex + ": " + sum);

              $(api.column(columnIndex).footer()).html(sum);
          });
      }
  });  
}


function payment_emo_list(dataFilters,approveStatus){
  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  window.loginUser_id = userDataString['user_id'];

  $('#tblPaymentEmoList').DataTable().clear().destroy();
  $('#tblPaymentEmoList').DataTable({
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      "pageLength": 30, 
      "footer": true,
      "dom": 'Bfrtip',
      "buttons": [
          // {
          //       extend: 'csv',
          //       text: 'CSV',
          //       filename: 'Payment Lists',
          //       exportOptions: {
          //           rows: ':visible', // Export visible rows
          //           modifier: {
          //               selected: null // Export all rows, not just selected
          //           }
          //       }
          //   },
          // {
          //     extend: 'excel',
          //     text: 'Excel',
          //     filename: 'Payment Lists' // Set custom filename for Excel
          // },
          // {
          //     extend: 'pdf',
          //     text: 'PDF',
          //     filename: 'Payment Lists' // Set custom filename for PDF
          // }
        ],
      "searching": true,
      "processing": true,
      "serverSide": true,
      "ajax": {
          "url": APIURL + 'payment_list',
          "type": "POST",
          "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          "dataType": "JSON",
          "data": function (data) {
            data.fileters = dataFilters;
            data.approveStatus = approveStatus;
            data.user_id = loginUser_id;
          },
          "beforeSend": function () {
              $('#preloader').show(); // Show the preloader before sending the request
          },
          "error": function (xhr, error, thrown) {
              Swal.fire({
                  icon: "error",
                  title: 'Service Error !',
                  showConfirmButton: false,
                  timer: 2000
              });
              $('#preloader').hide();
          },
          "dataSrc": 'data',
      },
      "columns": [
        // { "data": "checkbox"},
          { "data": "S.No", render: function (data, type, row, meta) {
              return meta.row + meta.settings._iDisplayStart + 1;
              }
          },
          { "data": "scheme_name" },
          { "data": "year_code" },
          { "data": "month_name" },
          { "data": "benificiary_name" },
          { "data": "benificiary_mobile_no"},
          { "data": "payment_mode_name"},
          { "data": "installment_id"},
          { "data": "amount"},
          { "data": "created_dt"},
          { "data": "action" },
          // Add more columns as needed
          // Example: { "data": "complaint_raised_by" },
      ],
      "aoColumnDefs": [{
        'bSortable': false,
        'aTargets': [0]
      }],
      "drawCallback": function (settings) {
          // Your drawCallback logic goes here
          // For example, updating dropdowns or other elements after the table is drawn
      },
      "initComplete": function (settings, json) {
        // alert('preloader hide is working');
          $('#preloader').hide(); // Hide the preloader after DataTable initialization
          tableRecordCount = json.recordsTotal;
      }
  }); 
}




$('#deduplicationBtn').hide();
$('#transFerToValidBtn').hide();

  window.localStorage.setItem('deDuplicatePopup',0);

function deduplicateValidate(){
  $('#deduplicationvalidationCloseBtn').hide();
  TransferPermissionBtnEnable();
  var dataFilters = window.localStorage.getItem('filters');

  var input_schemCode = $('#ddl_scheme_code').val();
  var input_schemName = $('#ddl_scheme_name').val();
  var input_subScheme = $('#ddl_sub_scheme').val();
  var input_dep = $('#ddl_department').val();
  var input_subDep = $('#ddl_sub_department').val();
  var input_dateMonthYear = $('#dayWeekMonthFilter').val();

  if(input_schemCode !='' && input_schemName !='' && input_subScheme !='' && input_dep !='' && input_subDep !='' && input_dateMonthYear != ''){


    if(checkUploaderData!=null){
      $('#deduplicationBtn').hide();
      $('#transFerToValidBtn').hide();
      $('#transferToPaymetProcessBtn').hide();
      let deDuplicationPopupStatus =  window.localStorage.getItem('deDuplicatePopup');
      // if(deDuplicationPopupStatus == 2){
      //   $('.deduplicationValidateSummary').modal({backdrop: 'static',keyboard: false}).modal('show');
      //   return false;
      // }else{
          var userDataString = getCookie('payment_official');
          userDataString = JSON.parse(userDataString);
          window.loginUser_id = userDataString['user_id'];
          $('#function_1').html(`<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>`);
          $('#function_2').html(`<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>`);
          $('#function_3').html(`<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>`);
          $('#function_4').html(`<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>`);
          

          $('.deduplicationValidateFunctionsList').modal({backdrop: 'static',keyboard: false}).modal('show');
         
          var caseList = ['fn_validation_aadhaar','fn_validation_account','fn_validation_duplicatepayment','fn_validation_obsoletebeneficiaries'];
          
          let totalFunction = 4;
          let startFalseFunction = 0;
          let startTrueFunction = 0;
          caseList.length

          caseList.forEach(fnCase => {

            $.ajax({
              url: APIURL + 'checkDuplicationValues',
              method: 'POST',
              headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
              data: { case: fnCase,fileters: dataFilters, user_id:loginUser_id},
              dataType: 'json',
              success: function (response) {

                  let output = response.data;

                  if(response.success == 1){
                      if(output.result==false){
                      // $('#'+output.activeId).html(`<i class="bi bi-check-lg text-success"></i>`);
                      $('#'+output.activeId).html(`<h5 class="badge bg-success fs-custom-dummy">Success</h5>`);
                      // window.localStorage.setItem('deDuplicatePopup',1);
                      startFalseFunction++;
                    }else{
                      // $('#'+output.activeId).html(`<i class="bi bi-x-lg text-danger"></i>`);
                      $('#'+output.activeId).html(`<h5 class="badge bg-danger fs-custom-dummy">Failed</h5>`);
                      startTrueFunction++;
                    }

                    let runningFunctionTotalCount = startTrueFunction + startFalseFunction;
                    // console.log('runningFunctionTotalCount >>>', runningFunctionTotalCount);
                    // console.log(typeof runningFunctionTotalCount);

                    
                    // console.log('totalFunction >>>', totalFunction);
                    // console.log(typeof totalFunction);

                    // if(startTrueFunction != 0){
                      if(totalFunction == runningFunctionTotalCount){
                        $('#deduplicationBtn').show();
                        $('#transFerToValidBtn').show();
                        $('#deduplicationvalidationCloseBtn').show();
                      }
                    // }
                    
                    if(totalFunction == startFalseFunction){
                      // $('#transFerToValidBtn').show();
                      // $('#transferToPaymetProcessBtn').show();
                    }
                    
                  }else{
                    // $('#'+output.activeId).html(`<i class="bi bi-x-lg text-danger"></i>`);
                    $('#'+output.activeId).html(`<h5 class="badge bg-danger fs-custom-dummy">Error</h5>`);
                    Swal.fire({
                    icon: "error",
                    title: response.message,
                    showConfirmButton: true,
                    timer: 20000
                    });
                  }
                  
                  
              },
              error: function (xhr, status, error) {

                if(fnCase=='fn_validation_aadhaar'){
                  $('#function_1').html(`<h5 class="badge bg-danger fs-custom-dummy">Error : <small> ${error} <small> </h5>`);
                }else if(fnCase=='fn_validation_account'){
                  $('#function_2').html(`<h5 class="badge bg-danger fs-custom-dummy">Error : <small> ${error} <small> </h5>`);
                }else if(fnCase=='fn_validation_duplicatepayment'){
                  $('#function_3').html(`<h5 class="badge bg-danger fs-custom-dummy">Error : <small> ${error} <small> </h5>`);
                }else if(fnCase=='fn_validation_obsoletebeneficiaries'){
                  $('#function_4').html(`<h5 class="badge bg-danger fs-custom-dummy">Error : <small> ${error} <small> </h5>`);
                }
                  console.log("Error:", error);
                  $('#deduplicationvalidationCloseBtn').show();
              }
            });
            // $('#deduplicationBtn').prop('disabled',false);
            $('#preloader').hide();
          });
      // }
    }else{
      Swal.fire({
          icon: "error",
          title: "No Data for Validation",
          showConfirmButton: true,
          timer: 2000
      });
    }
  }else{
      Swal.fire({
          icon: "error",
          title: "Select must scheme code, scheme name,Subscheme, department, sub department and payment period",
          showConfirmButton: true,
          timer: 2000
      });
    $("#formFilters").submit();
    $("html, body").animate({ scrollTop: 0 }, 3000);
  }

}

function transferToPending(){
  showTranferPaymentProcess()
}


// $('#transferPaymentProcessCloseOne').on('click',function(){
//     witchModalisActiveCheck();
// });

function witchModalisActiveCheck(){
  $('.modal').each(function() {
    if ($(this).is(':visible')) {
        // console.log('Modal is currently visible.');
        // console.log(this);
    } else {
        // console.log('Modal is currently hidden.');
        // console.log(this);
    }
  });
}


function TransferPermissionBtnDisable(){
    $('#transferToPaymetProcessBtn').prop('disabled', false);
}
function TransferPermissionBtnEnable(){
    $('#transferToPaymetProcessBtn').prop('disabled', true);
}


function paymentListActiveTab(){
  const currentDateAndTime = new Date();
  var dataFilters = window.localStorage.getItem('filters');
  if(getCurrentTabId == 0){
    let fileName ='Pending_paymment_'+currentDateAndTime;
    downloadPaymentList(dataFilters,1,tableRecordCount,fileName);
  }else if(getCurrentTabId == 1){
    let fileName ='Success_paymment_'+currentDateAndTime;
      downloadPaymentList(dataFilters,3,tableRecordCount,fileName);
  }else if(getCurrentTabId == 2){
    let fileName ='Failed_paymment_'+currentDateAndTime;
      downloadPaymentList(dataFilters,4,tableRecordCount,fileName);
  }else if(getCurrentTabId == 3){
    let fileName ='Inprogress_paymment_'+currentDateAndTime;
      downloadPaymentList(dataFilters,2,tableRecordCount,fileName);
  }
  else if(getCurrentTabId == 4){
    let fileName ='Generate_payment_'+currentDateAndTime;
      downloadPaymentList(dataFilters,5,tableRecordCount,fileName);
  }
  else if(getCurrentTabId == 5){
    let fileName ='transfer_payment_to_bank_'+currentDateAndTime;
      downloadPaymentList(dataFilters,6,dataFilters);
  }
}


function downloadPaymentList(dataFilters,approvalStatus,tableRecordCount,filename){
  if(dataFilters!='' || dataFilters!=null || dataFilters!= undefined){
    
  }else{
    // Swal.fire({
    //   icon: "error",
    //   title: 'Select Scheme',
    //   showConfirmButton: false,
    //   timer: 2000
    // });

    console.log('error function downloadPaymentList');
  }
}


function _fnGetHeaders() {
    var dt = $('#uploadDataList').DataTable();
    var thRows = $('#uploadDataList thead tr');
    var numRows = thRows.length;
    var matrix = [];

    for (var rowIdx = 0; rowIdx < numRows; rowIdx++) {
        var $row = $(thRows[rowIdx]);

        var $ths = $row.find("th");
        var aRow = [];

        for (var colIdx = 0; colIdx < $ths.length; colIdx++) {
            var $th = $($ths.get(colIdx));
            aRow.push($th.text().trim());
        }

        matrix.push(aRow);
    }

    return matrix;
}

function htmlDecode(input) {
    var doc = new DOMParser().parseFromString(input, "text/html");
    return doc.documentElement.textContent;
}

function getYearMonth(dateStr) {
    var dateObj = new Date(dateStr);
    var year = dateObj.getFullYear();
    var month = dateObj.getMonth() + 1;
    var monthStr = month < 10 ? '0' + month : month.toString();
    return { year: year, month: monthStr };
}

function processDates(fromDateStr, toDateStr) {
    var fromDate = getYearMonth(fromDateStr);
    var toDate = getYearMonth(toDateStr);
    return {
        from: fromDate,
        to: toDate
    };
}



// ===============================================add dynamic payments inputs


function get_schemebyuser(userid){

// alert(userid);
let ddl_scheme_cate = $('#ddl_scheme_cate').val();
let ddl_scheme_code = $('#ddl_scheme_code').val();
let ddl_scheme_name = $('#ddl_scheme_name').val();
let ddl_sub_scheme = $('#ddl_sub_scheme').val();
let ddl_department = $('#ddl_department').val();
let ddl_sub_department = $('#ddl_sub_department').val();

$('#ddl_payment_period').empty();

  $('#ddl_payment_cycle').text('');
  $('#payment_cycle_hidden').val('');

    // var department = $('#ddl_department').val();
    $.ajax({
    url: APIURL +'get_scheme_by_user',
    type: "POST",
    headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
    data: {user_id:userid,ddl_scheme_cate:ddl_scheme_cate,ddl_scheme_code:ddl_scheme_code,ddl_scheme_name:ddl_scheme_name,ddl_sub_scheme:ddl_sub_scheme,ddl_department:ddl_department,ddl_sub_department:ddl_sub_department},
    success: function(response) {
        // console.log("Success:",JSON.parse(response)[0].data );
        if(response.success == 1){

        var output = response.data[0];
      $('#ddl_payment_cycle').text(output.payment_cycle_text);
      $('#payment_cycle_hidden').val(output.payment_cycle);

      // get_schemebyuserPaymentPeriod(userid,paymentcycle,paymentperiod,iinstallment);
      bindDropDownList(output.payment_cycle_text,'#ddl_payment_period');


        }else{
        console.log("Error:", response);
        }
      
    },
    error: function(xhr, status, error) {
        console.log("Error:", error);
        // Handle the error here
    }
  });
}

function bindDropDownList(type,element){
var userDataString = getCookie('payment_official');
userDataString = JSON.parse(userDataString);
window.loginUser_id = userDataString['user_id'];

    $('#ddl_payment_installment').empty();
    $('#ddl_year').empty();
    
    $('#ddl_year').append($('<option>', {
        value: "",
        text: "Select Year - Month"
    }).attr('disabled','true').attr('selected', 'selected'));

    $('#ddl_payment_installment').append($('<option>', {
        value: "",
        text: "Select Installment"
    }).attr('disabled','true').attr('selected', 'selected'));

    if (typeof type === 'object') {
      type = type[0];
    }

  $.ajax({
    url: APIURL +'fn_general_getdropdownvalues',
    type: "POST",
    headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
    data: {user_id: loginUser_id,dropdown_type:type},
    success: function(response) {
      // console.log(response.data);
    
        var dropdownList = response.data;
        if(response.success ==1){
          $(element).show();
          $(element+'_col').show();
        $(element).empty();
        $(element).append($('<option>', {
              value: "",
              text: "Select "+type
          }));
        // Iterate over the JSON object and append options
        $.each(dropdownList, function (index, dep) {
          $(element).append($('<option>', {
              value: dep.id,
              text: dep.display_text
          }));
        });
      }else{
        $(element).empty();
        if(element!=null && element!=''&&element!=undefined){
          $(element).hide();
          $(element+'_col').hide();
        }

        if(type=='Monthly' || type=='Yearly'){
          get_instalment_filter();
        }
      }
    },
    error: function(xhr, status, error) {
        console.log("Error:", error);
        // Handle the error here
    }
  });
}


$('#ddl_payment_period').on('change',function(){
  get_instalment_filter();
});


function get_instalment_filter(){
$('#ddl_payment_installment').empty();
// $('#ddl_payment_installment').append($('<option>', {
//         value: "",
//         text: "Select Installment"
//     }).attr('disabled','true').attr('selected', 'selected'));
$('#ddl_year').empty();
$('#ddl_year').append($('<option>', {
    value: "",
    text: "Select Year - Month"
}).attr('disabled','true').attr('selected', 'selected'));


var userDataString = getCookie('payment_official');
userDataString = JSON.parse(userDataString);
window.loginUser_id = userDataString['user_id'];
  
let ddl_scheme_cate = $('#ddl_scheme_cate').val();
let ddl_scheme_code = $('#ddl_scheme_code').val();
let ddl_scheme_name = $('#ddl_scheme_name').val();
let ddl_sub_scheme = $('#ddl_sub_scheme').val();
let ddl_department = $('#ddl_department').val();
let ddl_sub_department = $('#ddl_sub_department').val();
let ddl_payment_period = $('#ddl_payment_period').val();
let ddl_payment_cycle = $('#payment_cycle_hidden').val();

if(ddl_payment_period=='' || ddl_payment_period==null||ddl_payment_period==undefined){
  ddl_payment_period = -1;
}

  $.ajax({
   url: APIURL +'get_installment_filter',
   type: "POST",
   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
   data: {user_id:loginUser_id,ddl_scheme_cate:ddl_scheme_cate,ddl_scheme_code:ddl_scheme_code,ddl_scheme_name:ddl_scheme_name,ddl_sub_scheme:ddl_sub_scheme,ddl_department:ddl_department,ddl_sub_department:ddl_sub_department,paymentcycle:ddl_payment_cycle,paymentperiod:ddl_payment_period},
   success: function(response) {

       if(response.success == 1){
        var output = response.data;

        // console.log('ouput >>>', output);

            let installment = fetchDropdownValues('Installment');
            installment.then(function(arrayValue) {
            let grounList = [];

            output.forEach(element => {
              grounList.push(element.installments);
            });

            let instamentList = arrayValue.filter(item => grounList.includes(item.id));

            if(instamentList.length==1){
                  instamentList.forEach(list => {                 
                  $('#ddl_payment_installment').append($('<option>', {
                    value: list.value,
                    text: list.display_text
                  }).attr('selected','selected'));
                  $('#ddl_payment_installment').change();
                });
                }else{
                  $('#ddl_payment_installment').append($('<option>', { value: "",text: "Select Installment"}));
                    instamentList.forEach(list => {                 
                    $('#ddl_payment_installment').append($('<option>', {
                      value: list.value,
                      text: list.display_text
                    }));
                  });
                }

            });
       }else{
        console.log("Error:", response);
       }
       
    
   },
   error: function(xhr, status, error) {
       console.log("Error:", error);
       // Handle the error here
   }
 });
}



$('#ddl_payment_installment').on('change',function(){
  let instalmment_value = $('#ddl_payment_installment').val();
  
  if(instalmment_value!='' || instalmment_value!=null){
      let installment_txt_value = $('#ddl_payment_installment option:selected').text();
      
      $('#installment_txt_value').val(installment_txt_value);
  }else{
      let installment_txt_value = '';
      $('#installment_txt_value').val(installment_txt_value);
  }
  $('#ddl_year').selectpicker('destroy');
  $('#ddl_year').empty();
    
    $('#ddl_year').append($('<option>', {
        value: "",
        text: "Select Year - Month"
    }).attr('disabled','true').attr('selected', 'selected'));

var userDataString = getCookie('payment_official');
userDataString = JSON.parse(userDataString);
window.loginUser_id = userDataString['user_id'];

let ddl_scheme_cate = $('#ddl_scheme_cate').val();
let ddl_scheme_code = $('#ddl_scheme_code').val();
let ddl_scheme_name = $('#ddl_scheme_name').val();
let ddl_sub_scheme = $('#ddl_sub_scheme').val();
let ddl_department = $('#ddl_department').val();
let ddl_sub_department = $('#ddl_sub_department').val();
let ddl_payment_period = $('#ddl_payment_period').val();
let ddl_payment_cycle = $('#payment_cycle_hidden').val();
let ddl_payment_installment = $('#ddl_payment_installment').val();
if(ddl_payment_period=='' || ddl_payment_period==null||ddl_payment_period==undefined){
  ddl_payment_period = -1;
}
$.ajax({
 url: APIURL +'get_year_filter',
 type: "POST",
 headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
 data: {user_id:loginUser_id,ddl_scheme_cate:ddl_scheme_cate,ddl_scheme_code:ddl_scheme_code,ddl_scheme_name:ddl_scheme_name,ddl_sub_scheme:ddl_sub_scheme,ddl_department:ddl_department,ddl_sub_department:ddl_sub_department,paymentcycle:ddl_payment_cycle,paymentperiod:ddl_payment_period,iinstallment:ddl_payment_installment},
 success: function(response) {

     if(response.success == 1){
      var output = response.data;
      // Iterate over the JSON object and append options
      $.each(output, function (index, list) {
          // if(sub_dep.sub_department_code==subDepID){ 
            $('#ddl_year').append($('<option>', {
              value: list.yyyymm,
              text: list.yyyymm_text
          }));
        // }
      });
      $('#ddl_year').selectpicker();
     }else{
      console.log("Error:", response);
     }
     
  
 },
 error: function(xhr, status, error) {
     console.log("Error:", error);
     // Handle the error here
 }
});
});

$('#ddl_year').selectpicker();


async function dropDownList(type) {
  try {
      var userDataString = getCookie('payment_official');
      userDataString = JSON.parse(userDataString);
      window.loginUser_id = userDataString['user_id'];

      const response = await $.ajax({
          url: APIURL + 'fn_general_getdropdownvalues',
          type: "POST",
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: { user_id: loginUser_id, dropdown_type: type }
      });

      // console.log(response.data);
      return response.data;
  } catch (error) {
      console.error("Error:", error);
      throw error;
  }
}

async function fetchDropdownValues(type) {
try {
    let getDropDown = await dropDownList(type);
    // console.log(`type >>`, getDropDown);
    return getDropDown;
} catch (error) {
    console.error('Error occurred:', error);
}
}

$('#failur_reason_filter').on('change',function(){
  let selectReasonCode = $(this).val();
  $('#select_reason_code').val(selectReasonCode);
  $('#emo_reason_code').val(selectReasonCode);
});

$('#transferPaymentProcessCloseOne, #pendingBulkApproveClose, #emoBlulkapproveSummaryCloseTop, #reinitiateBlulkapproveSummaryCloseTop').click(function(){
  var tabId = $('#approvelpayment').val();
  if(tabId=='') {
    tabId = 7;
  }
  tabClickValue(tabId);
  $('#paymentDate').val('');
  $('#reinitiatePaymentDate').val('');
  
});


localStorage.clear();

</script>

</body>
</html>