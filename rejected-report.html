<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Payment Automation Dashboard</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    <!-- Favicons -->
    <link href="assets/img/tn_logo.png" rel="icon">
    <link href="assets/img/tn_logo.png" rel="apple-touch-icon">
    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> -->
    <link rel="stylesheet" href="assets/vendor/sweetalert2/css/sweetalert.min.css" />
    <link rel="stylesheet" href="assets/vendor/sweetalert2/css/sweetalert2.min.css" />
    <!-- <link rel="stylesheet" href="assets/vendor/toggle/bootstrap-toggle.min.css" /> -->
    <!-- CSS File --> 
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css"> -->
    <script src="assets/components/official_header.js" type="text/javascript" defer></script>
  </head>
  <body>

    <style>
        span#pending_approval_processing {
        position: absolute;
        top: 4.5rem;
        left: 15rem;
        width: auto;
        }
        span#progress_strat {
        position: absolute;
        top: 4.5rem;
        left: 15rem;
        width: auto;
        }
        .text-danger {
        font-size: 13px;
        font-weight: bold;
        }
        div.pamentDateGroup {
        position: absolute;
        right: 19rem;
        margin-top: -19px;
        font-weight: bold;
        font-size: smaller;
        width: 244px;
        }
      span#paymentDate_error {
        position: absolute;
        bottom: -22px;
        }
        ul#myTab .nav-link{
          margin-top: 0.7rem;
        }
        div.pamentDateGroup {
        position: absolute;
        right: 19rem;
        margin-top: -19px;
        font-weight: bold;
        font-size: smaller;
        width: 244px;
        }
        span#paymentDate_error {
          position: absolute;
          bottom: -22px;
          }
      .bi-check-lg::before,.bi-x-lg::before {
        font-size: 2rem;
      }
      .function_1_td,.function_2_td,.function_3_td{
        vertical-align: middle;
        text-align: center;
      }
      .fs-custom-dummy{
          font-size: medium;
          font-weight: bold;
      }
      .cursor-auto{
        cursor: auto!important;
      }
        span#opration-error {
        position: absolute;
        left: 12rem;
        }
    </style>
    <!-- ======= Header & sidemenu ======= -->
    <official-header-component></official-header-component>
    <div id="preloader"></div> 
    <!-- End Sidebar-->
    <main id="main" class="main">
      <!-- Dashboard view starts -->
      <section>
        <div class="container-fluid">
          <div class="card mb-1">
            <form id="formFilters" method="post">
              <div class="card-body pb-0 pt-2">
                <div class="row mb-2 boxflex">
                  <h5 class="card-title pb- mb-0"><i class="bi bi-funnel"></i>  Apply Filter </h5>
                  <div class="col-md">
                    <label for="ddl_scheme_cate" class="form-label fw-bold">Scheme Category</label>
                    <select class="form-select" id="ddl_scheme_cate" name="ddl_scheme_cate">
                      <option value="1">--All--</option>
                      <option value="1">Scheme category 1</option>
                      <option value="1">Scheme category 2</option>
                    </select>
                  </div>
                  <div class="col-md">
                    <label for="ddl_scheme_code" class="form-label fw-bold">Scheme Code</label>
                    <select class="form-select" id="ddl_scheme_code" name="ddl_scheme_code">
                      <option value="">--All--</option>
                    </select>
                  </div>
                  <div class="col-md">
                    <label for="ddl_scheme_name" class="form-label fw-bold">Scheme Name</label>
                    <select class="form-select" id="ddl_scheme_name" name="ddl_scheme_name">
                      <option value="1">--All--</option>
                    </select>
                  </div> 
                  <div class="col-md"> 
                    <label for="ddl_sub_scheme" class="form-label fw-bold">Sub Scheme Name</label>
                    <select class="form-select" id="ddl_sub_scheme" name="ddl_sub_scheme">
                      <!-- <option value="1">--ALL--</option>
                      <option value="1">Sub Scheme 1</option>
                      <option value="1">Sub Scheme 2</option> -->
                    </select>
                  </div>
                  <div class="col-md">
                    <label for="ddl_department" class="form-label fw-bold">Department</label>
                    <select class="form-select" id="ddl_department" name="ddl_department">
                      <option value="1">--All--</option>
                    </select>
                  </div>
                  <div class="col-md">
                    <label for="ddl_sub_department" class="form-label fw-bold">Sub Department</label>
                    <select class="form-select" id="ddl_sub_department" name="ddl_sub_department">
                      <option value="1">--All--</option>
                    </select>
                  </div>
                </div>
                <hr>
                <div class="row mb-2 boxflex">
                  <div class="col-md-3">
                    <label class="form-label fw-bold" for="dayWeekMonthFilter">Payment Period</label>
                    <select name="dayWeekMonthFilter" id="dayWeekMonthFilter" class="form-select">
                      <option value="" disabled selected>Select Payment Period</option>
                      <option value="1">Today</option>
                      <!-- <option value="2">This Week</option> -->
                      <option value="3" selected>This Month</option>
                      <option value="0">Custom Date Range</option>
                      <option value="4">Custom Year Month</option>
                    </select>
                  </div>
                  <div class="col-md" id="from_date_col">
                    <label for="from_date" class="form-label fw-bold">From Date</label>
                    <input type="date" name="from_date" id="from_date" class="form-control form-control-sm">
                  </div>
                  <div class="col-md" id="to_date_col">
                    <label for="to_date" class="form-label fw-bold">To Date</label>
                    <input type="date" name="to_date" id="to_date" class="form-control form-control-sm">
                  </div>

                  <div class="col-md" id="ddl_month_col">
                    <label for="from_date" class="form-label fw-bold">Select Month</label>
                    <select name="ddl_month" id="ddl_month" class="form-select">
                      <option value="" disabled selected>Select Month</option>
                      <option value="01">January</option>
                      <option value="02">February</option>
                      <option value="03">March</option>
                      <option value="04">April</option>
                      <option value="05">May</option>
                      <option value="06">June</option>
                      <option value="07">July</option>
                      <option value="08">August</option>
                      <option value="09">September</option>
                      <option value="10">October</option>
                      <option value="11">November</option>
                      <option value="12">December</option>
                    </select>
                  </div>
                  <div class="col-md" id="ddl_year_col">
                    <label for="to_date" class="form-label fw-bold">Select Year</label>
                    <select name="ddl_year" id="ddl_year" class="form-select">
                      <option value="" disabled selected>Select Year</option>
                      <option value="2022">2022</option>
                      <option value="2023">2023</option>
                      <option value="2024">2024</option>
                    </select>
                  </div>


                </div>

                <hr>
                <div class="row boxflex mb-3">
                  <div class="col-md-6">
                    <label for="ddl_district" class="form-label fw-bold">District</label>
                    <select class="form-select" id="ddl_district" name="ddl_district">
                      <option value="">--ALL--</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="ddl_taluk" class="form-label fw-bold">Taluk</label>
                    <select class="form-select" id="ddl_taluk" name="ddl_taluk">
                      <option value="">--ALL--</option>
                    </select>
                  </div>
                </div>
                <div class="row mb-2 boxflex">
                  <!-- <a class="btn btn-success float-end cbtn col-md-1" id="get_filter"><i class="bi bi-check2-circle"></i> Submit</a> -->
                  <button class="btn btn-success float-end cbtn col-md-2" type="submit"><i class="bi bi-pencil-square"></i> Submit</button>
                </div>
  
  
              </div>

              <input type="hidden" name="approvelpayment" id="approvelpayment">
            </form>
          </div>
          <!-- END: Dropdown card end here -->
          <div class="card mb-2 mt-3" id="tblCard">
            <div class="card-body">
              <!-- <ul class="nav nav-tabs my-3" id="myTab" role="tablist"> -->
                  <!-- <li class="nav-item mx-2" role="presentation">
                    <button class="nav-link active" id="upload-process-tab" data-bs-toggle="tab" data-bs-target="#upload-process-tab-pane" type="button" role="tab" aria-controls="upload-process-tab-pane" aria-selected="false" onclick="tabClickValue(7)">Pending for Validation</button>
                  </li> -->
                <!-- <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false" onclick="tabClickValue(0)">Pending for Approval</button>
                </li> -->
                <!-- <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="disabled-tab1" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane2" type="button" role="tab" aria-controls="disabled-tab-pane" aria-selected="false" value="3" onclick="tabClickValue(4)"> Generate Payment File </button>
                </li> -->
                <!-- <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="disabled-tab1" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane3" type="button" role="tab" aria-controls="disabled-tab-pane" aria-selected="false" value="3" onclick="tabClickValue(5)"> Transfer Payment to Bank </button>
                </li> -->
                <!-- <li class="nav-item mx-2" role="presentation">
                  <button class="nav-link" id="disabled-tab1" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane1" type="button" role="tab" aria-controls="disabled-tab-pane" aria-selected="false" value="3" onclick="tabClickValue(3)">Payment In-Progress</button>
                </li> -->
                <!-- <li class="nav-item mx-2 active" role="presentation">
                  <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="false" onclick="tabClickValue(1)">Payment Rejected</button>
                </li> -->
                <!-- <li class="nav-item" role="presentation">
                  <button class="nav-link mx-2" id="disabled-tab" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane" type="button" role="tab" aria-controls="disabled-tab-pane" aria-selected="false" value="2" onclick="tabClickValue(2)">Payment Failed</button>
                </li> -->
              <!-- </ul> -->
              <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i>  Reinitiate / Reject Payment Files
                        </h5>
                        <div class="clear-both"></div>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            
                            <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymentRejectionList" aria-describedby="tblPaymentRejectionList_info">
                              <thead>
                                <tr>
                                  <!-- <th scope="col"><input class="form-check-input" type="checkbox" value="" ></th> -->
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentRejectionList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentRejectionList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">File Name</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentRejectionList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Approval Date</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentRejectionList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Submitted Date</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentRejectionList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Payment Date </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentRejectionList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">File Type</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentRejectionList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Beneficiary Count</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentRejectionList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Action</th>
                                </tr>
                              </thead>
                              <tbody>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- END: list card end here -->
          <!-- START: modal popup -->
          <!-- Button trigger modal -->
        </div>
      </section>
    </main>
    <!-- End #main -->
    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div class="copyright">
        &copy; Copyright <strong><span>TNeGA</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        Designed & Developed by <a href="https://tngis.tn.gov.in/" target="_blank">TNeGA</a>
      </div>
    </footer>
    <!-- End Footer -->
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
    <!-- Delete modal starts -->
    <!-- view data starts -->
    <div class="modal fade viewdatainfo" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Payment File Reinitiate / Reject</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="rejectedReasonForm" method="post">
          <div class="modal-body py-2">
            <div class="row scheme-data mb-2">
              <div class="col-md-12 mt-2">
                <label for="selected_reason" class="form-label fw-bold">Reason</label>
                <select class="form-select" name="selected_reason" id="selected_reason">
                    <option disabled selected>Select the Reasons</option>
                    <option value="300">others</option>
                </select>
              </div>
              <div class="col-md-12 mt-2" id="reason_custom_text_div">
                <label for="reason_custom_text" class="form-label fw-bold">Remarks</label>
                <textarea class="form-control" name="reason_custom_text" id="reason_custom_text" cols="30" rows="2"></textarea>
              </div>
              <div class="col-md-12">
                <label for="reason_custom_text" class="form-label fw-bold">Opration</label>
                <label for="reject">
                  <input type="radio" name="opration" id="reject" value="true"> Reject
                </label>
                <label for="reinitiate">
                  <input type="radio" name="opration" id="reinitiate" value="false"> Reinitiate
                </label>
              </div>
              <div class="col-md-12 mt-2" id="reinitiate_payment_date_div">
                <label for="reinitiate_payment_date" class="form-label fw-bold">Reinitiate Payment Date</label>
                <input class="form-control" type="date" name="reinitiate_payment_date" id="reinitiate_payment_date">
              </div>
            </div>
          </div>
          <input type="hidden" name="list_id" id="list_id">
          <input type="hidden" name="scheme_id" id="scheme_id">
          <input type="hidden" name="popupuserid" id="popupuserid">
          <input type="hidden" name="paymentmodeid" id="paymentmodeid">
          <input type="hidden" name="filename" id="filename">
          <div class="modal-footer">
            <button type="submit" class="btn btn-danger" id="btn_name_change">Reject</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
          </div>
        </form>
        </div>
      </div>
    </div>
    <!-- view data ends -->


    <!-- view data starts -->

    <!-- view crop info ends -->
    <!-- Vendor JS Files -->
    
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script type="text/javascript" src="assets/vendor/jquery-validate/js/jquery.validate.min.js"></script>


    <!-- data table -->
    <script src="assets/vendor/datatable/jquery.dataTables.min.js"></script>
    <script src="assets/vendor/datatable/dataTables.bootstrap5.min.js"></script>
    <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.js"></script>
    <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.bootstrap4.js"></script>
    <script src="assets/vendor/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/jszip.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/pdfmake.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/vfs_fonts.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.colVis.min.js"></script>
    <script src="assets/vendor/sweetalert2/js/sweetalert.min.js"></script>
    <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
    <script src="assets/vendor/toggle/bootstrap-toggle.min.js"></script>
    <script src="assets/js/global.js"></script>
    <script src="assets/js/alpinejs_3_10_2.min.js" defer></script>
    <script src="assets/lang/reports.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js'></script>
    <script src="assets/scripts/xlsx.full.min.js"></script>
    <!-- data table -->



    
    <!-- Main JS File -->
    
    <script src="assets/js/global.js"></script>
    <script src="assets/js/base64tojson.js"></script>
    <script src="assets/js/crypto-js.js"></script>
    <script src="assets/js/aes.js"></script>
  

    <script type="text/javascript" src="assets/vendor/toastr/toastr.min.js"></script>
    
    <!-- Crypto js -->
    <script src="assets/vendor/encryption/crypto-js.min.js"></script>
    <!-- Encryption js -->
    <script src="assets/vendor/encryption/Encryption.js"></script>
    <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
    
    
 
<script type="text/javascript">
  var url = window.location.href;
  var page_url = url.split('/');
  var page = page_url[4];

  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  $(document).ready(function () {
    $(document).on({
          //  ajaxStart: function () {
          //    $('#preloader').show();
          //   //  console.log('preloader is show');
          //  },
          ajaxStop: function () {
            $('#preloader').hide();
            //  console.log('preloader is show');
          }
        });

    $('.official').each(function (i, obj) {
      var href = obj.getAttribute("href");
      if (href == page) {
        obj.classList.add('active');
      } else {
        obj.classList.remove('active');
      }
    });
    // $('#preloader').hide();
  
    var userDataString = getCookie('payment_official');
    if (!userDataString) {
      $('#preloader').show();
      window.location.href = "login.html";
    }

    userDataString = JSON.parse(userDataString);
    $('#official_username').text(userDataString['first_name']);
    $('#UserID').val(userDataString['user_id']);
    window.loginUser_id = userDataString['user_id'];
    reloID = userDataString['role_id'];
      roleBasedPageAllow(loginUser_id,reloID);

    
    getSchemeCategory();
    getDistricts();

    $('#ddl_sub_scheme').on('change',function(){
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();

    $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
      $('#preloader').show();
      $.ajax({
        url: APIURL +'schem_filter',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: {case: "get_department",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),sub_scheme_name:$('#ddl_sub_scheme').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
        success: function(response) {
          $('#preloader').hide();
            //  console.log("department:", response);
            var department_code = response.data[0];
            // console.log(department_code.department);
            getDepartment(department_code.department);
        },
        error: function(xhr, status, error) {
          $('#preloader').hide();
            console.log("Error:", error);
        }
      });
    });

    $('#ddl_district').on('change', function () {
      var district_code = $('#ddl_district').val();
      $('#ddl_taluk').empty();
      $('#ddl_taluk').append('<option value="">--All--</option>');
      getTaluk(district_code);
    });

});

function getCookie(name) {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.startsWith(name + '=')) {
        return cookie.substring(name.length + 1);
      }
    }
    return null;
  }

/* filters */
function getSchemeCategory(){
    
    $('#ddl_scheme_name').empty();
    $('#ddl_sub_scheme').empty();
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();
 
    $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
    $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
 
  $.ajax({
    url: APIURL +'schem_filter',
    type: "POST",
    headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
    data: {case: "get_scheme_category",get_column:"scheme_code",groupbycolumn:"scheme_code",user_id:loginUser_id},
    success: function(response) {
       //  console.log("Success:", response);
        var schemeCode = response.data;
       //  console.log('scheme code >>> ',schemeCode);
 
        $('#ddl_scheme_cate').empty();
        $('#ddl_scheme_cate').append($('<option>', {
              value: "",
              text: "--All--"
          }));

        $.each(schemeCode, function (index, scheme) {
            // console.log('scheem code lenthg >>> ', schemeCode.length);
            if(schemeCode.length >1){
              $('#ddl_scheme_cate').append($('<option>', {
                value: scheme.scheme_category,
                text: scheme.scheme_category
            }));
            }else{
              $('#ddl_scheme_cate').append($('<option>', {
                value: scheme.scheme_category,
                text: scheme.scheme_category
            }).prop('selected', true));
            $('#ddl_scheme_cate').trigger('change');
            }
         });
    },
    error: function(xhr, status, error) {
        console.log("Error:", error);
    }
  });
}

$('#ddl_scheme_cate').on('change',function(){
  
    $('#ddl_scheme_code').empty();
    $('#ddl_scheme_name').empty();
    $('#ddl_sub_scheme').empty();
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();

    $('#ddl_scheme_code').append($('<option>', {value: "", text: "--All--"}));
    $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
    $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
  
   $.ajax({
     url: APIURL +'schem_filter',
     type: "POST",
     headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
     data: {case: "get_scheme_code",get_column:"scheme_code",groupbycolumn:"scheme_code",whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
     success: function(response) {
        //  console.log("Success:", response);
         var schemeCode = response.data;
        //  console.log('scheme code >>> ',schemeCode);
  
         $('#ddl_scheme_code').empty();
         $('#ddl_scheme_code').append($('<option>', {
               value: "",
               text: "--All--"
           }));  

        $.each(schemeCode, function (index, scheme) {
            // console.log('scheem code lenthg >>> ', schemeCode.length);
            if(schemeCode.length >1){
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
            }));
            }else{
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
            }).prop('selected', true));
            // $('#ddl_scheme_code').trigger('change');
            }
         });
         $('#ddl_scheme_code').trigger('change');
     },
     error: function(xhr, status, error) {
         console.log("Error:", error);
     }
   });
})



$('#ddl_scheme_code').on('change',function(){

     $('#ddl_sub_scheme').empty();
     $('#ddl_scheme_name').empty();
     $('#ddl_sub_scheme').empty();
     $('#ddl_department').empty();
     $('#ddl_sub_department').empty();

     $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
     $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
     $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
     $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
     $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));

      $('#preloader').show();
   $.ajax({
   url: APIURL +'schem_filter',
   type: "POST",
   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
   data: {case: "get_scheme",scheme_code:$('#ddl_scheme_code').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
   success: function(response) {
    $('#preloader').hide();
      //  console.log("Success:", response);
       var schemeCode = response.data;
      //  console.log(schemeCode.scheme_code);
       $('#ddl_scheme_name').empty();
       $('#ddl_scheme_name').append($('<option>', {
             value: "",
             text: "--All--"
         }));
       // Iterate over the JSON object and append options
       $.each(schemeCode, function (index, scheme) {
        // console.log('scheem code lenthg >>> ', schemeCode.length);
        if(schemeCode.length >1){
          $('#ddl_scheme_name').append($('<option>', {
             value: scheme.scheme_name,
             text: scheme.scheme_name
         }));
        }else{
          $('#ddl_scheme_name').append($('<option>', {
             value: scheme.scheme_name,
             text: scheme.scheme_name
         }).prop('selected', true));
        //  $('#ddl_scheme_name').trigger('change');
        }
       });
       $('#ddl_scheme_name').trigger('change');
   },
   error: function(xhr, status, error) {
    $('#preloader').hide();
       console.log("Error:", error);
   }
 });

});

$('#ddl_scheme_name').on('change',function(){

   
   // $('#ddl_scheme_name').empty();
   $('#ddl_sub_scheme').empty();
   $('#ddl_department').empty();
   $('#ddl_sub_department').empty();

   
   // $('#ddl_scheme_name').append($('<option>', {value: "", text: "--ALL--"}));
   $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
   $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
   $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));


$('#preloader').show();
   $.ajax({
   url: APIURL +'schem_filter',
   type: "POST",
   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
   data: {case: "get_sub_scheme",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
   success: function(response) {
    $('#preloader').hide();
      //  console.log("Success:", response);
       var schemeCode = response.data;
      //  console.log(schemeCode.scheme_code);
       $('#ddl_sub_scheme').empty();
       $('#ddl_sub_scheme').append($('<option>', {
             value: "",
             text: "--All--"
         }));
       // Iterate over the JSON object and append options
       $.each(schemeCode, function (index, scheme) {
        if(schemeCode.length > 1){
          $('#ddl_sub_scheme').append($('<option>', {
             value: scheme.subscheme_name,
             text: scheme.subscheme_name
         }));
        }else{
          $('#ddl_sub_scheme').append($('<option>', {
             value: scheme.subscheme_name,
             text: scheme.subscheme_name
         }).prop('selected', true));
        }
        // $('#ddl_sub_scheme').trigger('change');
       });
       $('#ddl_sub_scheme').trigger('change');
   },
   error: function(xhr, status, error) {
    $('#preloader').hide();
       console.log("Error:", error);
   }
 });

});

// get_scheme


/* filters */
function getDepartment(depID){
   $('#ddl_department').empty();
   $('#ddl_sub_department').empty();

   $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
   $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
    $('#preloader').show();
    let scheme_cate = $('#ddl_scheme_cate').val();
$.ajax({
   url: APIURL +'get_department',
   type: "POST",
   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
   data: {type: "department"},
   success: function(response) {
       // console.log("Success:",JSON.parse(response)[0].data );
       var department = response[0].data;
       // Handle the successful response here
      //  $('#ddl_department').empty();
      //  $('#ddl_department').append($('<option>', {
      //        value: "",
      //        text: "--All--"
      //    }));
      if(scheme_cate == '' || scheme_cate === 0){
                  $('#ddl_department').empty();
                  $('#ddl_department').append($('<option>', {val: '', text: '--All--' }));
                  $('#ddl_payment_cycle').empty();
                  $('#ddl_payment_cycle').append($('<option>', {val: '', text: 'Scheme Based Payment Period' }));
              }
              else
              {
       // Iterate over the JSON object and append options
       $.each(department, function (index, dep) {
         if(dep.department_code==depID){
           $('#ddl_department').append($('<option>', {
             value: dep.department_code,
             text: dep.department_name
           }).attr('selected', 'selected'));
           $('#ddl_department').trigger('change');
           if(scheme_cate == '' || scheme_cate === 0){
                  $('#ddl_department').empty();
                  $('#ddl_department').append($('<option>', {val: '', text: '--All--' }));
                  $('#ddl_payment_cycle').empty();
                  $('#ddl_payment_cycle').append($('<option>', {val: '', text: 'Scheme Based Payment Period' }));
              }
              else
              {
           $.ajax({
                 url: APIURL +'schem_filter',
                 type: "POST",
                 headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
                 data: {case: "get_sub_department",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),sub_scheme_name:$('#ddl_sub_scheme').val(),department:$('#ddl_department').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
                 success: function(response) {
                  $('#preloader').hide();
                    //  console.log("department:", response);
                     var subdepartment_code = response.data[0];
                    //  console.log(subdepartment_code.department);
                     get_sub_department(dep.department_code,subdepartment_code.subdepartment);
                 },
                 error: function(xhr, status, error) {
                  $('#preloader').hide();
                     console.log("Error:", error);
                 }
             });
            }
         }
       });
      }
      
   },
   error: function(xhr, status, error) {
       console.log("Error:", error);
       // Handle the error here
   }
 });
}


// $('#ddl_department').on('change',function(){
 function get_sub_department(depID,subDepID){
   $('#ddl_sub_department').empty();
   $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
    $('#preloader').show();
     // var department = $('#ddl_department').val();
     $.ajax({
     url: APIURL +'get_department',
     type: "POST",
     headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
     data: {type: "sub_department",whereColumn:$('#ddl_scheme_cate').val(),department_code:depID},
     success: function(response) {
      $('#preloader').hide();
         // console.log("Success:",JSON.parse(response)[0].data );
         var department = response[0].data;
         // Handle the successful response here
         $('#ddl_sub_department').empty();
         $('#ddl_sub_department').append($('<option>', {
               value: "",
               text: "--All--"
           }));
         // Iterate over the JSON object and append options
         $.each(department, function (index, sub_dep) {
           if(sub_dep.sub_department_code==subDepID){
             $('#ddl_sub_department').append($('<option>', {
               value: sub_dep.sub_department_code,
               text: sub_dep.sub_department_name
           }).attr('selected', 'selected'));
           }
         });
     },
     error: function(xhr, status, error) {
      $('#preloader').hide();
         console.log("Error:", error);
         // Handle the error here
     }
   });
 }

  function getDistricts(){
      const userDataString = getCookie("payment_official");
      const userData = JSON.parse(userDataString);

      var districtID=0;
      var data=[];
      if(userData['district_code']!=0){
      districtID=userData['district_code'];
      data={ case: 'district',district_code: districtID,user_id:userData['user_id']};
      } else {
      data={ case: 'district',user_id:userData['user_id']};
      }

      $('#ddl_taluk').empty();
      $('#ddl_taluk').append('<option value="">--All--</option>');
      $('#preloader').show();
    $.ajax({
      url: userMasterAPIURL+'userMaster',
      method: 'POST',
      headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: data,
      dataType: 'json',
      success: function (response) {
        $('#preloader').hide();
        //console.log(response);
        var district = response.district;
        var districtDropdown = $("#ddl_district");
        $('#ddl_district').empty();
        $('#ddl_district').append($('<option>', {value: "",text: "--All--"}));
          
        if(districtID==0 || districtID ==undefined){
        populateDropdown('ddl_district', response.districts, 'district');              
        } else {
        districtDropdown.html('<option value="'+district['district_code']+'">'+district['district_name']+'</option>');
        $('#ddl_district').trigger('change');
        var district_code= district['district_code'];
          getTaluk(district_code);
        } 
      },
      error: function () {
        $('#preloader').hide();
        console.error('Error fetching district data');
      }
    });
  }


  

  /*START : Get Taluk list*/
  function getTaluk(districtID){
    $('#ddl_taluk').empty();
    $('#ddl_taluk').append('<option value="">--All--</option>');
    // var district=$("#ddl_district").val();
      const userDataString = getCookie("payment_official");
      const userData = JSON.parse(userDataString);

      // var district=district_code;
      var talukID=0;
      var data=[];
      if(userData['taluk_code']!=0){
      // districtID=userData['district_code'];
      talukID=userData['taluk_code'];
      data={ case: 'taluk',district_code: districtID,taluk_code: talukID,user_id:userData['user_id']};
      } else {
      data={ case: 'taluk',district_code: districtID,user_id:userData['user_id']};
      }
      $('#preloader').show();
    
    $.ajax({
      url: userMasterAPIURL+'userMaster', // Replace with your API endpoint
      method: 'POST',
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: data,
      dataType: 'json',
      success: function (response) {
        $('#preloader').hide();
        /*$('#ddl_taluk').empty();
        $.each(response.taluk, function (index, value) 
        {
            $('#ddl_taluk').append('<option value="' + value.taluk_code + '">' + value.taluk_name + ' </option>');
        });*/
        var taluk = response.taluk
        var talukDropdown = $("#ddl_taluk");
      //  populateDropdown('ddl_taluk', response.taluk, 'taluk'); 
        if(talukID==0){
          populateDropdown('ddl_taluk', response.taluk, 'taluk');             
        } else {
          
          talukDropdown.html('<option value="'+taluk['taluk_code']+'">'+taluk['taluk_name']+'</option>');
        $('#ddl_taluk').trigger('change');
        }

      },
      error: function () {
        $('#preloader').hide();
        Swal.fire({
          icon: "error",
          title: "Service Error!",
          showConfirmButton: false,
          timer: 2000
        })
      }
    });
  }

    $("#from_date").prop("disabled", true);
    $("#to_date").prop("disabled", true);

    // selectbox
    $("#ddl_month_col").hide();
    $("#ddl_year_col").hide();
    
    $("#ddl_month_col").prop("disabled", true);
    $("#ddl_year_col").prop("disabled", true);




  $('#dayWeekMonthFilter').on('change',function(){
      var payment_period = $('#dayWeekMonthFilter').val();
      if(payment_period == 0){
        $("#from_date_col").show();
        $("#to_date_col").show();
        $("#from_date").prop("disabled", false);
        $("#to_date").prop("disabled", false);

        $("#ddl_month_col").hide();
        $("#ddl_year_col").hide();
        $("#ddl_month").prop("disabled", true);
        $("#ddl_year").prop("disabled", true);

      }else if(payment_period == 4){

        $("#from_date_col").hide();
        $("#to_date_col").hide();
        $("#from_date").prop("disabled", false);
        $("#to_date").prop("disabled", false);

        $("#ddl_month_col").show();
        $("#ddl_year_col").show();
        $("#ddl_month").prop("disabled", false);
        $("#ddl_year").prop("disabled", false);
    
      } else{
        $("#from_date").val('');
        $("#from_date").prop("disabled", true);
        $("#to_date").val('');
        $("#to_date").prop("disabled", true);

        $("#from_date_col").show();
        $("#to_date_col").show();
        $("#from_date").prop("disabled", true);
        $("#to_date").prop("disabled", true);

        $("#ddl_month_col").hide();
        $("#ddl_year_col").hide();
        $("#ddl_month").prop("disabled", true);
        $("#ddl_year").prop("disabled", true);
      }
  });

  // $('#from_date').on('change', function() {
  //     $('#today').prop('checked', false);
  //     $('#thisweek').prop('checked', false);
  //     $('#thismonth').prop('checked', false);
  // });

  $('#to_date').on('change', function() {
      $('#today').prop('checked', false);
      $('#thisweek').prop('checked', false);
      $('#thismonth').prop('checked', false);
      var fromDate = $('#from_date').val();
      var toDate = $(this).val();
      // Check if "to_date" is earlier than "from_date"
      if (fromDate && toDate && fromDate > toDate) {
        alert('To Date should not be earlier than From Date.');
        // You can reset the "to_date" value or take other actions here
        $(this).val('');
      }
  });

  

  


  /*END : Get Taluk list*/
// });

var formsFilter = [];
window.localStorage.removeItem('filters');
$('#tblCard').hide();
/*from submit*/
$(document).ready(function() {
  $("#formFilters").validate({
          rules: {
            ddl_scheme_cate: {required: true},
            ddl_scheme_code: {required: true},
            ddl_scheme_name: {required: true},
            ddl_sub_scheme: {required: true},
            ddl_department: {required: true},
            ddl_sub_department: {required: true},
            dayWeekMonthFilter : {required: true},
            from_date : {required: true},
            to_date : {required: true},
            ddl_month:{required: true},
            ddl_year :{required: true},
          },
          messages: {
            ddl_scheme_cate: {required: "Select the Scheme Category"},
            ddl_scheme_code: {required: "Select the Scheme Code"},
            ddl_scheme_name: {required: "Select the scheme Name"},
            ddl_sub_scheme: {required: "Select the Sub Scheme Name"},
            ddl_department: {required: "Select the Deparment"},
            ddl_sub_department: {required: "Select the Sub Deparment"},
            // ddl_district: {required: "Select the District"},
            // ddl_taluk: {required: "Select the Taluk"},
            // ddl_jurisdiction: {required: "Select the jurisdiction"},
            dayWeekMonthFilter :{required: "Select the Payment Period"},
            from_date : {required: "Select the From Date"},
            to_date : {required: "Select the To Date"},
          ddl_month : {required: "Select the Month"},
          ddl_year : {required: "Select the year"},
          },
          errorClass: "help-inline text-danger",
          errorElement: "span",
          highlight: function(element, errorClass, validClass) {
              $(element).parents('.form-group').addClass('has-error');
          },
          unhighlight: function(element, errorClass, validClass) {
              $(element).parents('.form-group').removeClass('has-error');
              $(element).parents('.form-group').addClass('has-success');
          },
          submitHandler: function(form,e) {
              e.preventDefault();
            //   console.log('Form submitted');
              formsFilter.length = 0;
              formsFilter = [];
              var formData = $(form).serialize();
              window.localStorage.removeItem('filters');
              window.localStorage.setItem('filters', JSON.stringify(formData));
              // window.localStorage.setItem('filters', formData);
              var tabId = $('#approvelpayment').val();
              if(tabId==''){tabId = 1;}

                tabClickValue(tabId);

              $('html, body').animate({
                scrollTop: $("#tblCard").offset().top
              }, 2000);

              return false;
          }
    });
});

// $('#reason_custom_text_div').hide();
// $('#reason_custom_text').hide();
// $('#reason_custom_text').prop('disabled',true);


$('#selected_reason').on('change',function(){
    let selected = $(this).val();
    if(selected =='500'){
        // $('#reason_custom_text_div').show();
        // $('#reason_custom_text').show();
        // $('#reason_custom_text').prop('disabled',false);
    }else{
            // $('#reason_custom_text_div').hide();
            // $('#reason_custom_text').hide();
            // $('#reason_custom_text').prop('disabled',true);
    }
});




$(document).ready(function() {
  $("#rejectedReasonForm").validate({
          rules: {
            selected_reason: {required: true},
            reason_custom_text: {required: true},
            opration: {required: true},
            reinitiate_payment_date: {required: true},
          },
          messages: {
            selected_reason: {required: "Please Select the Reason"},
            reason_custom_text: {required: "Please Enter the Remarks"},
            opration: {required: "Select the Opration"},
            reinitiate_payment_date: {required: "Select the Reinitiate Payment Date"},
          },
          errorClass: "help-inline text-danger",
          errorElement: "span",
          highlight: function(element, errorClass, validClass) {
              $(element).parents('.form-group').addClass('has-error');
          },
          unhighlight: function(element, errorClass, validClass) {
              $(element).parents('.form-group').removeClass('has-error');
              $(element).parents('.form-group').addClass('has-success');
          },
          submitHandler: function(form,e) {
              e.preventDefault();
              console.log('Form submitted');
              formsFilter.length = 0;
              formsFilter = [];
              var formData = $(form).serialize();

              $('#preloader').show();
                $.ajax({
                    url: APIURL + 'rejected_reason_file', // Replace with your API endpoint
                    method: 'POST', // Change the method to GET
                    headers: {
                        'X-APP-KEY': config.app_key,
                        'X-APP-NAME': config.app_name
                    },
                    data: {
                        data: formData
                    },
                    dataType: 'json',
                    success: function (response) {
                    $('#preloader').hide();
                    
                        if (response.success == 1) {
                            // output = response.data;
                            $('#preloader').hide();
                            Swal.fire({
                                icon: "success",
                                title: response.message,
                                showConfirmButton: false,
                                timer: 2000
                            });
                            
                            $('#formFilters').submit();
                            $('#preloader').hide();
                            $('.viewdatainfo').modal('hide');
                        } else if (response.success == 0) {
                            Swal.fire({
                                icon: "error",
                                title: response.message,
                                showConfirmButton: false,
                                timer: 2000
                            });
                            $('.viewdatainfo').modal('hide');
                        }
                    },
                    error: function () {
                    $('#preloader').hide();
                    Swal.fire({
                        icon: "error",
                        title: "Service Error!",
                        showConfirmButton: false,
                        timer: 2000
                    })
                    }
                });


                console.log('form date excuted', formData);

                //   window.localStorage.removeItem('filters');
                //   window.localStorage.setItem('filters', JSON.stringify(formData));
             

              return false;
          }
    });
});

window.getCurrentTabId = -1;
tabClickValue(1);

function tabClickValue(tabID){
  var dataFilters = window.localStorage.getItem('filters');
/* get value to inputs*/
  var input_schemCode = $('#ddl_scheme_code').val();
  var input_schemName = $('#ddl_scheme_name').val();
  var input_subScheme = $('#ddl_sub_scheme').val();
  var input_dep = $('#ddl_department').val();
  var input_subDep = $('#ddl_sub_department').val();
  var input_dateMonthYear = $('#dayWeekMonthFilter').val();
/* get value to inputs*/

  getCurrentTabId = tabID;
  
  if(tabID==1){
        $('#approvelpayment').val(1);
        if (input_schemCode !== '' && input_schemName !== '' && input_subScheme !== null && input_dep !== '' && input_subDep !== '' && input_dateMonthYear !== '') {
        get_payment_rejection(dataFilters,3);
        $('#tblCard').show();
        } else {
            $('#tblCard').hide();
        }

  }
}


let tableRecordCount = 0;




// payment rejection

function actionRejectionReason(schemeid,paymentMode,listID,fileName){
  $('#btn_name_change').hide();
  $("#rejectedReasonForm")[0].reset();
        var userDataString = getCookie('payment_official');
        userDataString = JSON.parse(userDataString);
        window.loginUser_id = userDataString['user_id'];

        // $('#reason_custom_text_div').hide();
        // $('#reason_custom_text').hide();
        // $('#reason_custom_text').prop('disabled',true);
        $('#list_id').val(listID);
        $('#scheme_id').val(schemeid);
        $('#popupuserid').val(loginUser_id);
        $('#paymentmodeid').val(paymentMode);
        $('#filename').val(fileName);




    // alert(listID);

  $('#preloader').show();
  $.ajax({
    url: APIURL + 'get_reason_code', // Replace with your API endpoint
    method: 'POST', // Change the method to GET
    headers: {
        'X-APP-KEY': config.app_key,
        'X-APP-NAME': config.app_name
    },
    data: {
        payment_mode_id: paymentMode
    },
    dataType: 'json',
    success: function (response) {
      $('#preloader').hide();
        if (response.success == 1) {
            output = response.data;
            // console.log(output);
            // var districtDropdown = $("#selected_reason");
            $('#selected_reason').empty();
            $('#selected_reason').append($('<option>', { value: "", text: "--Select--" }));

            $.each(output, function(index, item) {
            // console.log(item);
                
            $('<option>').val(item.reason_code).text(item.reason).appendTo('#selected_reason');
            });
            $('#selected_reason').append($('<option>', { value: "500", text: "others" }));

        } else if (response.success == 0) {
            Swal.fire({
                icon: "error",
                title: response.message,
                showConfirmButton: false,
                timer: 2000
            })
        }
    },
    error: function () {
      $('#preloader').hide();
      Swal.fire({
          icon: "error",
          title: "Service Error!",
          showConfirmButton: false,
          timer: 2000
      })
    }
  });
}

function get_payment_rejection(dataFilters,approveStatus){
  $('#tblPaymentRejectionList').DataTable().clear().destroy();
  $('#tblPaymentRejectionList').DataTable({
      // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      "pageLength": 30, 
      "footer": true,
      "dom": 'Bfrtip',
      "buttons": [
        {
              extend: 'csv',
              text: 'CSV',
              filename: 'Payment Rejected',
              exportOptions: {
                  rows: ':visible', // Export visible rows
                  modifier: {
                      selected: null // Export all rows, not just selected
                  }
              }
          },
          {
              extend: 'excel',
              text: 'Excel',
              filename: 'Payment Rejected' // Set custom filename for Excel
          },
          {
              extend: 'pdf',
              text: 'PDF',
              filename: 'Payment Rejected' // Set custom filename for PDF
          }],
      "searching": true,
      "processing": true,
      "serverSide": true,
      "ajax": {
          "url": APIURL + 'get_payment_rejection',
          "type": "POST",
          "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          "dataType": "JSON",
          "data": function (data) {
            data.fileters = dataFilters;
            data.approveStatus = approveStatus;
            data.user_id = loginUser_id;
          },
          "beforeSend": function () {
            $('#preloader').show(); // Show the preloader before sending the request
           },
          "error": function (xhr, error, thrown) {
              Swal.fire({
                  icon: "error",
                  title: 'Service Error !',
                  showConfirmButton: false,
                  timer: 2000
              });
          },
          "dataSrc": 'data',
      },
      "columns": [
          { "data": "S.No", render: function (data, type, row, meta) {
              return meta.row + meta.settings._iDisplayStart + 1;
              }
          },
          { "data": "file_name" },
          { "data": "approved_date" },
          { "data": "submitted_date" },
          { "data": "payment_date" },
          { "data": "payment_mode" },
          { "data": "records_in_file"},
          { "data": function (data, type, row, meta) {
          return `<a href="javascript:void(0);" class="badge text-bg-danger c-pointer" data-bs-toggle="modal" data-bs-target=".viewdatainfo" onclick="actionRejectionReason(${data.scheme_id},${data.payment_mode_id},${data.payment_request_file_id},'${data.file_name}')"><i class="bi bi-ban"></i>Reinitiate / Reject </a>`;
          }
      },
      
          // Add more columns as needed
          // Example: { "data": "complaint_raised_by" },
      ],
      "drawCallback": function (settings) {
          // Your drawCallback logic goes here
          // For example, updating dropdowns or other elements after the table is drawn
      },
      "initComplete": function (settings, json) {
        $('#preloader').hide(); // Hide the preloader after DataTable initialization
        tableRecordCount = json.recordsTotal;
    }
  });
}







function populateDropdown(dropdownId, data, fieldName) {
    const dropdown = document.getElementById(dropdownId);

    // Clear existing options
    //dropdown.innerHTML = '<option value="">--ALL--</option>';

    // Populate options from data
    data.forEach(item => {
      const option = document.createElement('option');
      option.value = item[fieldName + '_code'];
      option.textContent = item[fieldName + '_name'];
      dropdown.appendChild(option);
    });
  }

  


function tblPreloaderEnable(tableName){
      var processingDiv = document.getElementById(tableName+'_processing');
      var displayStatus = window.getComputedStyle(processingDiv).display;
      if (displayStatus === 'block') {
      $('#'+tableName+'_processing').html(`<div id="preloader"></div>`);
      } else {
        $('#'+tableName+'_processing').text(`<div id="preloader"></div>`);
      }
}

function _fnGetHeaders() {
    var dt = $('#uploadDataList').DataTable();
    var thRows = $('#uploadDataList thead tr');
    var numRows = thRows.length;
    var matrix = [];

    for (var rowIdx = 0; rowIdx < numRows; rowIdx++) {
        var $row = $(thRows[rowIdx]);

        var $ths = $row.find("th");
        var aRow = [];

        for (var colIdx = 0; colIdx < $ths.length; colIdx++) {
            var $th = $($ths.get(colIdx));
            aRow.push($th.text().trim());
        }

        matrix.push(aRow);
    }

    return matrix;
}

function htmlDecode(input) {
    var doc = new DOMParser().parseFromString(input, "text/html");
    return doc.documentElement.textContent;
}

$('#reinitiate_payment_date_div').hide();
$('#reinitiate_payment_date').prop('disabled',true);
$('#btn_name_change').hide();

$('#reject').on('click',function(){
  $('#btn_name_change').show();
  $('#reinitiate_payment_date_div').hide();
  $('#reinitiate_payment_date').prop('disabled',true);
  $('#btn_name_change').text('Reject');
});

$('#reinitiate').on('click',function(){
  $('#btn_name_change').show();
  $('#reinitiate_payment_date_div').show();
  $('#reinitiate_payment_date').prop('disabled',false);
  $('#btn_name_change').text('Reinitiate');
});


$('#reinitiate_payment_date').on('change', function() {
    var todayDate = new Date(); 
    todayDate.setDate(todayDate.getDate() - 1);
    var toDate = new Date($(this).val());
    if (toDate < todayDate) {
        alert('To Date should be a future date.');
        $(this).val('');
    }
    $('#reinitiate_payment_date_error').hide();
  });


</script>
</body>
</html>