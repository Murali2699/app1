<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Payment Automation Dashboard</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    <!-- Favicons -->
    <link href="assets/img/tn_logo.png" rel="icon">
    <link href="assets/img/tn_logo.png" rel="apple-touch-icon">
    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> -->
    <link rel="stylesheet" href="assets/vendor/sweetalert2/css/sweetalert.min.css" />
    <link rel="stylesheet" href="assets/vendor/sweetalert2/css/sweetalert2.min.css" />
    <!-- <link rel="stylesheet" href="assets/vendor/toggle/bootstrap-toggle.min.css" /> -->
    <!-- CSS File --> 
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css"> -->
    <script src="assets/components/official_header.js" type="text/javascript" defer></script>
  </head>
  <body>
    <!-- ======= Header & sidemenu ======= -->
    <official-header-component></official-header-component>
    <div id="preloader"></div>
    <!-- End Sidebar-->
    <main id="main" class="main">
      <!-- Dashboard view starts -->
      <section>
        <div class="container-fluid">
          <div class="card mb-1">
            <div class="card-body pb-0 pt-2">
              <div class="row mb-2 boxflex">
                <h5 class="card-title pb- mb-0"><i class="bi bi-funnel"></i>Apply Filter </h5>
                <div class="col-md">
                  <label for="ddl_scheme_cate" class="form-label fw-bold">Scheme Category</label>
                  <select class="form-select" id="ddl_scheme_cate" name="ddl_scheme_cate">
                    <option value="">--All--</option>
                  </select>
                </div>
                <div class="col-md">
                  <label for="ddl_scheme_code" class="form-label fw-bold">Scheme Code</label>
                  <select class="form-select" id="ddl_scheme_code" name="ddl_scheme_code">
                    <option value="">--All--</option>
                  </select>
                </div>
                <div class="col-md">
                  <label for="ddl_scheme_name" class="form-label fw-bold">Scheme Name</label>
                  <select class="form-select" id="ddl_scheme_name" name="ddl_scheme_name">
                    <option value="">--All--</option>
                  </select>
                </div>
                <div class="col-md">
                  <label for="ddl_sub_scheme" class="form-label fw-bold">Sub Scheme Name</label>
                  <select class="form-select" id="ddl_sub_scheme" name="ddl_sub_scheme">
                    <option value="">--All--</option>
                  </select>
                </div>
                <div class="col-md">
                  <label for="ddl_department" class="form-label fw-bold">Department</label>
                  <select class="form-select" id="ddl_department" name="ddl_department">
                    <option value="">--All--</option>
                  </select>
                </div>
                <div class="col-md">
                  <label for="ddl_sub_department" class="form-label fw-bold">Sub Department</label>
                  <select class="form-select" id="ddl_sub_department" name="ddl_sub_department">
                    <option value="">--All--</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <!-- END: Dropdown card end here -->
          <div class="card mb-2 mt-3">
            <div class="card-body">
              <div class="tab-content" id="myTabContent">
                
                  <div class="col-lg-12">
                    <div class="card1">
                      <div class="card-body1">
                        <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i>  Scheme List
                        </h5>
                        <div class="clear-both"></div>
                        <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                          <div class="table-responsive">
                            <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblSchemList" aria-describedby="tblSchemList_info">
                              <thead>
                                <tr>
                                  <!-- <th scope="col"><input class="form-check-input" type="checkbox" value="" ></th> -->
                                  <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblSchemList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblSchemList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme Category</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblSchemList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme Code</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblSchemList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Scheme Name</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblSchemList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Sub Scheme Name </th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblSchemList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Department</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblSchemList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Sub Department</th>
                                  <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblSchemList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Action  </th>
                                </tr>
                              </thead>
                              <tbody>
                                
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

              </div>
            </div>
          </div>
          <!-- END: list card end here -->
          <!-- START: modal popup -->
          <!-- Button trigger modal -->
        </div>
      </section>
    </main>
    <!-- End #main -->
    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div class="copyright">
        &copy; Copyright <strong><span>TNeGA</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        Designed & Developed by <a href="https://tngis.tn.gov.in/" target="_blank">TNeGA</a>
      </div>
    </footer>
    <!-- End Footer -->
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
    <!-- Delete modal starts -->
    <!-- view data starts -->
    <div class="modal fade viewdatainfo" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="bi bi-file-earmark-person"></i> Scheme Details</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body py-2">
            <div class="row scheme-data mb-2">
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Scheme Code</label>
                <label for="" class="form-label"><span id="txt_scheme_code"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Scheme Name</label>
                <label for="" class="form-label"><span id="txt_scheme_name"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Sub Scheme Name</label>
                <label for="" class="form-label"><span id="txt_sub_scheme_name"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Department</label>
                <label for="" class="form-label"><span id="txt_department"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Sub Department</label>
                <label for="" class="form-label"><span id="txt_sub_department"></span> </label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Payment Cycle</label>
                <label for="" class="form-label"><span id="txt_payment_cycle"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Installment</label>
                <label for="" class="form-label"><span id="txt_installment"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Payment Method</label>
                <label for="" class="form-label"><span id="txt_payment_method"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Budget Code</label>
                <label for="" class="form-label"><span id="txt_budget_code"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Account Head</label>
                <label for="" class="form-label"><span id="txt_account_head"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Nodal Bank</label>
                <label for="" class="form-label"><span id="txt_nodal_bank"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Nodal Bank IIN Number</label>
                <label for="" class="form-label"><span id="txt_nodal_bank_iin_no"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Nodal Bank User Number</label>
                <label for="" class="form-label"><span id="txt_nodal_bank_user_no"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Account Number</label>
                <label for="" class="form-label"><span id="txt_account_no"></span></label>
              </div>
              <div class="col-md-4">
                <label for="" class="form-label fw-bold">Branch Name</label>
                <label for="" class="form-label"><span id="txt_branch_name"></span></label>
              </div>
            </div>
            <div id="env_detials"></div>
            <hr>
            <div class="row p-3">
              <h5 class="card-title pb- mb-0"><i class="bi bi-plus-square"></i> Add Payment Period</h5>
              <div class="col">
                <form id="addPayment" method="post">
                <div class="row">
<!-- financial quarter -->
                  <div class="col" id="addedPaymentPeriod_div">
                    <label for="addedPaymentPeriod" class="form-label fw-bold">Payment Peroid</label>
                    <select name="addedPaymentPeriod" id="addedPaymentPeriod" class="form-select">
                      <option value="">--All--</option>
                    </select>
                  </div>
<!-- Calendar quarter -->
                  <div class="col" id="addedInstallment_div">
                    <label for="addedInstallment" class="form-label fw-bold">Add Installment</label>
                    <select name="addedInstallment" id="addedInstallment" class="form-select">
                      <option value="">--All--</option>
                    </select>
                  </div>
<!-- monthly -->
              <div class="col" id="monthly">
                <label for="monthly_list" class="form-label fw-bold">Add Payment Month</label>
                <select name="monthly_list" id="monthly_list" class="form-select">
                  <option value="">--All--</option>
                </select>
              </div>
<!-- yearly and Everyone-->
                  <div class="col">
                    <label for="year_list" class="form-label fw-bold">Add Payment Year</label>
                    <select name="year_list" id="year_list" class="form-select">
                      <option value="">--All--</option>
                    </select>
                  </div>
                  <div class="col">
                    <button class="btn btn-primary mt-4">Add</button>
                  </div>
                  <div class="col"></div>    
                </div>

                <input type="hidden" name="payment_cycle" id="payment_cycle_hidden">
                <input type="hidden" name="scheme_id" id="scheme_id_hidden">
                <input type="hidden" name="user_id" id="user_id_hidden">
                <input type="hidden" name="default_installment" id="default_installment_hidden">

              </form>
              </div>
              
            </div>

            <div class="col-lg-12">
              <div class="card1">
                <div class="card-body1">
                  <h5 class="card-title mt-3 mb-0"><i class="bi bi-check2-circle"></i>  Payment List
                  </h5>
                  <div class="clear-both"></div>
                  <div class="col-lg-12 mt-2 clear-both" style="    clear: both;">
                    <div class="table-responsive">
                      <table class="table" class="table table-striped w-100 no-footer dataTable mt-3" id="tblPaymentList" aria-describedby="tblPaymentList_info">
                        <thead>
                          <tr>
                            <th scope="col"  class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">S.No</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Payment Cycle</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Payment Period</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Installments</th>
                            <th scope="col" class="sorting sorting_asc" tabindex="0" aria-controls="tblPaymentList" rowspan="1" colspan="1" aria-label="S.No: activate to sort column descending" style="width: 37px;" aria-sort="ascending">Year-month</th>
                          </tr>
                        </thead>
                        <tbody>
                          
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>


            

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- view data ends -->
    <!-- view crop info ends -->
    <!-- Vendor JS Files -->
     <!-- Vendor JS Files -->
     <script src="assets/vendor/jquery/jquery.min.js"></script>
     <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
     <script src="assets/js/main.js"></script>
     <!-- <script src="assets/vendor/multiselect/js/multiselect.js"></script>
       -->

       <script type="text/javascript" src="assets/vendor/jquery-validate/js/jquery.validate.min.js"></script>
       <!-- data table -->
       <script src="assets/vendor/datatable/jquery.dataTables.min.js"></script>
       <script src="assets/vendor/datatable/dataTables.bootstrap5.min.js"></script>
       <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.js"></script>
       <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.bootstrap4.js"></script>
       <script src="assets/vendor/datatables-buttons/js/dataTables.buttons.min.js"></script>
       <script src="assets/vendor/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
       <script src="assets/vendor/datatables-buttons/js/jszip.min.js"></script>
       <script src="assets/vendor/datatables-buttons/js/pdfmake.min.js"></script>
       <script src="assets/vendor/datatables-buttons/js/vfs_fonts.js"></script>
       <script src="assets/vendor/datatables-buttons/js/buttons.html5.min.js"></script>
       <script src="assets/vendor/datatables-buttons/js/buttons.print.min.js"></script>
       <script src="assets/vendor/datatables-buttons/js/buttons.colVis.min.js"></script>
       <script src="assets/vendor/sweetalert2/js/sweetalert.min.js"></script>
       <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
       <script src="assets/vendor/toggle/bootstrap-toggle.min.js"></script>
       <script src="assets/js/global.js"></script>
       <script src="assets/js/alpinejs_3_10_2.min.js" defer></script>
       <script src="assets/lang/reports.js"></script>
       <script src='https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js'></script>
       <!-- data table -->


     <script src="assets/vendor/sweetalert2/js/sweetalert.min.js"></script>
     <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
     <script type="text/javascript" src="assets/vendor/toastr/toastr.min.js"></script>
     <!-- Main JS File -->
     <script src="assets/js/main.js"></script>
     <script src="assets/js/global.js"></script>
     <script src="assets/js/base64tojson.js"></script>
     <script src="assets/js/crypto-js.js"></script>
     <script src="assets/js/aes.js"></script>
      
     <!-- Crypto js -->
     <script src="assets/vendor/encryption/crypto-js.min.js"></script>
     <!-- Encryption js -->
     <script src="assets/vendor/encryption/Encryption.js"></script>
     
     <script type="text/javascript">
       const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
       const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
     </script>
 
 <script type="text/javascript">
     $(document).on({
            ajaxStart: function () {
              $('#preloader').show();
              console.log('preloader is show');
            },
            ajaxStop: function () {
              $('#preloader').hide();
              console.log('preloader is show');
            }
          });
   var url = window.location.href;
   var page_url = url.split('/');
   var page = page_url[4];
 
   var userDataString = getCookie('payment_official');
   userDataString = JSON.parse(userDataString);
   $(document).ready(function () {
     $('.official').each(function (i, obj) {
       var href = obj.getAttribute("href");
       if (href == page) {
         obj.classList.add('active');
       } else {
         obj.classList.remove('active');
       }
     });
     $('#preloader').hide();
     
     var userDataString = getCookie('payment_official');
     if (!userDataString) {
       $('#preloader').show();
       window.location.href = "login.html";
     }
 
     userDataString = JSON.parse(userDataString);
     $('#official_username').text(userDataString['first_name']);
     $('#UserID').val(userDataString['user_id']);
     window.loginUser_id = userDataString['user_id'];
     reloID = userDataString['role_id'];
    roleBasedPageAllow(loginUser_id,reloID);
    $('#user_id_hidden').val(loginUser_id);

    
     getSchemeCategory();

     $('#ddl_sub_scheme').on('change',function(){      
      $('#ddl_department').empty();
      $('#ddl_sub_department').empty();

      $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
      $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));

        $.ajax({
          url: APIURL +'schem_filter',
          type: "POST",
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: {case: "get_department",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),sub_scheme_name:$('#ddl_sub_scheme').val(),user_id:loginUser_id},
          success: function(response) {
              console.log("department:", response);
              var department_code = response.data[0];
              console.log(department_code.department);
              getDepartment(department_code.department);
          },
          error: function(xhr, status, error) {
              console.log("Error:", error);
          }
        });
     });
   });
 
   function getCookie(name) {
       const cookies = document.cookie.split(';');
       for (let i = 0; i < cookies.length; i++) {
         const cookie = cookies[i].trim();
         if (cookie.startsWith(name + '=')) {
           return cookie.substring(name.length + 1);
         }
       }
       return null;
     }

/* filters */
function getSchemeCategory(){
    
    $('#ddl_scheme_name').empty();
    $('#ddl_sub_scheme').empty();
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();
 
    $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
    $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
 
  $.ajax({
    url: APIURL +'schem_filter',
    type: "POST",
    headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
    data: {case: "get_scheme_category",get_column:"scheme_code",groupbycolumn:"scheme_code",user_id:loginUser_id},
    success: function(response) {
       //  console.log("Success:", response);
        var schemeCode = response.data;
       //  console.log('scheme code >>> ',schemeCode);
 
        $('#ddl_scheme_cate').empty();
        $('#ddl_scheme_cate').append($('<option>', {
              value: "",
              text: "--All--"
          }));

        $.each(schemeCode, function (index, scheme) {
            // console.log('scheem code lenthg >>> ', schemeCode.length);
            if(schemeCode.length >1){
              $('#ddl_scheme_cate').append($('<option>', {
                value: scheme.scheme_category,
                text: scheme.scheme_category
            }));
            }else{
              $('#ddl_scheme_cate').append($('<option>', {
                value: scheme.scheme_category,
                text: scheme.scheme_category
            }).prop('selected', true));
            $('#ddl_scheme_cate').trigger('change');
            }
         });
    },
    error: function(xhr, status, error) {
        console.log("Error:", error);
    }
  });
}


$('#ddl_scheme_cate').on('change',function(){
  
    $('#ddl_scheme_code').empty();
    $('#ddl_scheme_name').empty();
    $('#ddl_sub_scheme').empty();
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();

    $('#ddl_scheme_code').append($('<option>', {value: "", text: "--All--"}));
    $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
    $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
  
   $.ajax({
     url: APIURL +'schem_filter',
     type: "POST",
     headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
     data: {case: "get_scheme_code",get_column:"scheme_code",groupbycolumn:"scheme_code",whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
     success: function(response) {
        //  console.log("Success:", response);
         var schemeCode = response.data;
        //  console.log('scheme code >>> ',schemeCode);
  
         $('#ddl_scheme_code').empty();
         $('#ddl_scheme_code').append($('<option>', {
               value: "",
               text: "--All--"
           }));  

        $.each(schemeCode, function (index, scheme) {
            // console.log('scheem code lenthg >>> ', schemeCode.length);
            if(schemeCode.length >1){
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
            }));
            }else{
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
            }).prop('selected', true));

            $('#ddl_scheme_code').trigger('change');
            }
         });

         getSchemeList();
     },
     error: function(xhr, status, error) {
         console.log("Error:", error);
     }
   });

  
})


  $('#ddl_scheme_code').on('change',function(){

        $('#ddl_sub_scheme').empty();
        $('#ddl_scheme_name').empty();
        $('#ddl_sub_scheme').empty();
        $('#ddl_department').empty();
        $('#ddl_sub_department').empty();

        $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
        $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
        $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
        $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
        $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));


      $.ajax({
      url: APIURL +'schem_filter',
      type: "POST",
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: {case: "get_scheme",scheme_code:$('#ddl_scheme_code').val(),user_id:loginUser_id},
      success: function(response) {
          console.log("Success:", response);
          var schemeCode = response.data;
          console.log(schemeCode.scheme_code);
          $('#ddl_scheme_name').empty();
          $('#ddl_scheme_name').append($('<option>', {
                value: "",
                text: "--All--"
            }));
          // Iterate over the JSON object and append options
          // $.each(schemeCode, function (index, scheme) {
          //   $('#ddl_scheme_name').append($('<option>', {
          //       value: scheme.scheme_name,
          //       text: scheme.scheme_name
          //   }));
          // });


          $.each(schemeCode, function (index, scheme) {
            // console.log('scheem code lenthg >>> ', schemeCode.length);
            if(schemeCode.length >1){
              $('#ddl_scheme_name').append($('<option>', {
                value: scheme.scheme_name,
                text: scheme.scheme_name
            }));
            }else{
              $('#ddl_scheme_name').append($('<option>', {
                value: scheme.scheme_name,
                text: scheme.scheme_name
            }).prop('selected', true));
            
            $('#ddl_scheme_name').trigger('change');
            }
         });

         getSchemeList();

      },
      error: function(xhr, status, error) {
          console.log("Error:", error);
      }
    });

  });

  $('#ddl_scheme_name').on('change',function(){

    
      // $('#ddl_scheme_name').empty();
      $('#ddl_sub_scheme').empty();
      $('#ddl_department').empty();
      $('#ddl_sub_department').empty();

      
      // $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
      $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
      $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
      $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));



      $.ajax({
      url: APIURL +'schem_filter',
      type: "POST",
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: {case: "get_sub_scheme",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),user_id:loginUser_id},
      success: function(response) {
          console.log("Success:", response);
          var schemeCode = response.data;
          console.log(schemeCode.scheme_code);
          $('#ddl_sub_scheme').empty();
          $('#ddl_sub_scheme').append($('<option>', {
                value: "",
                text: "--All--"
            }));
          // Iterate over the JSON object and append options
          // $.each(schemeCode, function (index, scheme) {
          //   $('#ddl_sub_scheme').append($('<option>', {
          //       value: scheme.subscheme_name,
          //       text: scheme.subscheme_name
          //   }));
          // });
         
          $.each(schemeCode, function (index, scheme) {
            // console.log('scheem code lenthg >>> ', schemeCode.length);
            if(schemeCode.length >1){
              $('#ddl_sub_scheme').append($('<option>', {
                value: scheme.subscheme_name,
                text: scheme.subscheme_name
            }));
            }else{
              $('#ddl_sub_scheme').append($('<option>', {
                value: scheme.subscheme_name,
                text: scheme.subscheme_name
            }).prop('selected', true));
            
            $('#ddl_sub_scheme').trigger('change');
            }
         });
         
         getSchemeList();
      },
      error: function(xhr, status, error) {
          console.log("Error:", error);
      }
    });

  });

  // get_scheme


  /* filters */
  getSchemeList();

  function getSchemeList() {
    var userDataString = getCookie('payment_official');
    userDataString = JSON.parse(userDataString)
    var loginUser_id = userDataString['user_id'];


    let schemeCate = $('#ddl_scheme_cate').val();
    let schemeCode = $('#ddl_scheme_code').val();
    let schemeName = $('#ddl_scheme_name').val();
    let subScheme = $('#ddl_sub_scheme').val();
    let department = $('#ddl_department').val();
    let subDepartment = $('#ddl_sub_department').val();
    var getInput = [];

    var allFields = [
        {
            inputValue: schemeCate,
            case: 'filter_scheme_category',
        },
        {
            inputValue: schemeCode,
            case: 'filter_scheme_code',
        },
        {
            inputValue: schemeName,
            case: 'filter_scheme_name',
        },
        {
            inputValue: subScheme,
            case: 'filter_subscheme',
        },
        {
            inputValue: department,
            case: 'filter_deparment',
        },
        {
            inputValue: subDepartment,
            case: 'filter_sub_deparment',
        }
    ];

    allFields.forEach(input => {
        if (input.inputValue !== null && input.inputValue !== "" && input.inputValue !== undefined) {
            getInput.push(input); // Use push to add elements to the array
        }
    });
    console.log(getInput);




    $('#tblSchemList').DataTable().clear().destroy();
    $('#tblSchemList').DataTable({
        // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        "pageLength": 30, 
        "footer": true,
        "dom": 'Bfrtip',
        "buttons": [
          {
                extend: 'csv',
                text: 'CSV',
                filename: 'Scheme Lists',
                exportOptions: {
                    rows: ':visible', // Export visible rows
                    modifier: {
                        selected: null // Export all rows, not just selected
                    }
                }
            },
            {
                extend: 'excel',
                text: 'Excel',
                filename: 'Scheme Lists' // Set custom filename for Excel
            },
            {
                extend: 'pdf',
                text: 'PDF',
                filename: 'Scheme Lists' // Set custom filename for PDF
            }],
        "searching": true,
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": APIURL + 'scheme_list',
            "type": "POST",
            "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
            "dataType": "JSON",
            data: {
              fileters:getInput,
              user_id:loginUser_id
            },
            "beforeSend": function () {
            $('#preloader').show(); // Show the preloader before sending the request
            tblPreloaderEnable('tblSchemList');
            },
            "error": function (xhr, error, thrown) {
                Swal.fire({
                    icon: "error",
                    title: 'Service Error !',
                    showConfirmButton: false,
                    timer: 2000
                });
            },
            "dataSrc": 'data',
        },
        "columns": [
            { "data": "S.No", render: function (data, type, row, meta) {
                return meta.row + meta.settings._iDisplayStart + 1;
                }
            },
            { "data": "scheme_category" },
            { "data": "scheme_code" },
            { "data": "scheme_name" },
            { "data": "subscheme_name" },
            { "data": "department_name" },
            { "data": "sub_department_name"},
            { "data": "action" },
            // Add more columns as needed
            // Example: { "data": "complaint_raised_by" },
        ],
        "drawCallback": function (settings) {
            // Your drawCallback logic goes here
            // For example, updating dropdowns or other elements after the table is drawn
        },
        "initComplete": function () {
            // Hide the preloader after DataTable has been initialized
            $('#preloader').removeClass('d-block');
            // $('#preloader').hide();
        }
    });  
  }

    function viewScheme(id){

      $('#addPayment')[0].reset();
      
      var identifiers = [
        'scheme_code',
        'scheme_name',
        'sub_scheme_name',
        'department',
        'sub_department',
        'payment_cycle',
        'installment',
        'payment_method',
        'budget_code',
        'account_head',
        'nodal_bank',
        'nodal_bank_iin_no',
        'nodal_bank_user_no',
        'account_no',
        'branch_name'
      ];
      identifiers.forEach(function(identifier) {
        $('#txt_' + identifier).text('');
      });
      $('#payment_cycle_hidden').val('');
      // console.log('scheme id');
      // console.log(id);
      $('#scheme_id_hidden').val(id);
      getPaymentList(id,loginUser_id);
             $.ajax({
               url: APIURL+'getscheme', // Replace with your API endpoint
               method: 'POST',
               headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
               data: { schemeID: id ,user_id:loginUser_id},
               dataType: 'json',
               success: function (response) {
                var scheme = response.data.schemes[0];
                var scheme_env = response.data.scheme_env;
                   $('#txt_scheme_code').html(scheme.scheme_code);
                   $('#txt_scheme_name').html(scheme.scheme_name);
                   $('#txt_sub_scheme_name').html(scheme.subscheme_name);
                   $('#txt_department').html(scheme.department_name);
                   $('#txt_sub_department').html(scheme.sub_department_name);
                   $('#txt_payment_cycle').html(scheme.payment_cycle_text);
                   $('#txt_installment').html(scheme.installments_text);
                   $('#txt_payment_method').html(scheme.payment_method_text);
                   $('#txt_budget_code').html(scheme.budget_code);
                   $('#txt_account_head').html(scheme.account_head);
                   $('#txt_nodal_bank').html(scheme.nodal_bank_name);
                   $('#txt_nodal_bank_iin_no').html(scheme.nodal_bank_iin_no);
                   $('#txt_nodal_bank_user_no').html(scheme.nodal_bank_usernumber);
                   $('#txt_account_no').html(scheme.nodal_bank_account_no);
                   $('#txt_branch_name').html(scheme.nodal_bank_branch_name);

                   $('#payment_cycle_hidden').val(scheme.payment_cycle);
                   var env_card='';
                   scheme_env.forEach(env => {
                    if(env.environment == 0){
                      var cardDiv = `<div class="card mt-3 alert alert-info p-2">`;
                      var cardTitle =  ` UAT FTP Config`;
                    }else if(env.environment == 1){
                      var cardDiv = `<div class="card mt-3 alert alert-success p-2">`;
                      var cardTitle =  ` Production FTP Config`;

                    }
                     env_card += cardDiv+`<h5 class="card-title pb- mb-0"><i class="bi bi-check2-circle"></i>`+cardTitle+`</h5>
              <div class="row scheme-data mb-2">
                <div class="col-md-4">
                  <label for="" class="form-label fw-bold">FTP Host</label>
                  <label for="" class="form-label">`+env.ftp_host+`</label>
                </div>
                <div class="col-md-4">
                  <label for="" class="form-label fw-bold">FTP Port</label>
                  <label for="" class="form-label">`+env.ftp_host+`</label>
                </div>
                <div class="col-md-4">
                  <label for="" class="form-label fw-bold">FTP User Name</label>
                  <label for="" class="form-label">`+env.ftp_username+`</label>
                </div>
                <div class="col-md-4">
                  <label for="" class="form-label fw-bold">Password</label>
                  <label for="" class="form-label">`+env.ftp_password+`</label>
                </div>
                <div class="col-md-4">
                  <label for="" class="form-label fw-bold">FTP Request File Path</label>
                  <label for="" class="form-label">`+env.ftp_request_file_path+`</label>
                </div>
                <div class="col-md-4">
                  <label for="" class="form-label fw-bold">FTP Response File Path</label>
                  <label for="" class="form-label">`+env.ftp_response_file_path+`</label>
                </div>
                <div class="col-md-4">
                  <label for="" class="form-label fw-bold">FTP Response Acknowledgement File Path</label>
                  <label for="" class="form-label">`+env.ftp_response_ack_file_path+`</label>
                </div>
                <div class="col-md-4">
                  <label for="" class="form-label fw-bold">FTP Response Full Complete Path</label>
                  <label for="" class="form-label">`+env.sftp_response_fc_file_path+`</label>
                </div>
              </div>
            </div>`;
                   });
                   $('#env_detials').html(env_card);

                  //scheme.payment_cycle = 2;//texting

                  // if(scheme.payment_cycle!=1 && scheme.payment_cycle!=5){
                  if(scheme.payment_cycle!=1){
                    $('#addedPaymentPeriod_div').show();
                        let showdropDown = fetchDropdownValues('Payment Cycle');
                      showdropDown.then(function(arrayValue) {
                      let filteredItems = arrayValue.filter(item => [scheme.payment_cycle].includes(item.id));
                      let textValues = filteredItems.map(item => item.display_text);
                      
                      // console.log('textValues >> ', textValues);

                        // bindDropDownList('Financiay - Quaterly','#addedPaymentPeriod');//testing
                        bindDropDownList(textValues,'#addedPaymentPeriod');

                      }).catch(function(error) {
                        console.error('Error occurred:', error);
                      });
                  }else{
                    $('#addedPaymentPeriod_div').hide();
                  }
                  


                  let installment = fetchDropdownValues('Installment');
                    installment.then(function(arrayValue) {

                        let filteredItems = arrayValue.filter(item => [scheme.installments].includes(item.id));
                        let textValues = filteredItems.map(item => item.display_text);
                        // textValues = '4';
                      if(textValues !='1'){
                        let grounList = [];
                        
                        arrayValue.forEach(element => {
                          if(textValues>=element.display_text){
                            grounList.push(element.id);
                          }
                        });

                        let instamentList = arrayValue.filter(item => grounList.includes(item.id));
                        // console.log('grounList >>', instamentList);
                        $('#addedInstallment').empty();
                        $('#addedInstallment').append($('<option>', { value: "",text: "--Select Installment--"}));
    
                        instamentList.forEach(list => {                   
                          $('#addedInstallment').append($('<option>', {
                            value: list.value,
                            text: list.display_text
                          }));
                        });

                      }else{
                        $('#addedInstallment_div').hide();
                      }
                      $('#preloader').hide();

                    }).catch(function(error) {
                      $('#preloader').hide();
                    console.error('Error occurred:', error);
                    });

                    console.log('payment cycle', scheme.installments);
                    console.log(typeof scheme.installments);


                    // if(scheme.installments == 7){
                    //   $('#default_installment_hidden').val(scheme.installments);
                    // }else{
                    //   $('#default_installment_hidden').val(0);
                    // }

                    if(scheme.installments == 6){
                      $('#default_installment_hidden').val(scheme.installments);
                    }else{
                      $('#default_installment_hidden').val(0);
                    }

               },
               error: function () {
                 Swal.fire({
                   icon: "error",
                   title: "Service Error!",
                   showConfirmButton: false,
                   timer: 2000
                 })
               }
             });
    }


function getDepartment(depID){
      $('#ddl_department').empty();
      $('#ddl_sub_department').empty();

      $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
      $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
        
  $.ajax({
      url: APIURL +'get_department',
      type: "POST",
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: {type: "department"},
      success: function(response) {
          // console.log("Success:",JSON.parse(response)[0].data );
          var department = response[0].data;
          // Handle the successful response here
          $('#ddl_department').empty();
          $('#ddl_department').append($('<option>', {
                value: "",
                text: "--All--"
            }));
          // Iterate over the JSON object and append options
          $.each(department, function (index, dep) {
            if(dep.department_code==depID){
              $('#ddl_department').append($('<option>', {
                value: dep.department_code,
                text: dep.department_name
              }).attr('selected', 'selected'));
              // $('#ddl_department').trigger('change');

              $.ajax({
                    url: APIURL +'schem_filter',
                    type: "POST",
                    headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
                    data: {case: "get_sub_department",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),sub_scheme_name:$('#ddl_sub_scheme').val(),department:$('#ddl_department').val(),user_id:loginUser_id},
                    success: function(response) {
                        console.log("department:", response);
                        var subdepartment_code = response.data[0];
                        console.log(subdepartment_code.department);
                        get_sub_department(dep.department_code,subdepartment_code.subdepartment);
                    },
                    error: function(xhr, status, error) {
                        console.log("Error:", error);
                    }
                });
              
            }
          });
      },
      error: function(xhr, status, error) {
          console.log("Error:", error);
          // Handle the error here
      }
    });
}


  // $('#ddl_department').on('change',function(){
    function get_sub_department(depID,subDepID){
      $('#ddl_sub_department').empty();
      $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));

        // var department = $('#ddl_department').val();
        $.ajax({
        url: APIURL +'get_department',
        type: "POST",
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: {type: "sub_department",department_code:depID},
        success: function(response) {
            // console.log("Success:",JSON.parse(response)[0].data );
            var department = response[0].data;
            // Handle the successful response here
            $('#ddl_sub_department').empty();
            $('#ddl_sub_department').append($('<option>', {
                  value: "",
                  text: "--All--"
              }));
            // Iterate over the JSON object and append options
            $.each(department, function (index, sub_dep) {
              if(sub_dep.sub_department_code==subDepID){
                $('#ddl_sub_department').append($('<option>', {
                  value: sub_dep.sub_department_code,
                  text: sub_dep.sub_department_name
              }).attr('selected', 'selected'));
              }
            });
        },
        error: function(xhr, status, error) {
            console.log("Error:", error);
            // Handle the error here
        }
      });
    }
  // });

  function tblPreloaderEnable(tableName){
      var processingDiv = document.getElementById(tableName+'_processing');
      var displayStatus = window.getComputedStyle(processingDiv).display;
      if (displayStatus === 'block') {
      $('#'+tableName+'_processing').html(`<div id="preloader"></div>`);
      } else {
        $('#'+tableName+'_processing').text(`<div id="preloader"></div>`);
      }
}
getyearList();
function getyearList(){
  const currentYear = new Date().getFullYear();
  const yearSelect = document.getElementById('year_list');
  for (let year = currentYear; year >= currentYear - 1; year--) {
  const option = document.createElement('option');
    option.value = year;
    option.text = year;
    yearSelect.appendChild(option);
  }
}




  function bindDropDownList(type,element){
  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  window.loginUser_id = userDataString['user_id'];

      if (typeof type === 'object') {
        type = type[0];
      }

    $.ajax({
      url: APIURL +'fn_general_getdropdownvalues',
      type: "POST",
      headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: {user_id: loginUser_id,dropdown_type:type},
      success: function(response) {
        console.log(response.data);
       
          var dropdownList = response.data;
          $(element).empty();
          $(element).append($('<option>', {
                value: "",
                text: "Select "+type
            }));
          // Iterate over the JSON object and append options
          $.each(dropdownList, function (index, dep) {
            $(element).append($('<option>', {
                value: dep.id,
                text: dep.display_text
            }));
          });
        

      },
      error: function(xhr, status, error) {
        $('#preloader').hide();
          console.log("Error:", error);
          // Handle the error here
      }
    });
  }

  
  


  async function dropDownList(type) {
    try {
        var userDataString = getCookie('payment_official');
        userDataString = JSON.parse(userDataString);
        window.loginUser_id = userDataString['user_id'];

        const response = await $.ajax({
            url: APIURL + 'fn_general_getdropdownvalues',
            type: "POST",
            headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
            data: { user_id: loginUser_id, dropdown_type: type }
        });

        // console.log(response.data);
        return response.data;
    } catch (error) {
        console.error("Error:", error);
        throw error;
    }
}

async function fetchDropdownValues(type) {
    try {
        let getDropDown = await dropDownList(type);
        // console.log(`type >>`, getDropDown);
        return getDropDown;
    } catch (error) {
        console.error('Error occurred:', error);
    }
}

generateMonthList();

function generateMonthList() {

    let currentDate = new Date();
    let monthNames = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];
    let currentMonth = currentDate.getMonth() + 1;
    let selectElement = document.getElementById("monthly_list");

    for (let i = 0; i < 12; i++) {
        let monthValue = (i + 1).toString().padStart(2, '0'); 
        let option = document.createElement("option");
        option.value = monthValue;
        option.text = monthNames[i];
        
        if (i + 1 === currentMonth) {
            option.selected = true;
        }

        selectElement.appendChild(option);
    }
    // document.body.appendChild(selectElement);
}



function getPaymentList(schemeid,userId){
    $('#tblPaymentList').DataTable().clear().destroy();
    $('#tblPaymentList').DataTable({
        // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        "pageLength": -1, 
        "footer": true,
        "dom": 'Bfrtip',
        "buttons": [
          {
                extend: 'csv',
                text: 'CSV',
                filename: 'Scheme Lists',
                exportOptions: {
                    rows: ':visible', // Export visible rows
                    modifier: {
                        selected: null // Export all rows, not just selected
                    }
                }
            },
            {
                extend: 'excel',
                text: 'Excel',
                filename: 'Scheme Lists' // Set custom filename for Excel
            },
            {
                extend: 'pdf',
                text: 'PDF',
                filename: 'Scheme Lists' // Set custom filename for PDF
            }],
        "searching": true,
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": APIURL + 'get_scheme_wise_payment_period_list',
            "type": "POST",
            "headers": { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
            "dataType": "JSON",
            data: {
              scheme_id:schemeid,
              user_id:userId
            },
            "beforeSend": function () {
            $('#preloader').show(); // Show the preloader before sending the request
            tblPreloaderEnable('tblPaymentList');
            },
            "error": function (xhr, error, thrown) {
                Swal.fire({
                    icon: "error",
                    title: 'Service Error !',
                    showConfirmButton: false,
                    timer: 2000
                });
            },
            "dataSrc": 'data',
        },
        "columns": [
            { "data": "S.No", render: function (data, type, row, meta) {
                return meta.row + meta.settings._iDisplayStart + 1;
                }
            },
            { "data": "payment_cycle_text" },
            { "data": "payment_period_text" },
            { "data": "installments" },
            { "data": "yyyymm" },
            // { "data": "department_name" },
            // { "data": "sub_department_name"},
            // { "data": "action" },
            // Add more columns as needed
            // Example: { "data": "complaint_raised_by" },
        ],
        "drawCallback": function (settings) {
            // Your drawCallback logic goes here
            // For example, updating dropdowns or other elements after the table is drawn
        },
        "initComplete": function () {
            // Hide the preloader after DataTable has been initialized
            $('#preloader').removeClass('d-block');
            // $('#preloader').hide();
        }
    });
}


$("#addPayment").validate({
        rules: {
            addedPaymentPeriod:{required: true},
            addedInstallment:{required: true},
            monthly_list:{required: true},
            year_list:{required: true},
        },
        messages: {
          addedPaymentPeriod:{required: "Select the Payment Peroid"},
          addedInstallment:{required: "Select the Installment"},
          monthly_list:{required: "Select the Month"},
          year_list:{required: "Select the Year"},
        },
        errorClass: "help-inline text-danger",
        errorElement: "span",
        highlight: function(element, errorClass, validClass) {
            $(element).parents('.form-group').addClass('has-error');
        },
        unhighlight: function(element, errorClass, validClass) {
            $(element).parents('.form-group').removeClass('has-error');
            $(element).parents('.form-group').addClass('has-success');
        },
        submitHandler: function(form,e) {
            e.preventDefault();
            console.log('Form submitted');
            $.ajax({
                type: 'POST',
                headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
                url: APIURL +'add_payment_period',
                dataType: "html",
                data: $('form').serialize(),
                success: function(response) {
                   var result = JSON.parse(response);
                    if(result.success==1){
                      console.log('success');
                      console.log(result);
                      Swal.fire({
                        icon: "success",
                        title: result.message,
                        showConfirmButton: false,
                        timer: 2000
                      });

                      
                      let user_id = $('#user_id_hidden').val();
                      let scheme_id = $('#scheme_id_hidden').val();
                      
                      getPaymentList(scheme_id,user_id);
                    }else{
                      console.log('Error');
                      console.log(result);
                      Swal.fire({
                        icon: "info",
                        title: result[0].message.replace('ERROR:', ""),
                        showConfirmButton: false,
                        timer: 2000
                      });
                    }
                },
                error : function(error) {
                  console.log('error log', error);
                  Swal.fire({
                        icon: "error",
                        title: error.message,
                        showConfirmButton: false,
                        timer: 2000
                      })
                }
            });
            return false;
        }
  });



 </script>
   </body>
 </html>