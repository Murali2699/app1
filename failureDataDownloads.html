<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Payment Automation Dashboard</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    
    <link href="assets/img/tn_logo.png" rel="icon">
    <link href="assets/img/tn_logo.png" rel="apple-touch-icon">
    <link href="https:
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
     
    <link href="assets/css/style.css" rel="stylesheet">
    <official-header-component></official-header-component>
    <div id="preloader"></div>  
    <main id="main" class="main">
      
      <section>
        <div class="container-fluid">
          <div class="card mb-1">
            <form id="formFilters" method="post">
              <div class="card-body pb-0 pt-2">
                 <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                       <h2 class="accordion-header">
                          <button id="btnfilter" style="    background: linear-gradient(to right, rgb(44 43 88), rgb(34 25 111)) !important;
                             color: #fff !important;" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                          <i class="bi bi-funnel"></i>  <span class="px-2">Apply Filter</span>
                          </button>
                       </h2>
                       <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                          <div class="accordion-body w-100">
                             <div class="row mb-2 boxflex">
                                <div class="col-md-3">
                                   <label for="ddl_scheme_cate" class="form-label fw-bold">Scheme category</label>
                                   <select class="form-select" id="ddl_scheme_cate" name="ddl_scheme_cate">
                                      <option value="">--All--</option>
                                   </select>
                                </div>
                                   <label for="ddl_scheme_code" class="form-label fw-bold">Scheme Code</label>
                                   <select class="form-select" id="ddl_scheme_code" name="ddl_scheme_code"><option value="">--All--</option></select>
                                   <label for="ddl_scheme_name" class="form-label fw-bold">Scheme Name</label>
                                   <select class="form-select" id="ddl_scheme_name" name="ddl_scheme_name">
                                   <label for="ddl_sub_scheme" class="form-label fw-bold">Sub Scheme Name</label>
                                   <select class="form-select" id="ddl_sub_scheme" name="ddl_sub_scheme">
                                   <label for="ddl_department" class="form-label fw-bold mt-3">Department</label>
                                   <select class="form-select" id="ddl_department" name="ddl_department">
                                   <label for="ddl_sub_department" class="form-label fw-bold mt-3">Sub Department</label>
                                   <select class="form-select" id="ddl_sub_department" name="ddl_sub_department">
                             </div>
                             <hr>
                              <div class="row mb-2 boxflex">

                                <div class="col-md" id="ddl_payment_cycle_col">
                                  <label for="from_date" class="form-label fw-bold mt-3">Payment Cycle</label>
                                  <p id="ddl_payment_cycle">Scheme Based Payment Period</p>
                                <div class="col-md" id="ddl_payment_period_col">
                                  <label for="from_date" class="form-label fw-bold">Select Payment Period</label>
                                  <select name="ddl_payment_period" id="ddl_payment_period" class="form-select">
                                    <option value="" disabled selected>Select Payment Period</option>
                                  </select>
                                <div class="col-md" id="ddl_payment_installment_col">
                                  <label for="from_date" class="form-label fw-bold">Select Installment</label>
                                  <select name="ddl_payment_installment" id="ddl_payment_installment" class="form-select">
                                    <option value="" disabled selected>Select Installment</option>
                                <div class="col-md" id="ddl_year_col">
                                  <label for="to_date" class="form-label fw-bold">Select Year - Month</label>
                                  <select name="ddl_year" id="ddl_year" class="form-select" data-live-search="true">
                                    <option value="" disabled selected>Select Year and month</option>
                              </div>
                              <div class="col">
                                <label for="label_payment_date" class="form-label fw-bold">Select Payment Date</label>
                                
                                <select name="label_payment_date" id="label_payment_date" class="form-select  mb-2">
                                  <option value="">--All--</option>
                                </select>
                                <input type="hidden" name="approvelpayment" id="approvelpayment">
                            
                            <div class="row mb-2 boxflex">
                              <button class="btn btn-success float-end cbtn col-md-4" style="max-width: 280px;" id="emoDownloadBtn" type="button"><i class="bi bi-download"></i>&nbsp;EMO Download</button>
                                <button class="btn btn-success float-end cbtn col-md-4" style="max-width: 280px;" id="paymentFailureReportBtn" type="button"><i class="bi bi-download"></i>&nbsp;Payment Failed Details Download</button>
                                <button class="btn btn-success float-end cbtn col-md-4" style="max-width: 280px;" id="validationFailureReportBtn"   type="button"><i class="bi bi-download"></i>&nbsp;Validation Error Details Download</button>
                                <span id="alrt" class="row mb-2 boxflex text-danger"></span>
                            </div>
                          </div>
                        
                    </div>
                 </div>
              </div>
              <input type="hidden" name="current_tab_value" id="current_tab_value" value="0">
              <input type="hidden" name="approvelpayment" id="approvelpayment">
              <input type="hidden" name="payment_date_input" id="payment_date_input">
              <input type="hidden" name="payment_cycle_hidden" id="payment_cycle_hidden">
              <input type="hidden" name="installment_txt_value" id="installment_txt_value">
              
           </form>
          </div>
          
        
        </div>
      </div>
      </section>
    </main>
    <footer id="footer" class="footer">
      <div class="copyright">
        &copy; Copyright <strong><span>TNeGA</span></strong>. All Rights Reserved
      <div class="credits">
        Designed & Developed by <a href="https:
    </footer>
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script type="text/javascript" src="assets/vendor/jquery-validate/js/jquery.validate.min.js"></script>
    <script src="assets/js/global.js"></script>
    <script src="assets/js/base64tojson.js"></script>
    <script src="assets/js/crypto-js.js"></script>
    <script src="assets/js/aes.js"></script>
  
    <script src="assets/vendor/datatable/jquery.dataTables.min.js"></script>
    <script src="assets/vendor/datatable/dataTables.bootstrap5.min.js"></script>
    <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.js"></script>
    <script type="text/javascript" src="assets/vendor/datatable/js/dataTables.bootstrap4.js"></script>
    <script type="text/javascript" src="assets/vendor/toastr/toastr.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/jszip.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/pdfmake.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/vfs_fonts.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="assets/vendor/datatables-buttons/js/buttons.colVis.min.js"></script>
    <script src="assets/scripts/xlsx.full.min.js"></script>
    <script src="assets/scripts/jspdf.umd.min.js"></script>
    <script src="assets/vendor/encryption/crypto-js.min.js"></script>
    <script src="assets/vendor/encryption/Encryption.js"></script>
    <script src="assets/vendor/sweetalert2/js/sweetalert2.all.min.js"></script>
    <script src="https:
    <script src='https:
    <script type="text/javascript">
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    </script>
 
 <script type="text/javascript">
  var url = window.location.href;
  var page_url = url.split('/');
  var page = page_url[4];
  var userDataString = getCookie('payment_official');
  userDataString = JSON.parse(userDataString);
  jQuery.noConflict();
  jQuery(document).ready(function () {
    $(document).on({
           ajaxStart: function () {
             $('#preloader').show();
            
           },
           ajaxStop: function () {
             $('#preloader').hide();
           }
         });
    $('.official').each(function (i, obj) {
      var href = obj.getAttribute("href");
      if (href == page) {
        obj.classList.add('active');
      } else {
        obj.classList.remove('active');
      }
    });
    var userDataString = getCookie('payment_official');
    if (!userDataString) {
      $('#preloader').show();
      window.location.href = "login.html";
    }
    userDataString = JSON.parse(userDataString);
    $('#official_username').text(userDataString['first_name']);
    $('#UserID').val(userDataString['user_id']);
    window.loginUser_id = userDataString['user_id'];
    reloID = userDataString['role_id'];
    roleBasedPageAllow(loginUser_id,reloID);
    getSchemeCategory();
    $('#ddl_sub_scheme').on('change',function(){      
     $('#ddl_department').empty();
     $('#ddl_sub_department').empty();
     $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
     $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
       $.ajax({
         url: APIURL +'schem_filter',
         type: "POST",
         headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
         data: {case: "get_department",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),sub_scheme_name:$('#ddl_sub_scheme').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
         success: function(response) {
             var department_code = response.data[0];
             getDepartment(department_code.department);
         },
         error: function(xhr, status, error) {
             console.log("Error:", error);
         }
       });
    $('#ddl_scheme_cate').on('change', function () {
      $('#ddl_scheme_code').empty();
      $('#ddl_scheme_code').append('<option value="">--All--</option>');
    }); 
    $('#emoDownloadBtn').on('click',function(){
      getEmoMarkedBeneficiaryDetails();
      $("#formFilters").submit();
    })
  $('#paymentFailureReportBtn').on('click',function () {
    paymentFailedReport();
    $("#formFilters").submit();
  });
  $('#validationFailureReportBtn').on('click',function () {
    validationFailedReport();
});
function exportJsonToExcel(jsonData, file_name) {
  var data = jsonData.map(obj => Object.values(obj));
  var ws = XLSX.utils.aoa_to_sheet([Object.keys(jsonData[0])].concat(data));
  var wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
  var binaryData = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'binary' });
  var blob = new Blob([s2ab(binaryData)], { type: 'application/octet-stream' });
  saveAs(blob, file_name + '.xlsx');
  $('#preloader').hide();
}
function s2ab(s) {
  var buf = new ArrayBuffer(s.length);
  var view = new Uint8Array(buf);
  for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
  return buf;
function convertJsonToCsv(jsonData,filename) {
    let columns = Object.keys(jsonData[0]);
    let csvContent = [
        columns.join(','), 
        ...jsonData.map(obj => columns.map(col => obj[col]).join(',')) 
    ].join('\n');
    let blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    let link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.setAttribute('download', filename+'.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    $('#preloader').hide();
function getEmoMarkedBeneficiaryDetails(){
    var loginUser_id = userDataString['user_id'];
    $.ajax({
        url: APIURL + 'getEmo_Marked_beneficiary_details',
        type: 'POST',
        headers: {'X-APP-KEY': config.app_key,'X-APP-NAME': config.app_name},
        dataType: 'JSON',
        data: {
            schmecate: $('#ddl_scheme_cate').val(),
            schemeCode: $('#ddl_scheme_code').val(),
            schemeName: $('#ddl_scheme_name').val(),
            subSchemeName: $('#ddl_sub_scheme').val(),
            department: $('#ddl_department').val(),
            subDepartment: $('#ddl_sub_department').val(),
            paymentCycle: $('#ddl_payment_cycle').val(),
            paymentPeriod: $('#ddl_payment_period').val(),
            paymentInstall: $('#ddl_payment_installment').val(),
            yyyymm: $('#ddl_year').val(),
            paymentdate: $('#label_payment_date').val(),
            userId: loginUser_id,
        },
        success: function(res) {
            console.log('Download EMO Marked Beneficiary Details:', res);
            if(res.success){
                if (res.data && res.data.length > 0) {
                  exportJsonToExcel(res.data, $('#ddl_scheme_name').val() + '_' + $('#ddl_year').val() + '_Emo Marked Beneficiary details('+$('#label_payment_date').val()+')');
                } else {
                    console.log("No data available.");
                    Swal.fire({
                        icon: "info",
                        title: 'No Data Found',
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            } else {
                Swal.fire({
                    icon: 'info',
                    title: res.message,
                    
                    showConfirmButton: false,
                    timer: 2000
                })
            }
        error: function(xhr, status, error) {
            console.error("AJAX Error:", error);
            Swal.fire({
                icon: "info",
                title: 'Choose the scheme Category!',
                showConfirmButton: false,
                timer: 2000
            });
        }
function paymentFailedReport() {
    if($('#label_payment_date').val() =="")
    {
      return;
        url: APIURL + 'payment_failure_report',
        headers: {
            'X-APP-KEY': config.app_key,
            'X-APP-NAME': config.app_name
            console.log('payment failure report data:', res);
                  exportJsonToExcel(res.data, $('#ddl_scheme_name').val() + '_' + $('#ddl_year').val() + '_payment failed details('+$('#label_payment_date').val()+')');
function validationFailedReport() {
        url: APIURL + 'validation_failure_report',
            console.log('Validation failure report data:', res);
                  exportJsonToExcel(res.data, $('#ddl_scheme_name').val() + '_' + $('#ddl_year').val() + '_validation failed details('+$('#label_payment_date').val()+')');
                
                title: 'Choose the scheme category',
 function getCookie(name) {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + '=')) {
          return cookie.substring(name.length + 1);
      return null;
function getSchemeCategory(){
    $('#ddl_scheme_name').empty();
    $('#ddl_sub_scheme').empty();
    $('#ddl_department').empty();
    $('#ddl_sub_department').empty();
    $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
    $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
    $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
  $.ajax({
    url: APIURL +'schem_filter',
    type: "POST",
    headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
    data: {case: "get_scheme_category",get_column:"scheme_code",groupbycolumn:"scheme_code",user_id:loginUser_id},
    success: function(response) {
       
        var schemeCode = response.data;
        $('#ddl_scheme_cate').empty();
        $('#ddl_scheme_cate').append($('<option>', {
              value: "",
              text: "--All--"
          }));
        $.each(schemeCode, function (index, scheme) {
            if(schemeCode.length >1){
              $('#ddl_scheme_cate').append($('<option>', {
                value: scheme.scheme_category,
                text: scheme.scheme_category
            }));
            }else{
            }).prop('selected', true));
            $('#ddl_scheme_cate').trigger('change');
    },
    error: function(xhr, status, error) {
        console.log("Error:", error);
let booleanSet = false;
$('#ddl_scheme_cate').on('change',function(){
  resetYearMonth();
  let scheme_cate = $(this).val();
  labelPaymentMonthEmpty();
  if(scheme_cate ==''|| scheme_cate==null||scheme_cate==undefined){
    $('#ddl_year').empty();
    $('#ddl_payment_period').empty();
    $('#ddl_payment_installment').empty();
    $('#ddl_payment_cycle').text('Scheme Based Payment Period');
    $('#ddl_year').append($('<option>', {
          value: "",
          text: "Select Year - Month"
      }).attr('disabled','true').attr('selected', 'selected'));
      $('#ddl_payment_installment').append($('<option>', {
          text: "Select Installment"
      $('#ddl_payment_period').append($('<option>', {
          text: "Select the Payment Period"
  }
  $('#payment_date_input').val('');
    let select_scheme_cate = $(this).val();
      if(select_scheme_cate!='' && select_scheme_cate!=null){
        booleanSet = true;
      }else{
       booleanSet = false;
    $('#ddl_scheme_code').empty();
    $('#ddl_scheme_code').append($('<option>', {value: "", text: "--All--"}));
   $.ajax({
     url: APIURL +'schem_filter',
     type: "POST",
     headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
     data: {case: "get_scheme_code",get_column:"scheme_code",groupbycolumn:"scheme_code",whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
     success: function(response) {
         var schemeCode = response.data;
         $('#ddl_scheme_code').empty();
         $('#ddl_scheme_code').append($('<option>', {
               value: "",
               text: "--All--"
           }));  
              $('#ddl_scheme_code').append($('<option>', {
                value: scheme.scheme_code,
                text: scheme.scheme_code
         $('#ddl_scheme_code').trigger('change');
     },
     error: function(xhr, status, error) {
         console.log("Error:", error);
     }
   });
})
  $('#ddl_scheme_code').on('change',function(){
    labelPaymentMonthEmpty();
    resetYearMonth();
       $('#ddl_sub_scheme').empty();
       $('#ddl_scheme_name').empty();
       $('#ddl_department').empty();
       $('#ddl_sub_department').empty();
       $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
       $('#ddl_scheme_name').append($('<option>', {value: "", text: "--All--"}));
       $('#ddl_department').append($('<option>', {value: "",text: "--All--"}));
       $('#ddl_sub_department').append($('<option>', {value: "",text: "--All--"}));
     $.ajax({
     data: {case: "get_scheme",scheme_code:$('#ddl_scheme_code').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
         $('#ddl_scheme_name').empty();
         $('#ddl_scheme_name').append($('<option>', {
           }));
         
         $.each(schemeCode, function (index, scheme) {
          if(schemeCode.length >1){
            $('#ddl_scheme_name').append($('<option>', {
               value: scheme.scheme_name,
               text: scheme.scheme_name
          }else{
           }).prop('selected', true));
          }
         $('#ddl_scheme_name').trigger('change');
  $('#ddl_scheme_name').on('change',function(){
     $('#ddl_sub_scheme').empty();
     $('#ddl_sub_scheme').append($('<option>', {value: "",text: "--All--"}));
     data: {case: "get_sub_scheme",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
         $('#ddl_sub_scheme').empty();
         $('#ddl_sub_scheme').append($('<option>', {
          if(schemeCode.length > 1){
            $('#ddl_sub_scheme').append($('<option>', {
               value: scheme.subscheme_name,
               text: scheme.subscheme_name
         $('#ddl_sub_scheme').trigger('change');
  function getDepartment(depID){
      let scheme_cate = $('#ddl_scheme_cate').val();
     url: APIURL +'get_department',
     data: {type: "department"},
         var department = response[0].data;
        if(scheme_cate == '' || scheme_cate === 0){
                  $('#ddl_department').empty();
                  $('#ddl_department').append($('<option>', {val: '', text: '--All--' }));
                  $('#ddl_payment_cycle').empty();
                  $('#ddl_payment_cycle').append($('<option>', {val: '', text: 'Scheme Based Payment Period' }));
              }
              else
              {
         $.each(department, function (index, dep) {
           if(dep.department_code==depID){
             $('#ddl_department').append($('<option>', {
               value: dep.department_code,
               text: dep.department_name
             }).attr('selected', 'selected'));
             
             $.ajax({
                   url: APIURL +'schem_filter',
                   type: "POST",
                   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
                   data: {case: "get_sub_department",scheme_code:$('#ddl_scheme_code').val(),scheme_name:$('#ddl_scheme_name').val(),sub_scheme_name:$('#ddl_sub_scheme').val(),department:$('#ddl_department').val(),whereColumn:$('#ddl_scheme_cate').val(),user_id:loginUser_id},
                   success: function(response) {
                      
                       var subdepartment_code = response.data[0];
                       get_sub_department(dep.department_code,subdepartment_code.subdepartment);
                   },
                   error: function(xhr, status, error) {
                       console.log("Error:", error);
                   }
               });
   function get_sub_department(depID,subDepID){
       url: APIURL +'get_department',
       type: "POST",
       headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
       data: {type: "sub_department",whereColumn:$('#ddl_scheme_cate').val(),department_code:depID},
       success: function(response) {
           var department = response[0].data;
           
           $('#ddl_sub_department').empty();
           $('#ddl_sub_department').append($('<option>', {
                 value: "",
                 text: "--All--"
             }));
           $.each(department, function (index, sub_dep) {
             if(sub_dep.sub_department_code==subDepID){
               $('#ddl_sub_department').append($('<option>', {
                 value: sub_dep.sub_department_code,
                 text: sub_dep.sub_department_name
             }
           });
           get_schemebyuser(loginUser_id);
       },
       error: function(xhr, status, error) {
           console.log("Error:", error);
       }
     });
   }
    function getDistricts(){
      $('#ddl_scheme_cate').selectpicker('destroy');
        const userDataString = getCookie("payment_official");
        const userData = JSON.parse(userDataString);
        var districtID=0;
        var data=[];
        if(userData['district_code']!=0){
        districtID=userData['district_code'];
        data={ case: 'district',district_code: districtID,user_id:userData['user_id']};
        } else {
        data={ case: 'district',user_id:userData['user_id']};
        $('#ddl_scheme_code').empty();
        $('#ddl_scheme_code').append('<option value="">--All--</option>');
      $.ajax({
        url: userMasterAPIURL+'userMaster',
        method: 'POST',
        headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
        data: data,
        dataType: 'json',
        success: function (response) {
          var district = response.district;
          var districtDropdown = $("#ddl_scheme_cate");
          $('#ddl_scheme_cate').empty();
          $('#ddl_scheme_cate').append($('<option>', {value: "",text: "--All--"}));
          if(districtID==0 || districtID ==undefined){
          populateDropdown('ddl_scheme_cate', response.districts, 'district');              
          } else {
          districtDropdown.html('<option value="'+district['district_code']+'">'+district['district_name']+'</option>');
          $('#ddl_scheme_cate').trigger('change');
          var district_code= district['district_code'];
            getTaluk(district_code);
          } 
          $('#ddl_scheme_cate').selectpicker();
        error: function () {
          console.error('Error fetching district data');
      });
    function getTaluk(districtID){
      $('#ddl_scheme_code').selectpicker('destroy');
        var talukID=0;
        if(userData['taluk_code']!=0){
        talukID=userData['taluk_code'];
        data={ case: 'taluk',district_code: districtID,taluk_code: talukID,user_id:userData['user_id']};
        data={ case: 'taluk',district_code: districtID,user_id:userData['user_id']};
        url: userMasterAPIURL+'userMaster', 
        headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          var taluk = response.taluk
          var talukDropdown = $("#ddl_scheme_code");
          if(talukID==0){
            populateDropdown('ddl_scheme_code', response.taluk, 'taluk');             
            talukDropdown.html('<option value="'+taluk['taluk_code']+'">'+taluk['taluk_name']+'</option>');
          $('#ddl_scheme_code').trigger('change');
          $('#ddl_scheme_code').selectpicker();
          Swal.fire({
            icon: "error",
            title: "Service Error!",
            showConfirmButton: false,
            timer: 2000
          })
  var formsFilter = [];
  window.localStorage.removeItem('filters');
  $(document).ready(function() {
    $("#formFilters").validate({
            rules: {
            },
            messages: {
            errorClass: "help-inline text-danger",
            errorElement: "span",
            highlight: function(element, errorClass, validClass) {
                $(element).parents('.form-group').addClass('has-error');
            unhighlight: function(element, errorClass, validClass) {
                $(element).parents('.form-group').removeClass('has-error');
                $(element).parents('.form-group').addClass('has-success');
            submitHandler: function(form,e) {
                e.preventDefault();
                formsFilter.length = 0;
                formsFilter = [];
                var formData = $(form).serialize();
                window.localStorage.removeItem('filters');
                window.localStorage.setItem('filters', JSON.stringify(formData));
               
                $('#lable_text_scheme_cate').text($('#ddl_scheme_cate').val());
                $('#lable_text_scheme_code').text($('#ddl_scheme_code').val());
                $('#lable_text_scheme').text($('#ddl_scheme_name').val());
                $('#lable_text_sub_scheme').text($('#ddl_sub_scheme').val());
                $('#lable_text_Department').text($("#ddl_department option:selected").text());
                $('#lable_text_sub_department').text($("#ddl_sub_department option:selected").text());
              let paymentCycle = $('#ddl_payment_cycle').text();
              if($("#ddl_payment_period option:selected").val()!='' && $("#ddl_payment_period option:selected").val()!=null && $("#ddl_payment_period option:selected").val()!=undefined){
                paymentCycle = $('#ddl_payment_cycle').text()+'-'+$("#ddl_payment_period option:selected").text();
              $('#lable_text_payment_period').text(paymentCycle);
              $('#lable_text_year_month').text($("#ddl_year option:selected").text());
              $('#lable_text_installment').text($("#ddl_payment_installment option:selected").text());
              if ($('#ddl_scheme_code').val() !== '' && $('#ddl_scheme_name').val() !== '' && $('#ddl_sub_scheme').val() !== '' && $('#ddl_department').val() !== '' && $('#ddl_sub_department').val() !== '') {
                if(($('#payment_date_input').val()=='' )|| ($('#payment_date_input').val() == null) || ($('#payment_date_input').val() == undefined)){
                  
                  getpaymentDate();
              }else{
              } 
                return false;
            }  
      $("#fromSubmitbtn").click();
  function populateDropdown(dropdownId, data, fieldName) {
      const dropdown = document.getElementById(dropdownId);
      data.forEach(item => {
        const option = document.createElement('option');
        option.value = item[fieldName + '_code'];
        option.textContent = item[fieldName + '_name'];
        dropdown.appendChild(option);
  $('#ddl_year').on('change',function(){
    getpaymentDate();
  function labelPaymentMonthEmpty(){
    $('#label_payment_date').empty();
    $('#label_payment_date').append($('<option>', {value: "", text: "--Please Select Payment Year Month--" }));
      $('#payment_date_input').val('');
  function getpaymentDate(){
    $('#label_payment_date').append($('<option>', { value: "", text: "--Payment Date Not Found--" }));
    var dataFilters = window.localStorage.getItem('filters');
        url: APIURL + 'get_payment_date_new',
            ddl_scheme_cate: $('#ddl_scheme_cate').val(),
            ddl_scheme_code: $('#ddl_scheme_code').val(),
            ddl_scheme_name: $('#ddl_scheme_name').val(),
            ddl_sub_scheme: $('#ddl_sub_scheme').val(),
            ddl_department: $('#ddl_department').val(),
            ddl_sub_department: $('#ddl_sub_department').val(),
            ddl_payment_cycle: $('#ddl_payment_cycle').val(),
            ddl_payment_period: $('#ddl_payment_period').val(),
            ddl_payment_installment: $('#ddl_payment_installment').text(),
            ddl_year: $('#ddl_year').val(),
            payment_date: $('#label_payment_date').val(),
            user_id: loginUser_id
            if (response.success == 1) {
                var paymentDates = response.data;
                $('#label_payment_date').empty();
               if (paymentDates.length>1)
               {
                  $('#label_payment_date').append($('<option>', {
                    value: "",
                    text: "--All--"
                  }));
                else if (paymentDates.length == 0)
                {
                    text: "--Payment Date Not Found--"
                  Swal.fire({
                    icon: "question",
                    title: "Details was not Found for the Given Period",
                    timer: 4000
                });
                paymentDates.forEach(function (date) {
                    $('#label_payment_date').append($('<option>', {
                        value: date.payment_date,
                        text: date.payment_date
                    }));
            } else if (response.success == 0) {
                    title: response.message,
        error: function (xhr, status, error) {
                icon: "error",
                title: "Service Error!",
                text: "Failed to retrieve payment dates.",
$('#label_payment_date').on('change', function () {
    let payment_date = $('#label_payment_date').val();
    let paymentTextAll = $('#label_payment_date :selected').text();
    $('#payment_date_input').val(payment_date);
    $('#formFilters').button();
function get_schemebyuser(userid){
  let ddl_scheme_cate = $('#ddl_scheme_cate').val();
  let ddl_scheme_code = $('#ddl_scheme_code').val();
  let ddl_scheme_name = $('#ddl_scheme_name').val();
  let ddl_sub_scheme = $('#ddl_sub_scheme').val();
  let ddl_department = $('#ddl_department').val();
  let ddl_sub_department = $('#ddl_sub_department').val();
  $('#ddl_payment_period').empty();
    $('#ddl_payment_cycle').text('');
    $('#payment_cycle_hidden').val('');
      url: APIURL +'get_scheme_by_user',
      type: "POST",
      headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: {user_id:userid,ddl_scheme_cate:ddl_scheme_cate,ddl_scheme_code:ddl_scheme_code,ddl_scheme_name:ddl_scheme_name,ddl_sub_scheme:ddl_sub_scheme,ddl_department:ddl_department,ddl_sub_department:ddl_sub_department},
      success: function(response) {
          if(response.success == 1){
          var output = response.data[0];
        $('#ddl_payment_cycle').text(output.payment_cycle_text);
        $('#payment_cycle_hidden').val(output.payment_cycle);
        bindDropDownList(output.payment_cycle_text,'#ddl_payment_period');
          console.log("Error:", response);
      },
      error: function(xhr, status, error) {
          console.log("Error:", error);
function bindDropDownList(type,element){
  window.loginUser_id = userDataString['user_id'];
      $('#ddl_payment_installment').empty();
      $('#ddl_year').empty();
      $('#ddl_year').append($('<option>', {
      if (typeof type === 'object') {
        type = type[0];
      url: APIURL +'fn_general_getdropdownvalues',
      headers: {'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
      data: {user_id: loginUser_id,dropdown_type:type},
        console.log(response);
        console.log(response.data);
          var dropdownList = response.data;
          if(response.success ==1){
            $(element).show();
            $(element+'_col').show();
          $(element).empty();
          $(element).append($('<option>', {
                value: "",
                text: "Select "+type
          $.each(dropdownList, function (index, dep) {
            $(element).append($('<option>', {
                value: dep.id,
                text: dep.display_text
          });
        }else{
          if(element!=null && element!=''&&element!=undefined){
            $(element).hide();
            $(element+'_col').hide();
          if(type=='Monthly' || type=='Yearly'){
            get_instalment_filter();
$('#ddl_payment_period').on('change',function(){
  get_instalment_filter();
function resetYearMonth(){
  $('#ddl_year').selectpicker('destroy');
  $('#ddl_year').empty();
  $('#ddl_year').append($('<option>', {
      value: "",
      text: "Select Year - Month"
  }).attr('disabled','true').attr('selected', 'selected'));
  $('#ddl_year').selectpicker();
function get_instalment_filter(){
  $('#ddl_payment_installment').empty();
  $('#ddl_payment_installment').append($('<option>', {
  let ddl_payment_period = $('#ddl_payment_period').val();
  let ddl_payment_cycle = $('#payment_cycle_hidden').val();
  if(ddl_payment_period=='' || ddl_payment_period==null||ddl_payment_period==undefined){
    ddl_payment_period = -1;
     url: APIURL +'get_installment_filter',
     data: {user_id:loginUser_id,ddl_scheme_cate:ddl_scheme_cate,ddl_scheme_code:ddl_scheme_code,ddl_scheme_name:ddl_scheme_name,ddl_sub_scheme:ddl_sub_scheme,ddl_department:ddl_department,ddl_sub_department:ddl_sub_department,paymentcycle:ddl_payment_cycle,paymentperiod:ddl_payment_period},
         if(response.success == 1){
          var output = response.data;
          console.log('ouput >>>', output);
              let installment = fetchDropdownValues('Installment');
              installment.then(function(arrayValue) {
              let grounList = [];
              output.forEach(element => {
                grounList.push(element.installments);
              });
              let instamentList = arrayValue.filter(item => grounList.includes(item.id));
              $('#ddl_payment_installment').empty();
                console.log('instamentList length', instamentList.length);
                if(instamentList.length==1){
                  instamentList.forEach(list => {                 
                  $('#ddl_payment_installment').append($('<option>', {
                    value: list.value,
                    text: list.display_text
                  }).attr('selected','selected'));
                  $('#ddl_payment_installment').change();
                }else{
                  $('#ddl_payment_installment').append($('<option>', { value: "",text: "Select Installment"}).attr('disabled','true').attr('selected', 'selected'));
                    instamentList.forEach(list => {                 
                    $('#ddl_payment_installment').append($('<option>', {
                      value: list.value,
                      text: list.display_text
                  });
         }else{
$('#ddl_payment_installment').on('change',function(){
  let instalmment_value = $('#ddl_payment_installment').val();
  if(instalmment_value!='' || instalmment_value!=null){
      let installment_txt_value = $('#ddl_payment_installment option:selected').text();
      $('#installment_txt_value').val(installment_txt_value);
  }else{
      let installment_txt_value = '';
var userDataString = getCookie('payment_official');
userDataString = JSON.parse(userDataString);
window.loginUser_id = userDataString['user_id'];
let ddl_scheme_cate = $('#ddl_scheme_cate').val();
let ddl_scheme_code = $('#ddl_scheme_code').val();
let ddl_scheme_name = $('#ddl_scheme_name').val();
let ddl_sub_scheme = $('#ddl_sub_scheme').val();
let ddl_department = $('#ddl_department').val();
let ddl_sub_department = $('#ddl_sub_department').val();
let ddl_payment_period = $('#ddl_payment_period').val();
let ddl_payment_cycle = $('#payment_cycle_hidden').val();
let ddl_payment_installment = $('#ddl_payment_installment').val();
if(ddl_payment_period=='' || ddl_payment_period==null||ddl_payment_period==undefined){
   url: APIURL +'get_year_filter',
   type: "POST",
   headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
   data: {user_id:loginUser_id,ddl_scheme_cate:ddl_scheme_cate,ddl_scheme_code:ddl_scheme_code,ddl_scheme_name:ddl_scheme_name,ddl_sub_scheme:ddl_sub_scheme,ddl_department:ddl_department,ddl_sub_department:ddl_sub_department,paymentcycle:ddl_payment_cycle,paymentperiod:ddl_payment_period,iinstallment:ddl_payment_installment},
   success: function(response) {
       if(response.success == 1){
        var output = response.data;
        $.each(output, function (index, list) {
              $('#ddl_year').append($('<option>', {
                value: list.yyyymm,
                text: list.yyyymm_text
        });
        $('#ddl_year').trigger('change');
        $("#ddl_year").val($("#ddl_year option:eq(1)").val());
        $('#ddl_year').selectpicker();
        $("#fromSubmitbtn").click();
       }else{
        console.log("Error:", response);
   },
   error: function(xhr, status, error) {
       console.log("Error:", error);
 });
async function dropDownList(type) {
  try {
      var userDataString = getCookie('payment_official');
      userDataString = JSON.parse(userDataString);
      window.loginUser_id = userDataString['user_id'];
      const response = await $.ajax({
          url: APIURL + 'fn_general_getdropdownvalues',
          type: "POST",
          headers: { 'X-APP-KEY': config.app_key, 'X-APP-NAME': config.app_name },
          data: { user_id: loginUser_id, dropdown_type: type }
      return response.data;
  } catch (error) {
      console.error("Error:", error);
      throw error;
async function fetchDropdownValues(type) {
      let getDropDown = await dropDownList(type);
      return getDropDown;
      console.error('Error occurred:', error);
var formsFilter = [];
window.localStorage.removeItem('filters');
  $("#formFilters").validate({
          rules: {
            ddl_scheme_cate: {required: true},
            ddl_scheme_code: {required: true},
            ddl_scheme_name: {required: true},
            ddl_sub_scheme: {required: true},
            ddl_department: {required: true},
            ddl_sub_department: {required: true},
            ddl_payment_installment : {required: true},
            ddl_year : {required: true},
          },
          messages: {
            ddl_scheme_cate: {required: "Select the Scheme Category"},
            ddl_scheme_code: {required: "Select the Scheme Code"},
            ddl_scheme_name: {required: "Select the scheme Name"},
            ddl_sub_scheme: {required: "Select the Sub Scheme Name"},
            ddl_department: {required: "Select the Deparment"},
            ddl_sub_department: {required: "Select the Sub Deparment"},
            ddl_payment_installment : {required: "Select the Installment"},
            ddl_year :{required: "Select the Year Month"},
          errorClass: "help-inline text-danger",
          errorElement: "span",
          highlight: function(element, errorClass, validClass) {
              $(element).parents('.form-group').addClass('has-error');
          unhighlight: function(element, errorClass, validClass) {
              $(element).parents('.form-group').removeClass('has-error');
              $(element).parents('.form-group').addClass('has-success');
          submitHandler: function(form,e) {
              e.preventDefault();
              formsFilter.length = 0;
              formsFilter = [];
              var formData = $(form).serialize();
              window.localStorage.removeItem('filters');
              window.localStorage.setItem('filters', JSON.stringify(formData));
              $('#lable_text_scheme_cate').text($('#ddl_scheme_cate').val());
              $('#lable_text_scheme_code').text($('#ddl_scheme_code').val());
              $('#lable_text_scheme').text($('#ddl_scheme_name').val());
              $('#lable_text_sub_scheme').text($('#ddl_sub_scheme').val());
              $('#lable_text_Department').text($("#ddl_department option:selected").text());
              $('#lable_text_sub_department').text($("#ddl_sub_department option:selected").text());
                  $('#tblCard').show();
                  $('#accordionExample .accordion-collapse').collapse('hide');
                    var tabId = $('#approvelpayment').val();
                    if(tabId==''){tabId = 8;}
                    tabClickValue(tabId);
                    $('html, body').animate({
                    scrollTop: $("#tblCard").offset().top
                    }, 2000);
              return false;
window.getCurrentTabId = -1;
  </script>
  </body>
  </html>